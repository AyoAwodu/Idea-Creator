{"version":3,"file":"main.js","sources":["../src/components/rich-text-editor.tsx","../src/components/topic-content-editor.tsx","../src/components/topic-desc-editor.tsx","../src/markdown-serializer.ts","../src/plugins/index.tsx"],"sourcesContent":["import * as React from 'react';\nimport { BaseWidget, OpType } from '@blink-mind/renderer-react';\nimport styled from 'styled-components';\nimport RichMarkDownEditor from 'awehook-rich-markdown-editor';\nimport debug from 'debug';\nconst log = debug('node:topic-content-editor');\n\ninterface NodeContentProps {\n  readOnly?: boolean;\n}\n\nconst NodeContent = styled.div<NodeContentProps>`\n  padding: 6px;\n  background-color: ${props => (props.readOnly ? null : 'white')};\n  cursor: ${props => (props.readOnly ? 'pointer' : 'text')};\n`;\n\nexport class RichTextEditor extends BaseWidget {\n  onMouseDown = e => {\n    e.stopPropagation();\n  };\n\n  onMouseMove = e => {\n    e.stopPropagation();\n  };\n  onChange = (value: () => string) => {};\n\n  getCustomizeProps = () => {\n    return null;\n  };\n\n  render() {\n    const { topicKey, saveRef } = this.props;\n    const { block, readOnly, refKeyPrefix } = this.getCustomizeProps();\n    const content = block.data;\n    if (content == null) return null;\n    const key = `${refKeyPrefix}-${topicKey}`;\n    return (\n      <NodeContent\n        key={key}\n        readOnly={readOnly}\n        ref={saveRef(key)}\n        onMouseDown={this.onMouseDown}\n        onMouseMove={this.onMouseMove}\n      >\n        <RichMarkDownEditor\n          editorValue={content}\n          readOnly={readOnly}\n          onChange={this.onChange}\n        />\n      </NodeContent>\n    );\n  }\n}\n","import * as React from 'react';\nimport { OpType } from '@blink-mind/renderer-react';\nimport { RichTextEditor } from './rich-text-editor';\nimport { BlockType } from '@blink-mind/core';\n\nexport class TopicContentEditor extends RichTextEditor {\n  getCustomizeProps = () => {\n    const { model, topicKey } = this.props;\n    const block = model.getTopic(topicKey).getBlock(BlockType.CONTENT).block;\n    const readOnly = model.editingContentKey !== topicKey;\n    const refKeyPrefix = 'content-editor';\n    return {\n      block,\n      readOnly,\n      refKeyPrefix\n    };\n  };\n  onChange = (value: () => string) => {\n    this.operation(OpType.SET_TOPIC_CONTENT, {\n      ...this.props,\n      content: value\n    });\n  };\n}\n","import * as React from 'react';\nimport { OpType } from '@blink-mind/renderer-react';\nimport { RichTextEditor } from './rich-text-editor';\nimport { BlockType } from '@blink-mind/core';\n\nexport class TopicDescEditor extends RichTextEditor {\n  getCustomizeProps = () => {\n    const { model, topicKey } = this.props;\n    const block = model.getTopic(topicKey).getBlock(BlockType.DESC).block;\n    const readOnly = model.editingDescKey !== topicKey;\n    const refKeyPrefix = 'desc-editor';\n    return {\n      block,\n      readOnly,\n      refKeyPrefix\n    };\n  };\n  onChange = (value: () => string) => {\n    this.operation(OpType.SET_TOPIC_DESC, {\n      ...this.props,\n      desc: value\n    });\n  };\n}\n","import MarkdownSerializer from 'slate-md-serializer';\nexport default new MarkdownSerializer();\n","import * as React from 'react';\nimport { TopicContentEditor } from '../components/topic-content-editor';\nimport { TopicDescEditor } from '../components/topic-desc-editor';\nimport markdownSerializer from '../markdown-serializer';\nimport { BlockType } from '@blink-mind/core';\nexport default function RichTextEditorPlugin() {\n  return {\n    renderTopicContentEditor(props) {\n      return <TopicContentEditor {...props} />;\n    },\n\n    renderTopicDescEditor(props) {\n      return <TopicDescEditor {...props} />;\n    },\n\n    serializeBlock(props, next) {\n      const { block } = props;\n      if (block.type === BlockType.CONTENT || block.type === BlockType.DESC) {\n        const res = {\n          type: block.type,\n          data:\n            typeof block.data === 'string'\n              ? block.data\n              : markdownSerializer.serialize(block.data)\n        };\n        return res;\n      }\n      return next();\n    },\n\n    deserializeBlock(props, next) {\n      return next();\n    }\n  };\n}\n"],"names":["React.createElement","BaseWidget","BlockType","OpType"],"mappings":"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"}