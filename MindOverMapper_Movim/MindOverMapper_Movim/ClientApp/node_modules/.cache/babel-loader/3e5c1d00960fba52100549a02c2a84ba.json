{"ast":null,"code":"import { List, Record, Map as Map$1 } from 'immutable';\nimport isPlainObject from 'is-plain-object';\nimport debug from 'debug';\nimport memoizeOne from 'memoize-one';\nimport warning from 'tiny-warning';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nfunction __values(o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n}\n\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n}\n\nfunction __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n}\n\nvar defaultBlockRecord = {\n  type: null,\n  key: null,\n  data: null\n};\n\nvar Block =\n/** @class */\nfunction (_super) {\n  __extends(Block, _super);\n\n  function Block() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Object.defineProperty(Block.prototype, \"data\", {\n    get: function () {\n      return this.get('data');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Block.prototype, \"type\", {\n    get: function () {\n      return this.get('type');\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Block.create = function (obj) {\n    return new Block(obj);\n  };\n\n  Block.createList = function (obj) {\n    if (List.isList(obj) || Array.isArray(obj)) {\n      // @ts-ignore\n      return List(obj.map(Block.create));\n    }\n\n    throw new Error(\"Block.createList only accepts Array or List, but you passed it: \" + obj);\n  };\n\n  return Block;\n}(Record(defaultBlockRecord));\n\nvar TopicDirection = {\n  LEFT: 'L',\n  RIGHT: 'R',\n  BOTTOM: 'B',\n  MAIN: 'M' // root\n\n};\nvar DiagramLayoutType;\n\n(function (DiagramLayoutType) {\n  DiagramLayoutType[DiagramLayoutType[\"LEFT_TO_RIGHT\"] = 0] = \"LEFT_TO_RIGHT\";\n  DiagramLayoutType[DiagramLayoutType[\"RIGHT_TO_LEFT\"] = 1] = \"RIGHT_TO_LEFT\";\n  DiagramLayoutType[DiagramLayoutType[\"LEFT_AND_RIGHT\"] = 2] = \"LEFT_AND_RIGHT\";\n  DiagramLayoutType[DiagramLayoutType[\"TOP_TO_BOTTOM\"] = 3] = \"TOP_TO_BOTTOM\";\n})(DiagramLayoutType || (DiagramLayoutType = {}));\n\nvar TopicVisualLevel = {\n  ROOT: 0,\n  PRIMARY: 1,\n  NORMAL: 2\n};\nvar BlockType = {\n  CONTENT: 'CONTENT',\n  DESC: 'DESC'\n};\nvar FocusMode = {\n  NORMAL: 'NORMAL',\n  EDITING_CONTENT: 'EDITING_CONTENT',\n  EDITING_DESC: 'EDITING_DESC',\n  SHOW_POPUP: 'SHOW_POPUP',\n  DRAGGING: 'DRAGGING'\n};\nvar TopicRelationship = {\n  ANCESTOR: 'ANCESTOR',\n  DESCENDANT: 'DESCENDANT',\n  SIBLING: 'SIBLING',\n  NONE: 'NONE'\n};\nvar defaultTheme = {\n  name: 'default',\n  randomColor: true,\n  background: 'rgb(57,60,65)',\n  highlightColor: '#50C9CE',\n  marginH: 60,\n  marginV: 20,\n  fontFamily: '',\n  bold: false,\n  italic: false,\n  textAlign: 'left',\n  rootTopic: {\n    background: '#ff8200',\n    color: '#fff',\n    fontSize: '34px',\n    borderRadius: '35px',\n    padding: '16px 18px 16px 18px'\n  },\n  primaryTopic: {\n    background: '#e8eaec',\n    borderWidth: '1px',\n    borderStyle: 'solid',\n    borderColor: 'rgb(187,187,187)',\n    borderRadius: '20px',\n    color: 'rgb(68,68,68)',\n    fontSize: '17px',\n    padding: '10px 15px 10px 15px',\n    linkStyle: {\n      lineType: 'curve',\n      lineWidth: 3,\n      lineColor: 'rgb(113, 203, 45)'\n    }\n  },\n  normalTopic: {\n    background: '#fff',\n    border: '1px solid #e8eaec',\n    borderRadius: '20px',\n    color: 'rgb(68,68,68)',\n    fontSize: '17px',\n    padding: '4px 10px',\n    linkStyle: {\n      lineType: 'curve',\n      lineWidth: 3,\n      lineColor: 'white'\n    }\n  }\n};\nvar defaultConfigRecord = {\n  readOnly: false,\n  allowUndo: true,\n  layoutDir: DiagramLayoutType.LEFT_AND_RIGHT,\n  theme: defaultTheme\n};\n\nvar Config =\n/** @class */\nfunction (_super) {\n  __extends(Config, _super);\n\n  function Config() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Object.defineProperty(Config.prototype, \"layoutDir\", {\n    get: function () {\n      return this.get('layoutDir');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Config.prototype, \"readOnly\", {\n    get: function () {\n      return this.get('readOnly');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Config.prototype, \"allowUndo\", {\n    get: function () {\n      return this.get('allowUndo');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Config.prototype, \"theme\", {\n    get: function () {\n      return this.get('theme');\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Config.fromJSON = function (obj) {\n    return new Config(obj);\n  };\n\n  return Config;\n}(Record(defaultConfigRecord));\n/**\r\n * Data.\r\n *\r\n * This isn't an immutable record, it's just a thin wrapper around `Map` so that\r\n * we can allow for more convenient creation.\r\n *\r\n * @type {Object}\r\n */\n\n\nvar Data =\n/** @class */\nfunction () {\n  function Data() {}\n  /**\r\n   * Create a new `Data` with `attrs`.\r\n   *\r\n   * @param {Object|Map} attrs\r\n   * @return {Data} data\r\n   */\n\n\n  Data.create = function (attrs) {\n    if (attrs === void 0) {\n      attrs = {};\n    }\n\n    if (Map$1.isMap(attrs)) {\n      return attrs;\n    }\n\n    if (isPlainObject(attrs)) {\n      return Data.fromJSON(attrs);\n    }\n\n    throw new Error(\"`Data.create` only accepts objects or maps, but you passed it: \" + attrs);\n  };\n  /**\r\n   * Create a `Data` from a JSON `object`.\r\n   *\r\n   * @param {Object} object\r\n   * @return {Data}\r\n   */\n\n\n  Data.fromJSON = function (object) {\n    return Map$1(object);\n  };\n\n  return Data;\n}();\n\nvar defaultTopicRecord = {\n  key: null,\n  parentKey: null,\n  collapse: false,\n  subKeys: null,\n  blocks: null,\n  relations: null,\n  style: null\n};\n\nvar Topic =\n/** @class */\nfunction (_super) {\n  __extends(Topic, _super);\n\n  function Topic() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Object.defineProperty(Topic.prototype, \"key\", {\n    get: function () {\n      return this.get('key');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Topic.prototype, \"parentKey\", {\n    get: function () {\n      return this.get('parentKey');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Topic.prototype, \"collapse\", {\n    get: function () {\n      return this.get('collapse');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Topic.prototype, \"subKeys\", {\n    get: function () {\n      return this.get('subKeys');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Topic.prototype, \"blocks\", {\n    get: function () {\n      return this.get('blocks');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Topic.prototype, \"relations\", {\n    get: function () {\n      return this.get('relations');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Topic.prototype, \"style\", {\n    get: function () {\n      return this.get('style');\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Topic.prototype.getBlock = function (type) {\n    var index = this.blocks.findIndex(function (b) {\n      return b.type === type;\n    });\n    if (index === -1) return {\n      index: index,\n      block: null\n    };\n    return {\n      index: index,\n      block: this.blocks.get(index)\n    };\n  };\n\n  Topic.fromJSON = function (obj) {\n    var key = obj.key,\n        _a = obj.parentKey,\n        parentKey = _a === void 0 ? null : _a,\n        blocks = obj.blocks,\n        _b = obj.subKeys,\n        subKeys = _b === void 0 ? [] : _b,\n        _c = obj.collapse,\n        collapse = _c === void 0 ? false : _c;\n    return new Topic({\n      key: key,\n      parentKey: parentKey,\n      collapse: collapse,\n      subKeys: List(subKeys),\n      blocks: Block.createList(blocks)\n    });\n  };\n\n  Topic.create = function (_a) {\n    var key = _a.key,\n        _b = _a.parentKey,\n        parentKey = _b === void 0 ? null : _b,\n        _c = _a.content,\n        content = _c === void 0 ? 'new node' : _c,\n        _d = _a.subKeys,\n        subKeys = _d === void 0 ? [] : _d,\n        _e = _a.collapse,\n        collapse = _e === void 0 ? false : _e;\n    var block = Block.create({\n      type: BlockType.CONTENT,\n      data: content,\n      key: null\n    });\n    var blocks = List([block]);\n    return new Topic({\n      key: key,\n      parentKey: parentKey,\n      blocks: blocks,\n      subKeys: List(subKeys),\n      collapse: collapse\n    });\n  };\n\n  return Topic;\n}(Record(defaultTopicRecord));\n\nfunction createKey() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    var r = Math.random() * 16 | 0,\n        v = c == 'x' ? r : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n}\n\nvar defaultModelRecord = {\n  topics: Map$1(),\n  data: null,\n  config: null,\n  rootTopicKey: null,\n  editorRootTopicKey: null,\n  focusKey: null,\n  focusMode: null\n};\n\nvar Model =\n/** @class */\nfunction (_super) {\n  __extends(Model, _super);\n\n  function Model() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  Model.isModel = function (obj) {\n    return obj instanceof Model;\n  };\n\n  Model.create = function (attrs) {\n    if (attrs === void 0) {\n      attrs = null;\n    }\n\n    if (attrs == null) return Model.createEmpty();\n\n    if (Model.isModel(attrs)) {\n      return attrs;\n    }\n\n    if (isPlainObject(attrs)) {\n      return Model.fromJSON(attrs);\n    }\n\n    throw new Error(\"`Value.create` only accepts objects or values, but you passed it: \" + attrs);\n  };\n\n  Model.createEmpty = function () {\n    var model = new Model();\n    var rootTopic = Topic.create({\n      key: createKey()\n    });\n    return model.update('topics', function (topics) {\n      return topics.set(rootTopic.key, rootTopic);\n    }).set('rootTopicKey', rootTopic.key);\n  };\n\n  Model.fromJSON = function (object) {\n    var model = new Model();\n    var _a = object.data,\n        data = _a === void 0 ? {} : _a,\n        _b = object.topics,\n        topics = _b === void 0 ? [] : _b,\n        _c = object.config,\n        config = _c === void 0 ? {} : _c,\n        rootTopicKey = object.rootTopicKey;\n    var editorRootTopicKey = object.editorRootTopicKey;\n    if (editorRootTopicKey === undefined) editorRootTopicKey = rootTopicKey;\n    model = model.merge({\n      rootTopicKey: rootTopicKey,\n      editorRootTopicKey: editorRootTopicKey\n    });\n    model = model.withMutations(function (model) {\n      topics.forEach(function (topic) {\n        model.update('topics', function (topics) {\n          return topics.set(topic.key, Topic.fromJSON(topic));\n        });\n      });\n      model.set('config', Config.fromJSON(config));\n      model.set('data', Data.fromJSON(data));\n    });\n    return model;\n  };\n\n  Model.prototype.toJS = function () {\n    var obj = {\n      rootTopicKey: this.rootTopicKey,\n      topics: Object.values(this.topics.toJS()),\n      config: this.config,\n      data: this.data\n    };\n    return obj;\n  };\n\n  Object.defineProperty(Model.prototype, \"topics\", {\n    get: function () {\n      return this.get('topics');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"config\", {\n    get: function () {\n      return this.get('config');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"rootTopicKey\", {\n    get: function () {\n      return this.get('rootTopicKey');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"editorRootTopicKey\", {\n    get: function () {\n      return this.get('editorRootTopicKey');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"focusKey\", {\n    get: function () {\n      return this.get('focusKey');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"focusMode\", {\n    get: function () {\n      return this.get('focusMode');\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"editingContentKey\", {\n    get: function () {\n      return this.focusMode === FocusMode.EDITING_CONTENT ? this.focusKey : null;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(Model.prototype, \"editingDescKey\", {\n    get: function () {\n      return this.focusMode === FocusMode.EDITING_DESC ? this.focusKey : null;\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  Model.prototype.getTopic = function (key) {\n    return this.topics.get(key);\n  };\n\n  Model.prototype.getParentTopic = function (key) {\n    var topic = this.getTopic(key);\n    return topic.parentKey ? this.getTopic(topic.parentKey) : null;\n  };\n\n  Model.prototype.getTopicVisualLevel = function (key) {\n    var topic = this.getTopic(key);\n    var level = 0;\n\n    while (topic && topic.key !== this.editorRootTopicKey) {\n      level++;\n      topic = this.getParentTopic(topic.key);\n    }\n\n    return level;\n  };\n\n  Object.defineProperty(Model.prototype, \"rootTopic\", {\n    get: function () {\n      return this.getTopic(this.rootTopicKey);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return Model;\n}(Record(defaultModelRecord));\n\nfunction getAllSubTopicKeys(model, topicKey) {\n  var item = model.getTopic(topicKey);\n  var res = [];\n\n  if (item.subKeys.size > 0) {\n    var subKeys = item.subKeys.toArray();\n    res.push.apply(res, __spread(subKeys));\n    res = subKeys.reduce(function (acc, key) {\n      acc.push.apply(acc, __spread(getAllSubTopicKeys(model, key)));\n      return acc;\n    }, res);\n  }\n\n  return res;\n}\n\nfunction getRelationship(model, srcKey, dstKey) {\n  var srcTopic = model.getTopic(srcKey);\n  var dstTopic = model.getTopic(dstKey);\n\n  if (srcTopic && dstTopic) {\n    if (srcTopic.parentKey == dstTopic.parentKey) return TopicRelationship.SIBLING;\n    var pTopic = srcTopic;\n\n    while (pTopic.parentKey) {\n      if (pTopic.parentKey === dstTopic.key) return TopicRelationship.DESCENDANT;\n      pTopic = model.getParentTopic(pTopic.key);\n    }\n\n    pTopic = dstTopic;\n\n    while (pTopic.parentKey) {\n      if (pTopic.parentKey === srcTopic.key) return TopicRelationship.ANCESTOR;\n      pTopic = model.getParentTopic(pTopic.key);\n    }\n  }\n\n  return TopicRelationship.NONE;\n}\n\nvar log = debug('modifier');\n\nfunction toggleCollapse(_a) {\n  var model = _a.model,\n      topicKey = _a.topicKey;\n  var topic = model.getTopic(topicKey);\n\n  if (topic && topic.subKeys.size !== 0) {\n    topic = topic.merge({\n      collapse: !topic.collapse\n    });\n    model = model.updateIn(['topics', topic.key, 'collapse'], function (collapse) {\n      return !collapse;\n    });\n  }\n\n  return model;\n}\n\nfunction focusTopic(_a) {\n  var model = _a.model,\n      topicKey = _a.topicKey,\n      focusMode = _a.focusMode;\n  log('focus topic');\n  if (topicKey !== model.focusKey) model = model.set('focusKey', topicKey);\n  if (focusMode !== model.focusMode) model = model.set('focusMode', focusMode);\n  return model;\n}\n\nfunction addChild(_a) {\n  var model = _a.model,\n      topicKey = _a.topicKey;\n  log('addChild:', topicKey);\n  var topic = model.getTopic(topicKey);\n\n  if (topic) {\n    var child_1 = Topic.create({\n      key: createKey(),\n      parentKey: topic.key\n    });\n    topic = topic.set('collapse', false).update('subKeys', function (subKeys) {\n      return subKeys.push(child_1.key);\n    });\n    model = model.update('topics', function (topics) {\n      return topics.set(topicKey, topic).set(child_1.key, child_1);\n    });\n    return focusTopic({\n      model: model,\n      topicKey: child_1.key,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n\n  return model;\n}\n\nfunction addSibling(_a) {\n  var model = _a.model,\n      topicKey = _a.topicKey;\n  if (topicKey === model.rootTopicKey) return model;\n  var topic = model.getTopic(topicKey);\n\n  if (topic) {\n    var pItem = model.getTopic(topic.parentKey);\n    var idx_1 = pItem.subKeys.indexOf(topicKey);\n    var sibling_1 = Topic.create({\n      key: createKey(),\n      parentKey: pItem.key\n    });\n    model = model.update('topics', function (topics) {\n      return topics.set(sibling_1.key, sibling_1);\n    }).updateIn(['topics', pItem.key, 'subKeys'], function (subKeys) {\n      return subKeys.insert(idx_1 + 1, sibling_1.key);\n    });\n    return focusTopic({\n      model: model,\n      topicKey: sibling_1.key,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n\n  return model;\n}\n\nfunction deleteTopic(_a) {\n  var model = _a.model,\n      topicKey = _a.topicKey;\n  if (topicKey === model.rootTopicKey) return model;\n  var item = model.getTopic(topicKey);\n\n  if (item) {\n    model = model.withMutations(function (m) {\n      m.update('topics', function (topics) {\n        topics = topics.delete(topicKey);\n        var deleteKeys = getAllSubTopicKeys(model, topicKey);\n        topics = topics.withMutations(function (t) {\n          deleteKeys.forEach(function (dKey) {\n            t.delete(dKey);\n          });\n        });\n        return topics;\n      });\n      m.updateIn(['topics', item.parentKey, 'subKeys'], function (subKeys) {\n        return subKeys.delete(subKeys.indexOf(topicKey));\n      });\n      if (m.focusKey === topicKey) m.set('focusKey', null).set('focusMode', null);\n    });\n  }\n\n  return model;\n}\n\nfunction setContent(_a) {\n  var model = _a.model,\n      topicKey = _a.topicKey,\n      content = _a.content;\n  var topic = model.getTopic(topicKey);\n\n  if (topic) {\n    var _b = topic.getBlock(BlockType.CONTENT),\n        index = _b.index,\n        block = _b.block;\n\n    if (block.data !== content) {\n      model = model.updateIn(['topics', topicKey, 'blocks', index, 'data'], function (data) {\n        return content;\n      });\n    }\n\n    return focusTopic({\n      model: model,\n      topicKey: topicKey,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n\n  return model;\n}\n\nfunction setStyle(_a) {\n  var model = _a.model,\n      topicKey = _a.topicKey,\n      style = _a.style;\n  var topic = model.getTopic(topicKey);\n\n  if (topic) {\n    if (style !== topic.style) {\n      model = model.updateIn(['topics', topicKey, 'style'], function (s) {\n        return style;\n      });\n    }\n  }\n\n  return model;\n}\n\nfunction setDesc(_a) {\n  var model = _a.model,\n      topicKey = _a.topicKey,\n      desc = _a.desc;\n  var topic = model.getTopic(topicKey);\n\n  if (topic) {\n    var _b = topic.getBlock(BlockType.DESC),\n        index = _b.index,\n        block = _b.block;\n\n    if (index === -1) {\n      model = model.updateIn(['topics', topicKey, 'blocks'], function (blocks) {\n        return blocks.push(Block.create({\n          type: BlockType.DESC,\n          data: desc\n        }));\n      });\n    } else {\n      if (block.data !== desc) {\n        model = model.updateIn(['topics', topicKey, 'blocks', index, 'data'], function (data) {\n          return desc;\n        });\n      }\n    }\n\n    return focusTopic({\n      model: model,\n      topicKey: topicKey,\n      focusMode: FocusMode.EDITING_DESC\n    });\n  }\n\n  return model;\n}\n\nfunction setTheme(_a) {\n  var model = _a.model,\n      theme = _a.theme;\n  model = model.setIn(['config', 'theme'], theme);\n  return model;\n}\n\nfunction setLayoutDir(_a) {\n  var model = _a.model,\n      layoutDir = _a.layoutDir;\n  if (model.config.layoutDir === layoutDir) return model;\n  model = model.setIn(['config', 'layoutDir'], layoutDir);\n  return model;\n}\n\nvar index = {\n  addChild: addChild,\n  addSibling: addSibling,\n  toggleCollapse: toggleCollapse,\n  focusTopic: focusTopic,\n  deleteTopic: deleteTopic,\n  setContent: setContent,\n  setDesc: setDesc,\n  setStyle: setStyle,\n  setTheme: setTheme,\n  setLayoutDir: setLayoutDir\n};\nvar index$1 = {\n  Block: Block,\n  Config: Config,\n  Model: Model,\n  Topic: Topic,\n  Data: Data\n};\n\nfunction CorePlugin(options) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var _a = options.plugins,\n      plugins = _a === void 0 ? [] : _a;\n  return __spread(plugins);\n}\n\nvar log$1 = debug('core:controller');\n\nfunction registerPlugin(controller, plugin) {\n  if (Array.isArray(plugin)) {\n    plugin.forEach(function (p) {\n      return registerPlugin(controller, p);\n    });\n    return;\n  }\n\n  if (plugin == null) {\n    return;\n  }\n\n  for (var key in plugin) {\n    var fn = plugin[key];\n    controller.middleware[key] = controller.middleware[key] || [];\n    controller.middleware[key].push(fn);\n  }\n} // modified from koa-compose\n\n\nfunction compose(middleware) {\n  var e_1, _a;\n\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!');\n\n  try {\n    for (var middleware_1 = __values(middleware), middleware_1_1 = middleware_1.next(); !middleware_1_1.done; middleware_1_1 = middleware_1.next()) {\n      var fn = middleware_1_1.value;\n      if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!');\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (middleware_1_1 && !middleware_1_1.done && (_a = middleware_1.return)) _a.call(middleware_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return function (context, next) {\n    // last called middleware #\n    var index = -1;\n    return dispatch(0);\n\n    function dispatch(i) {\n      if (i <= index) throw new Error('next() called multiple times');\n      index = i;\n      var fn = middleware[i];\n      if (i === middleware.length) fn = next;\n      if (!fn) return null;\n\n      try {\n        return fn(context, dispatch.bind(null, i + 1));\n      } catch (err) {\n        throw err;\n      }\n    }\n  };\n}\n\nvar Controller =\n/** @class */\nfunction () {\n  function Controller(options) {\n    if (options === void 0) {\n      options = {};\n    }\n\n    var _a = options.diagram,\n        diagram = _a === void 0 ? this : _a,\n        _b = options.plugins,\n        plugins = _b === void 0 ? [] : _b,\n        onChange = options.onChange,\n        readOnly = options.readOnly;\n    this.diagram = diagram;\n    this.readOnly = readOnly;\n    this.onChange = onChange;\n    this.middleware = new Map();\n    var corePlugin = CorePlugin({\n      plugins: plugins\n    });\n    registerPlugin(this, corePlugin);\n  }\n\n  Controller.prototype.run = function (key) {\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    var middleware = this.middleware;\n    var fns = middleware[key] || [];\n    warning(fns.length !== 0, \"the middleware function \" + key + \" is not found!\");\n    var composedFn = memoizeOne(compose)(fns); // @ts-ignore\n\n    return composedFn.apply(void 0, __spread(args));\n  };\n\n  Controller.prototype.change = function (model) {\n    this.onChange(model);\n  };\n\n  return Controller;\n}();\n\nexport { Block, BlockType, Config, Controller, Data, DiagramLayoutType, FocusMode, Model, index as ModelModifier, index as Modifiers, Topic, TopicDirection, TopicRelationship, TopicVisualLevel, defaultTheme, getAllSubTopicKeys, getRelationship, index$1 as models };","map":{"version":3,"sources":["../src/models/block.ts","../src/types/index.ts","../src/configs/theme/default-theme.ts","../src/models/config.ts","../src/models/data.ts","../src/models/topic.ts","../src/utils/index.ts","../src/models/model.ts","../src/models/utils/index.ts","../src/models/modifiers/index.ts","../src/models/index.ts","../src/plugins/core.ts","../src/controller.ts"],"names":["Map","log"],"mappings":"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","sourcesContent":["import { KeyType } from '../types';\nimport { Record, List } from 'immutable';\n\ntype BlockRecordType = {\n  type: string;\n  key?: KeyType;\n  data: any;\n};\n\nconst defaultBlockRecord: BlockRecordType = {\n  type: null,\n  key: null,\n  data: null\n};\n\nexport class Block extends Record(defaultBlockRecord) {\n  get data() {\n    return this.get('data');\n  }\n\n  get type() {\n    return this.get('type');\n  }\n\n  static create(obj: BlockRecordType): Block {\n    return new Block(obj);\n  }\n\n  static createList(obj: any): List<Block> {\n    if (List.isList(obj) || Array.isArray(obj)) {\n      // @ts-ignore\n      return List(obj.map(Block.create));\n    }\n    throw new Error(\n      `Block.createList only accepts Array or List, but you passed it: ${obj}`\n    );\n  }\n}\n","import { Model } from '@blink-mind/core';\n\nexport type KeyType = string;\n\nexport const TopicDirection = {\n  LEFT: 'L', // 从右向左\n  RIGHT: 'R', // 从左向右\n  BOTTOM: 'B', // 从上往下\n  MAIN: 'M' // root\n};\n\nexport enum DiagramLayoutType {\n  LEFT_TO_RIGHT,\n  RIGHT_TO_LEFT,\n  LEFT_AND_RIGHT,\n  TOP_TO_BOTTOM\n}\n\nexport const TopicVisualLevel = {\n  ROOT: 0,\n  PRIMARY: 1,\n  NORMAL: 2\n};\n\nexport const BlockType = {\n  CONTENT: 'CONTENT',\n  DESC: 'DESC'\n};\n\nexport const FocusMode = {\n  NORMAL: 'NORMAL',\n  EDITING_CONTENT: 'EDITING_CONTENT',\n  EDITING_DESC: 'EDITING_DESC',\n  SHOW_POPUP: 'SHOW_POPUP',\n  DRAGGING: 'DRAGGING'\n};\n\nexport type OnChangeFunction = (model: Model) => void;\n\nexport const TopicRelationship = {\n  ANCESTOR: 'ANCESTOR',\n  DESCENDANT: 'DESCENDANT',\n  SIBLING: 'SIBLING',\n  NONE: 'NONE'\n};\n","import { ThemeType } from '@blink-mind/core';\n\nexport const defaultTheme: ThemeType = {\n  name: 'default',\n  randomColor: true,\n  background: 'rgb(57,60,65)',\n  highlightColor: '#50C9CE',\n  marginH: 60,\n  marginV: 20,\n  fontFamily: '',\n  bold: false,\n  italic: false,\n  textAlign: 'left',\n  rootTopic: {\n    background: '#ff8200',\n    color: '#fff',\n    fontSize: '34px',\n    borderRadius: '35px',\n    padding: '16px 18px 16px 18px'\n  },\n  primaryTopic: {\n    background: '#e8eaec',\n    borderWidth: '1px',\n    borderStyle: 'solid',\n    borderColor: 'rgb(187,187,187)',\n    borderRadius: '20px',\n    color: 'rgb(68,68,68)',\n    fontSize: '17px',\n    padding: '10px 15px 10px 15px',\n\n    linkStyle: {\n      lineType: 'curve',\n      lineWidth: 3,\n      lineColor: 'rgb(113, 203, 45)'\n    }\n  },\n\n  normalTopic: {\n    background: '#fff',\n    border: '1px solid #e8eaec',\n    borderRadius: '20px',\n    color: 'rgb(68,68,68)',\n    fontSize: '17px',\n    padding: '4px 10px',\n\n    linkStyle: {\n      lineType: 'curve',\n      lineWidth: 3,\n      lineColor: 'white'\n    }\n  }\n};\n","import { DiagramLayoutType } from '../types';\nimport { Record } from 'immutable';\nimport { ThemeType, defaultTheme } from '../configs/theme';\n\ntype ConfigRecordType = {\n  readOnly?: boolean;\n  allowUndo?: boolean;\n  layoutDir?: DiagramLayoutType;\n  theme?: ThemeType;\n};\n\nconst defaultConfigRecord: ConfigRecordType = {\n  readOnly: false,\n  allowUndo: true,\n  layoutDir: DiagramLayoutType.LEFT_AND_RIGHT,\n  theme: defaultTheme\n};\n\nexport class Config extends Record(defaultConfigRecord) {\n  get layoutDir(): DiagramLayoutType {\n    return this.get('layoutDir');\n  }\n\n  get readOnly(): boolean {\n    return this.get('readOnly');\n  }\n\n  get allowUndo(): boolean {\n    return this.get('allowUndo');\n  }\n\n  get theme(): ThemeType {\n    return this.get('theme');\n  }\n\n  static fromJSON(obj) {\n    return new Config(obj);\n  }\n}\n","import isPlainObject from 'is-plain-object';\nimport { Map } from 'immutable';\n\n/**\n * Data.\n *\n * This isn't an immutable record, it's just a thin wrapper around `Map` so that\n * we can allow for more convenient creation.\n *\n * @type {Object}\n */\n\nexport class Data {\n  /**\n   * Create a new `Data` with `attrs`.\n   *\n   * @param {Object|Map} attrs\n   * @return {Data} data\n   */\n\n  static create(attrs = {}) {\n    if (Map.isMap(attrs)) {\n      return attrs;\n    }\n\n    if (isPlainObject(attrs)) {\n      return Data.fromJSON(attrs);\n    }\n\n    throw new Error(\n      `\\`Data.create\\` only accepts objects or maps, but you passed it: ${attrs}`\n    );\n  }\n\n  /**\n   * Create a `Data` from a JSON `object`.\n   *\n   * @param {Object} object\n   * @return {Data}\n   */\n\n  static fromJSON(object: any) {\n    return Map(object);\n  }\n\n  /**\n   * Alias `fromJS`.\n   */\n\n  // static fromJS = Data.fromJSON\n}\n","import { BlockType, KeyType } from '../types';\nimport { List, Record } from 'immutable';\nimport { Block } from './block';\nimport { Relation } from './relation';\n\ntype TopicRecordType = {\n  key: KeyType;\n  parentKey?: KeyType;\n  collapse?: boolean;\n  subKeys?: List<KeyType>;\n  blocks?: List<Block>;\n  relations?: List<Relation>;\n  style?: string;\n};\n\ntype CreateTopicArg = {\n  key: KeyType;\n  parentKey?: KeyType;\n  collapse?: boolean;\n  content?: any;\n  subKeys?: List<KeyType> | KeyType[];\n  style?: string;\n};\n\nconst defaultTopicRecord: TopicRecordType = {\n  key: null,\n  parentKey: null,\n  collapse: false,\n  subKeys: null,\n  blocks: null,\n  relations: null,\n  style: null\n};\n\nexport class Topic extends Record(defaultTopicRecord) {\n  get key() {\n    return this.get('key');\n  }\n  get parentKey() {\n    return this.get('parentKey');\n  }\n  get collapse() {\n    return this.get('collapse');\n  }\n  get subKeys(): List<KeyType> {\n    return this.get('subKeys');\n  }\n  get blocks(): List<Block> {\n    return this.get('blocks');\n  }\n  get relations() {\n    return this.get('relations');\n  }\n  get style() {\n    return this.get('style');\n  }\n\n  getBlock(type: string): { index: number; block: Block } {\n    const index = this.blocks.findIndex(b => b.type === type);\n    if (index === -1) return { index, block: null };\n    return { index, block: this.blocks.get(index) };\n  }\n\n  static fromJSON(obj) {\n    const {\n      key,\n      parentKey = null,\n      blocks,\n      subKeys = [],\n      collapse = false\n    } = obj;\n    return new Topic({\n      key,\n      parentKey,\n      collapse,\n      subKeys: List(subKeys),\n      blocks: Block.createList(blocks)\n    });\n  }\n\n  static create({\n    key,\n    parentKey = null,\n    content = 'new node',\n    subKeys = [],\n    collapse = false\n  }: CreateTopicArg): Topic {\n    const block = Block.create({\n      type: BlockType.CONTENT,\n      data: content,\n      key: null\n    });\n    const blocks = List([block]);\n    return new Topic({\n      key,\n      parentKey,\n      blocks,\n      subKeys: List(subKeys),\n      collapse\n    });\n  }\n}\n","export function createKey() {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    const r = (Math.random() * 16) | 0,\n      v = c == 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n","import { Map, Record } from 'immutable';\nimport isPlainObject from 'is-plain-object';\nimport { Data } from './data';\nimport { FocusMode, KeyType } from '../types';\nimport { Config } from './config';\nimport { Topic } from './topic';\nimport { createKey } from '../utils';\n\ntype ModelRecordType = {\n  topics: Map<KeyType, Topic>;\n  data?: Map<any, any>;\n  config: Config;\n  rootTopicKey: KeyType;\n  editorRootTopicKey?: KeyType;\n  focusKey?: KeyType;\n  focusMode?: string;\n};\n\nconst defaultModelRecord: ModelRecordType = {\n  topics: Map(),\n  data: null,\n  config: null,\n  rootTopicKey: null,\n  editorRootTopicKey: null,\n  focusKey: null,\n  focusMode: null\n};\n\nexport class Model extends Record(defaultModelRecord) {\n  static isModel(obj) {\n    return obj instanceof Model;\n  }\n  static create(attrs: any = null): Model {\n    if (attrs == null) return Model.createEmpty();\n\n    if (Model.isModel(attrs)) {\n      return attrs;\n    }\n\n    if (isPlainObject(attrs)) {\n      return Model.fromJSON(attrs);\n    }\n\n    throw new Error(\n      `\\`Value.create\\` only accepts objects or values, but you passed it: ${attrs}`\n    );\n  }\n\n  static createEmpty(): Model {\n    const model = new Model();\n    const rootTopic = Topic.create({ key: createKey() });\n    return model\n      .update('topics', topics => topics.set(rootTopic.key, rootTopic))\n      .set('rootTopicKey', rootTopic.key);\n  }\n\n  static fromJSON(object) {\n    let model = new Model();\n    const { data = {}, topics = [], config = {}, rootTopicKey } = object;\n    let { editorRootTopicKey } = object;\n\n    if (editorRootTopicKey === undefined) editorRootTopicKey = rootTopicKey;\n\n    model = model.merge({\n      rootTopicKey,\n      editorRootTopicKey\n    });\n\n    model = model.withMutations(model => {\n      topics.forEach(topic => {\n        model.update('topics', topics =>\n          topics.set(topic.key, Topic.fromJSON(topic))\n        );\n      });\n      model.set('config', Config.fromJSON(config));\n      model.set('data', Data.fromJSON(data));\n    });\n\n    return model;\n  }\n\n  toJS() {\n    const obj = {\n      rootTopicKey: this.rootTopicKey,\n      topics: Object.values(this.topics.toJS()),\n      config: this.config,\n      data: this.data\n    };\n    return obj;\n  }\n\n  get topics(): Map<KeyType, Topic> {\n    return this.get('topics');\n  }\n\n  get config(): Config {\n    return this.get('config');\n  }\n\n  get rootTopicKey(): KeyType {\n    return this.get('rootTopicKey');\n  }\n\n  get editorRootTopicKey(): KeyType {\n    return this.get('editorRootTopicKey');\n  }\n\n  get focusKey(): KeyType {\n    return this.get('focusKey');\n  }\n\n  get focusMode(): KeyType {\n    return this.get('focusMode');\n  }\n\n  get editingContentKey(): KeyType {\n    return this.focusMode === FocusMode.EDITING_CONTENT ? this.focusKey : null;\n  }\n\n  get editingDescKey(): KeyType {\n    return this.focusMode === FocusMode.EDITING_DESC ? this.focusKey : null;\n  }\n\n  getTopic(key: KeyType): Topic {\n    return this.topics.get(key);\n  }\n\n  getParentTopic(key: KeyType): Topic {\n    const topic = this.getTopic(key);\n    return topic.parentKey ? this.getTopic(topic.parentKey) : null;\n  }\n\n  getTopicVisualLevel(key: KeyType): number {\n    let topic = this.getTopic(key);\n    let level = 0;\n    while (topic && topic.key !== this.editorRootTopicKey) {\n      level++;\n      topic = this.getParentTopic(topic.key);\n    }\n    return level;\n  }\n\n  get rootTopic() {\n    return this.getTopic(this.rootTopicKey);\n  }\n}\n","import { Model } from '../model';\nimport { KeyType, TopicRelationship } from '../../types';\n\nexport function getAllSubTopicKeys(model: Model, topicKey: KeyType): KeyType[] {\n  const item = model.getTopic(topicKey);\n\n  let res = [];\n  if (item.subKeys.size > 0) {\n    const subKeys = item.subKeys.toArray();\n    res.push(...subKeys);\n    res = subKeys.reduce((acc, key) => {\n      acc.push(...getAllSubTopicKeys(model, key));\n      return acc;\n    }, res);\n  }\n  return res;\n}\n\nexport function getRelationship(\n  model: Model,\n  srcKey: KeyType,\n  dstKey: KeyType\n): string {\n  const srcTopic = model.getTopic(srcKey);\n  const dstTopic = model.getTopic(dstKey);\n  if (srcTopic && dstTopic) {\n    if (srcTopic.parentKey == dstTopic.parentKey)\n      return TopicRelationship.SIBLING;\n    let pTopic = srcTopic;\n    while (pTopic.parentKey) {\n      if (pTopic.parentKey === dstTopic.key)\n        return TopicRelationship.DESCENDANT;\n      pTopic = model.getParentTopic(pTopic.key);\n    }\n    pTopic = dstTopic;\n    while (pTopic.parentKey) {\n      if (pTopic.parentKey === srcTopic.key) return TopicRelationship.ANCESTOR;\n      pTopic = model.getParentTopic(pTopic.key);\n    }\n  }\n  return TopicRelationship.NONE;\n}\n","import { BlockType, FocusMode } from '../../types';\nimport { Topic } from '../topic';\nimport { Block } from '../block';\nimport { IModifierArg, IModifierResult } from '../../interfaces';\nimport { createKey } from '../../utils';\nimport { getAllSubTopicKeys } from '../utils';\nimport debug from 'debug';\n\nconst log = debug('modifier');\n\nfunction toggleCollapse({ model, topicKey }: IModifierArg): IModifierResult {\n  let topic = model.getTopic(topicKey);\n  if (topic && topic.subKeys.size !== 0) {\n    topic = topic.merge({\n      collapse: !topic.collapse\n    });\n    model = model.updateIn(\n      ['topics', topic.key, 'collapse'],\n      collapse => !collapse\n    );\n  }\n  return model;\n}\n\nfunction setTopic({ model, topic }: IModifierArg): IModifierResult {\n  model = model.setIn(['topics', topic.key], topic);\n  return model;\n}\n\nfunction focusTopic({\n  model,\n  topicKey,\n  focusMode\n}: IModifierArg): IModifierResult {\n  log('focus topic');\n  if (topicKey !== model.focusKey) model = model.set('focusKey', topicKey);\n  if (focusMode !== model.focusMode) model = model.set('focusMode', focusMode);\n  return model;\n}\n\nfunction addChild({ model, topicKey }: IModifierArg): IModifierResult {\n  log('addChild:', topicKey);\n  let topic = model.getTopic(topicKey);\n  if (topic) {\n    const child = Topic.create({ key: createKey(), parentKey: topic.key });\n    topic = topic\n      .set('collapse', false)\n      .update('subKeys', subKeys => subKeys.push(child.key));\n    model = model.update('topics', topics =>\n      topics.set(topicKey, topic).set(child.key, child)\n    );\n    return focusTopic({\n      model,\n      topicKey: child.key,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n  return model;\n}\n\nfunction addSibling({ model, topicKey }: IModifierArg): IModifierResult {\n  if (topicKey === model.rootTopicKey) return model;\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const pItem = model.getTopic(topic.parentKey);\n    const idx = pItem.subKeys.indexOf(topicKey);\n    const sibling = Topic.create({ key: createKey(), parentKey: pItem.key });\n    model = model\n      .update('topics', topics => topics.set(sibling.key, sibling))\n      .updateIn(['topics', pItem.key, 'subKeys'], subKeys =>\n        subKeys.insert(idx + 1, sibling.key)\n      );\n    return focusTopic({\n      model,\n      topicKey: sibling.key,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n  return model;\n}\n\nfunction deleteTopic({ model, topicKey }: IModifierArg): IModifierResult {\n  if (topicKey === model.rootTopicKey) return model;\n  const item = model.getTopic(topicKey);\n  if (item) {\n    model = model.withMutations(m => {\n      m.update('topics', topics => {\n        topics = topics.delete(topicKey);\n        const deleteKeys = getAllSubTopicKeys(model, topicKey);\n        topics = topics.withMutations(t => {\n          deleteKeys.forEach(dKey => {\n            t.delete(dKey);\n          });\n        });\n        return topics;\n      });\n      m.updateIn(['topics', item.parentKey, 'subKeys'], subKeys =>\n        subKeys.delete(subKeys.indexOf(topicKey))\n      );\n      if (m.focusKey === topicKey)\n        m.set('focusKey', null).set('focusMode', null);\n    });\n  }\n\n  return model;\n}\n\nfunction setContent({\n  model,\n  topicKey,\n  content\n}: IModifierArg): IModifierResult {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const { index, block } = topic.getBlock(BlockType.CONTENT);\n    if (block.data !== content) {\n      model = model.updateIn(\n        ['topics', topicKey, 'blocks', index, 'data'],\n        data => content\n      );\n    }\n    return focusTopic({\n      model,\n      topicKey,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  }\n  return model;\n}\n\nfunction setStyle({ model, topicKey, style }: IModifierArg): IModifierResult {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    if (style !== topic.style) {\n      model = model.updateIn(['topics', topicKey, 'style'], s => style);\n    }\n  }\n  return model;\n}\n\nfunction setDesc({ model, topicKey, desc }: IModifierArg): IModifierResult {\n  const topic = model.getTopic(topicKey);\n  if (topic) {\n    const { index, block } = topic.getBlock(BlockType.DESC);\n    if (index === -1) {\n      model = model.updateIn(['topics', topicKey, 'blocks'], blocks =>\n        blocks.push(\n          Block.create({\n            type: BlockType.DESC,\n            data: desc\n          })\n        )\n      );\n    } else {\n      if (block.data !== desc) {\n        model = model.updateIn(\n          ['topics', topicKey, 'blocks', index, 'data'],\n          data => desc\n        );\n      }\n    }\n    return focusTopic({\n      model,\n      topicKey,\n      focusMode: FocusMode.EDITING_DESC\n    });\n  }\n  return model;\n}\n\nfunction setTheme({ model, theme }: IModifierArg): IModifierResult {\n  model = model.setIn(['config', 'theme'], theme);\n  return model;\n}\n\nfunction setLayoutDir({ model, layoutDir }: IModifierArg): IModifierResult {\n  if (model.config.layoutDir === layoutDir) return model;\n  model = model.setIn(['config', 'layoutDir'], layoutDir);\n  return model;\n}\n\nexport default {\n  addChild,\n  addSibling,\n  toggleCollapse,\n  focusTopic,\n  deleteTopic,\n  setContent,\n  setDesc,\n  setStyle,\n  setTheme,\n  setLayoutDir\n};\n","import { Block } from './block';\nimport { Config } from './config';\nimport { Model } from './model';\nimport { Topic } from './topic';\nimport { Data } from './data';\nimport Modifiers from './modifiers';\nexport * from './utils';\nexport { Block, Config, Model, Topic, Data, Modifiers };\n\nexport default {\n  Block,\n  Config,\n  Model,\n  Topic,\n  Data\n};\n","export function CorePlugin(options: any = {}) {\n  const { plugins = [] } = options;\n  return [...plugins];\n}\n","import { Model } from './models';\nimport { CorePlugin } from './plugins/core';\nimport { IDiagram, IControllerOption } from './interfaces';\nimport memoizeOne from 'memoize-one';\nimport warning from 'tiny-warning';\nimport debug from 'debug';\nimport { OnChangeFunction } from './types';\n\nconst log = debug('core:controller');\n\nfunction registerPlugin(controller: Controller, plugin: any) {\n  if (Array.isArray(plugin)) {\n    plugin.forEach(p => registerPlugin(controller, p));\n    return;\n  }\n\n  if (plugin == null) {\n    return;\n  }\n\n  for (const key in plugin) {\n    const fn = plugin[key];\n    controller.middleware[key] = controller.middleware[key] || [];\n    controller.middleware[key].push(fn);\n  }\n}\n\n// modified from koa-compose\nfunction compose(middleware) {\n  if (!Array.isArray(middleware))\n    throw new TypeError('Middleware stack must be an array!');\n  for (const fn of middleware) {\n    if (typeof fn !== 'function')\n      throw new TypeError('Middleware must be composed of functions!');\n  }\n\n  return function(context, next) {\n    // last called middleware #\n    let index = -1;\n    return dispatch(0);\n    function dispatch(i) {\n      if (i <= index) throw new Error('next() called multiple times');\n      index = i;\n      let fn = middleware[i];\n      if (i === middleware.length) fn = next;\n      if (!fn) return null;\n      try {\n        return fn(context, dispatch.bind(null, i + 1));\n      } catch (err) {\n        throw err;\n      }\n    }\n  };\n}\n\nexport class Controller {\n  diagram: IDiagram;\n  middleware: Map<string, Function[]>;\n  onChange: OnChangeFunction;\n  readOnly: boolean;\n\n  constructor(options: IControllerOption = {}) {\n    const { diagram = this, plugins = [], onChange, readOnly } = options;\n\n    this.diagram = diagram;\n    this.readOnly = readOnly;\n    this.onChange = onChange;\n    this.middleware = new Map();\n    const corePlugin = CorePlugin({ plugins });\n    registerPlugin(this, corePlugin);\n  }\n\n  run(key: string, ...args: any[]) {\n    const { middleware } = this;\n    const fns = middleware[key] || [];\n    warning(fns.length !== 0, `the middleware function ${key} is not found!`);\n    const composedFn = memoizeOne(compose)(fns);\n    // @ts-ignore\n    return composedFn(...args);\n  }\n\n  change(model: Model) {\n    this.onChange(model);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}