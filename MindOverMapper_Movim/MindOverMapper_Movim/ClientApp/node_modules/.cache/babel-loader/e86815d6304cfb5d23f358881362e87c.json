{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _class;\n\nvar _react = require(\"react\");\n\nvar React = _interopRequireWildcard(_react);\n\nvar _reactDom = require(\"react-dom\");\n\nvar _slate = require(\"slate\");\n\nvar _slateReact = require(\"slate-react\");\n\nvar _build = require(\"boundless-arrow-key-navigation/build\");\n\nvar _build2 = _interopRequireDefault(_build);\n\nvar _styledComponents = require(\"styled-components\");\n\nvar _styledComponents2 = _interopRequireDefault(_styledComponents);\n\nvar _reactKeydown = require(\"react-keydown\");\n\nvar _reactKeydown2 = _interopRequireDefault(_reactKeydown);\n\nvar _outlineIcons = require(\"outline-icons\");\n\nvar _Flex = require(\"../Flex\");\n\nvar _Flex2 = _interopRequireDefault(_Flex);\n\nvar _LinkSearchResult = require(\"./LinkSearchResult\");\n\nvar _LinkSearchResult2 = _interopRequireDefault(_LinkSearchResult);\n\nvar _ToolbarButton = require(\"./ToolbarButton\");\n\nvar _ToolbarButton2 = _interopRequireDefault(_ToolbarButton);\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  } else {\n    var newObj = {};\n\n    if (obj != null) {\n      for (var key in obj) {\n        if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n      }\n    }\n\n    newObj.default = obj;\n    return newObj;\n  }\n}\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var gen = fn.apply(this, arguments);\n    return new Promise(function (resolve, reject) {\n      function step(key, arg) {\n        try {\n          var info = gen[key](arg);\n          var value = info.value;\n        } catch (error) {\n          reject(error);\n          return;\n        }\n\n        if (info.done) {\n          resolve(value);\n        } else {\n          return Promise.resolve(value).then(function (value) {\n            step(\"next\", value);\n          }, function (err) {\n            step(\"throw\", err);\n          });\n        }\n      }\n\n      return step(\"next\");\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n}\n\nvar LinkToolbar = (0, _reactKeydown2.default)(_class = function (_React$Component) {\n  _inherits(LinkToolbar, _React$Component);\n\n  function LinkToolbar() {\n    var _ref,\n        _this2 = this;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, LinkToolbar);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = LinkToolbar.__proto__ || Object.getPrototypeOf(LinkToolbar)).call.apply(_ref, [this].concat(args))), _this), _this.originalValue = \"\", _this.state = {\n      isEditing: false,\n      isFetching: false,\n      results: []\n    }, _this.handleOutsideMouseClick = function (ev) {\n      // check if we're clicking inside the link toolbar\n      var element = (0, _reactDom.findDOMNode)(_this.wrapper);\n\n      if (!element || ev.target instanceof HTMLElement && element.contains(ev.target) || ev.button && ev.button !== 0) {\n        return;\n      } // check if we're clicking inside the link text\n\n\n      try {\n        var linkElement = (0, _slateReact.findDOMNode)(_this.props.link);\n\n        if (!linkElement || ev.target instanceof HTMLElement && linkElement.contains(ev.target) || ev.button && ev.button !== 0) {\n          return;\n        }\n      } catch (err) {} // errors finding dom node result in toolbar closing\n      // otherwise, we're clicking outside\n\n\n      ev.preventDefault();\n\n      _this.save(_this.input ? _this.input.value : \"\");\n    }, _this.search = function () {\n      var _ref2 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regenerator2.default.mark(function _callee(term) {\n        var editor, _results;\n\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                editor = _this.props.editor;\n\n                if (editor.props.onSearchLink) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                _this.setState({\n                  isFetching: true\n                });\n\n                if (!term) {\n                  _context.next = 17;\n                  break;\n                }\n\n                _context.prev = 5;\n                _context.next = 8;\n                return editor.props.onSearchLink(term);\n\n              case 8:\n                _results = _context.sent;\n\n                _this.setState({\n                  results: _results\n                });\n\n                _context.next = 15;\n                break;\n\n              case 12:\n                _context.prev = 12;\n                _context.t0 = _context[\"catch\"](5);\n                console.error(_context.t0);\n\n              case 15:\n                _context.next = 18;\n                break;\n\n              case 17:\n                _this.setState({\n                  results: []\n                });\n\n              case 18:\n                _this.setState({\n                  isFetching: false\n                });\n\n              case 19:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, _this2, [[5, 12]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }(), _this.selectSearchResult = function (ev, url) {\n      ev.preventDefault();\n\n      _this.save(url);\n    }, _this.cancel = function () {\n      _this.save(_this.originalValue);\n    }, _this.onKeyDown = function (ev) {\n      switch (ev.key) {\n        case \"Enter\":\n          ev.preventDefault();\n          if (!(ev.target instanceof HTMLInputElement)) return;\n          return _this.save(ev.target.value);\n\n        case \"Escape\":\n          ev.preventDefault();\n          ev.stopPropagation();\n          return _this.cancel();\n\n        case \"ArrowDown\":\n          ev.preventDefault();\n\n          if (_this.firstDocument) {\n            var element = (0, _reactDom.findDOMNode)(_this.firstDocument);\n            if (element instanceof HTMLElement) element.focus();\n          }\n\n          break;\n\n        default:\n      }\n    }, _this.onChange = function (ev) {\n      if (!_this.props.editor.props.onSearchLink) return;\n\n      try {\n        new URL(ev.target.value);\n      } catch (err) {\n        // this is not a valid url, show search suggestions\n        _this.search(ev.target.value);\n\n        return;\n      }\n\n      _this.setState({\n        results: []\n      });\n    }, _this.onResultKeyDown = function (ev) {\n      if (ev.key === \"Escape\") {\n        ev.preventDefault();\n        ev.stopPropagation();\n\n        _this.cancel();\n      }\n    }, _this.removeLink = function () {\n      _this.save(\"\");\n    }, _this.openLink = function (ev) {\n      var _this$props = _this.props,\n          link = _this$props.link,\n          editor = _this$props.editor;\n      var href = link.data.get(\"href\");\n\n      if (editor.props.onClickLink) {\n        ev.preventDefault();\n        editor.props.onClickLink(href);\n      } else {\n        window.open(href, \"_blank\");\n      }\n    }, _this.save = function (href) {\n      var _this$props2 = _this.props,\n          editor = _this$props2.editor,\n          link = _this$props2.link;\n      href = href.trim();\n\n      if (href) {\n        editor.setNodeByKey(link.key, {\n          type: \"link\",\n          data: {\n            href: href\n          }\n        });\n      } else if (link) {\n        editor.unwrapInlineByKey(link.key);\n      }\n\n      editor.deselect();\n\n      _this.props.onBlur();\n    }, _this.setFirstResultRef = function (ref) {\n      _this.firstDocument = ref;\n    }, _this.setWrapperRef = function (ref) {\n      _this.wrapper = ref;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(LinkToolbar, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this3 = this;\n\n      this.originalValue = this.props.link.data.get(\"href\");\n      this.setState({\n        isEditing: !!this.originalValue\n      });\n\n      if (typeof window !== \"undefined\") {\n        setImmediate(function () {\n          return window.addEventListener(\"mousedown\", _this3.handleOutsideMouseClick);\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (typeof window !== \"undefined\") {\n        window.removeEventListener(\"mousedown\", this.handleOutsideMouseClick);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var href = this.props.link.data.get(\"href\");\n      var hasResults = this.state.results.length > 0;\n      var Tooltip = this.props.editor.props.tooltip;\n      return React.createElement(\"span\", {\n        ref: this.setWrapperRef\n      }, React.createElement(LinkEditor, null, React.createElement(Input, {\n        ref: function ref(_ref3) {\n          return _this4.input = _ref3;\n        },\n        defaultValue: href,\n        placeholder: \"Search or paste a link\\u2026\",\n        onKeyDown: this.onKeyDown,\n        onChange: this.onChange,\n        autoFocus: href === \"\"\n      }), this.state.isEditing && React.createElement(_ToolbarButton2.default, {\n        onMouseDown: this.openLink\n      }, React.createElement(Tooltip, {\n        tooltip: \"Open link\",\n        placement: \"top\"\n      }, React.createElement(_outlineIcons.OpenIcon, {\n        color: this.props.theme.toolbarItem\n      }))), React.createElement(_ToolbarButton2.default, {\n        onMouseDown: this.removeLink\n      }, this.state.isEditing ? React.createElement(Tooltip, {\n        tooltip: \"Remove link\",\n        placement: \"top\"\n      }, React.createElement(_outlineIcons.TrashIcon, {\n        color: this.props.theme.toolbarItem\n      })) : React.createElement(Tooltip, {\n        tooltip: \"Discard link\",\n        placement: \"top\"\n      }, React.createElement(_outlineIcons.CloseIcon, {\n        color: this.props.theme.toolbarItem\n      })))), hasResults && React.createElement(SearchResults, null, React.createElement(_build2.default, {\n        mode: _build2.default.mode.VERTICAL,\n        defaultActiveChildIndex: 0\n      }, this.state.results.map(function (result, index) {\n        return React.createElement(_LinkSearchResult2.default, {\n          ref: function ref(_ref4) {\n            return index === 0 && _this4.setFirstResultRef(_ref4);\n          },\n          title: result.title,\n          key: result.url,\n          onClick: function onClick(ev) {\n            return _this4.selectSearchResult(ev, result.url);\n          },\n          onKeyDown: _this4.onResultKeyDown\n        });\n      }))));\n    }\n  }]);\n\n  return LinkToolbar;\n}(React.Component)) || _class;\n\nvar SearchResults = _styledComponents2.default.div.withConfig({\n  displayName: \"LinkToolbar__SearchResults\",\n  componentId: \"pbs8fd-0\"\n})([\"background:\", \";position:absolute;top:100%;width:100%;height:auto;left:0;padding:8px;margin-top:-3px;margin-bottom:0;border-radius:0 0 4px 4px;\"], function (props) {\n  return props.theme.toolbarBackground;\n});\n\nvar LinkEditor = (0, _styledComponents2.default)(_Flex2.default).withConfig({\n  displayName: \"LinkToolbar__LinkEditor\",\n  componentId: \"pbs8fd-1\"\n})([\"margin-left:-8px;margin-right:-8px;min-width:300px;\"]);\n\nvar Input = _styledComponents2.default.input.withConfig({\n  displayName: \"LinkToolbar__Input\",\n  componentId: \"pbs8fd-2\"\n})([\"font-size:15px;background:\", \";color:\", \";border-radius:2px;padding:4px 8px;border:0;margin:0;outline:none;flex-grow:1;\"], function (props) {\n  return props.theme.toolbarInput;\n}, function (props) {\n  return props.theme.toolbarItem;\n});\n\nexports.default = (0, _styledComponents.withTheme)(LinkToolbar);","map":{"version":3,"sources":["C:/Users/ayomi/source/repos/Idea-Creator/Idea-Creator/MindOverMapper_Movim/MindOverMapper_Movim/ClientApp/node_modules/awehook-rich-markdown-editor/lib/components/Toolbar/LinkToolbar.js"],"names":["Object","defineProperty","exports","value","_regenerator","require","_regenerator2","_interopRequireDefault","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_class","_react","React","_interopRequireWildcard","_reactDom","_slate","_slateReact","_build","_build2","_styledComponents","_styledComponents2","_reactKeydown","_reactKeydown2","_outlineIcons","_Flex","_Flex2","_LinkSearchResult","_LinkSearchResult2","_ToolbarButton","_ToolbarButton2","obj","__esModule","newObj","hasOwnProperty","call","default","_asyncToGenerator","fn","gen","apply","arguments","Promise","resolve","reject","step","arg","info","error","done","then","err","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","LinkToolbar","_React$Component","_ref","_this2","_temp","_this","_ret","_len","args","Array","_key","getPrototypeOf","concat","originalValue","state","isEditing","isFetching","results","handleOutsideMouseClick","ev","element","findDOMNode","wrapper","HTMLElement","contains","button","linkElement","link","preventDefault","save","input","search","_ref2","mark","_callee","term","editor","_results","wrap","_callee$","_context","prev","next","onSearchLink","abrupt","setState","sent","t0","console","stop","_x","selectSearchResult","url","cancel","onKeyDown","HTMLInputElement","stopPropagation","firstDocument","focus","onChange","URL","onResultKeyDown","removeLink","openLink","_this$props","href","data","get","onClickLink","window","open","_this$props2","trim","setNodeByKey","type","unwrapInlineByKey","deselect","onBlur","setFirstResultRef","ref","setWrapperRef","componentDidMount","_this3","setImmediate","addEventListener","componentWillUnmount","removeEventListener","render","_this4","hasResults","Tooltip","tooltip","createElement","LinkEditor","Input","_ref3","defaultValue","placeholder","autoFocus","onMouseDown","placement","OpenIcon","color","theme","toolbarItem","TrashIcon","CloseIcon","SearchResults","mode","VERTICAL","defaultActiveChildIndex","map","result","index","_ref4","title","onClick","Component","div","withConfig","displayName","componentId","toolbarBackground","toolbarInput","withTheme"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _regenerator = require(\"babel-runtime/regenerator\");\n\nvar _regenerator2 = _interopRequireDefault(_regenerator);\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _class;\n\nvar _react = require(\"react\");\n\nvar React = _interopRequireWildcard(_react);\n\nvar _reactDom = require(\"react-dom\");\n\nvar _slate = require(\"slate\");\n\nvar _slateReact = require(\"slate-react\");\n\nvar _build = require(\"boundless-arrow-key-navigation/build\");\n\nvar _build2 = _interopRequireDefault(_build);\n\nvar _styledComponents = require(\"styled-components\");\n\nvar _styledComponents2 = _interopRequireDefault(_styledComponents);\n\nvar _reactKeydown = require(\"react-keydown\");\n\nvar _reactKeydown2 = _interopRequireDefault(_reactKeydown);\n\nvar _outlineIcons = require(\"outline-icons\");\n\nvar _Flex = require(\"../Flex\");\n\nvar _Flex2 = _interopRequireDefault(_Flex);\n\nvar _LinkSearchResult = require(\"./LinkSearchResult\");\n\nvar _LinkSearchResult2 = _interopRequireDefault(_LinkSearchResult);\n\nvar _ToolbarButton = require(\"./ToolbarButton\");\n\nvar _ToolbarButton2 = _interopRequireDefault(_ToolbarButton);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar LinkToolbar = (0, _reactKeydown2.default)(_class = function (_React$Component) {\n  _inherits(LinkToolbar, _React$Component);\n\n  function LinkToolbar() {\n    var _ref,\n        _this2 = this;\n\n    var _temp, _this, _ret;\n\n    _classCallCheck(this, LinkToolbar);\n\n    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return _ret = (_temp = (_this = _possibleConstructorReturn(this, (_ref = LinkToolbar.__proto__ || Object.getPrototypeOf(LinkToolbar)).call.apply(_ref, [this].concat(args))), _this), _this.originalValue = \"\", _this.state = {\n      isEditing: false,\n      isFetching: false,\n      results: []\n    }, _this.handleOutsideMouseClick = function (ev) {\n      // check if we're clicking inside the link toolbar\n      var element = (0, _reactDom.findDOMNode)(_this.wrapper);\n      if (!element || ev.target instanceof HTMLElement && element.contains(ev.target) || ev.button && ev.button !== 0) {\n        return;\n      }\n\n      // check if we're clicking inside the link text\n      try {\n        var linkElement = (0, _slateReact.findDOMNode)(_this.props.link);\n\n        if (!linkElement || ev.target instanceof HTMLElement && linkElement.contains(ev.target) || ev.button && ev.button !== 0) {\n          return;\n        }\n      } catch (err) {}\n      // errors finding dom node result in toolbar closing\n\n\n      // otherwise, we're clicking outside\n      ev.preventDefault();\n      _this.save(_this.input ? _this.input.value : \"\");\n    }, _this.search = function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regenerator2.default.mark(function _callee(term) {\n        var editor, _results;\n\n        return _regenerator2.default.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                editor = _this.props.editor;\n\n                if (editor.props.onSearchLink) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n\n                _this.setState({ isFetching: true });\n\n                if (!term) {\n                  _context.next = 17;\n                  break;\n                }\n\n                _context.prev = 5;\n                _context.next = 8;\n                return editor.props.onSearchLink(term);\n\n              case 8:\n                _results = _context.sent;\n\n                _this.setState({ results: _results });\n                _context.next = 15;\n                break;\n\n              case 12:\n                _context.prev = 12;\n                _context.t0 = _context[\"catch\"](5);\n\n                console.error(_context.t0);\n\n              case 15:\n                _context.next = 18;\n                break;\n\n              case 17:\n                _this.setState({ results: [] });\n\n              case 18:\n\n                _this.setState({ isFetching: false });\n\n              case 19:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, _this2, [[5, 12]]);\n      }));\n\n      return function (_x) {\n        return _ref2.apply(this, arguments);\n      };\n    }(), _this.selectSearchResult = function (ev, url) {\n      ev.preventDefault();\n      _this.save(url);\n    }, _this.cancel = function () {\n      _this.save(_this.originalValue);\n    }, _this.onKeyDown = function (ev) {\n      switch (ev.key) {\n        case \"Enter\":\n          ev.preventDefault();\n          if (!(ev.target instanceof HTMLInputElement)) return;\n          return _this.save(ev.target.value);\n        case \"Escape\":\n          ev.preventDefault();\n          ev.stopPropagation();\n          return _this.cancel();\n        case \"ArrowDown\":\n          ev.preventDefault();\n          if (_this.firstDocument) {\n            var element = (0, _reactDom.findDOMNode)(_this.firstDocument);\n            if (element instanceof HTMLElement) element.focus();\n          }\n          break;\n        default:\n      }\n    }, _this.onChange = function (ev) {\n      if (!_this.props.editor.props.onSearchLink) return;\n\n      try {\n        new URL(ev.target.value);\n      } catch (err) {\n        // this is not a valid url, show search suggestions\n        _this.search(ev.target.value);\n        return;\n      }\n      _this.setState({ results: [] });\n    }, _this.onResultKeyDown = function (ev) {\n      if (ev.key === \"Escape\") {\n        ev.preventDefault();\n        ev.stopPropagation();\n        _this.cancel();\n      }\n    }, _this.removeLink = function () {\n      _this.save(\"\");\n    }, _this.openLink = function (ev) {\n      var _this$props = _this.props,\n          link = _this$props.link,\n          editor = _this$props.editor;\n\n      var href = link.data.get(\"href\");\n\n      if (editor.props.onClickLink) {\n        ev.preventDefault();\n        editor.props.onClickLink(href);\n      } else {\n        window.open(href, \"_blank\");\n      }\n    }, _this.save = function (href) {\n      var _this$props2 = _this.props,\n          editor = _this$props2.editor,\n          link = _this$props2.link;\n\n      href = href.trim();\n\n      if (href) {\n        editor.setNodeByKey(link.key, { type: \"link\", data: { href: href } });\n      } else if (link) {\n        editor.unwrapInlineByKey(link.key);\n      }\n      editor.deselect();\n      _this.props.onBlur();\n    }, _this.setFirstResultRef = function (ref) {\n      _this.firstDocument = ref;\n    }, _this.setWrapperRef = function (ref) {\n      _this.wrapper = ref;\n    }, _temp), _possibleConstructorReturn(_this, _ret);\n  }\n\n  _createClass(LinkToolbar, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this3 = this;\n\n      this.originalValue = this.props.link.data.get(\"href\");\n      this.setState({ isEditing: !!this.originalValue });\n\n      if (typeof window !== \"undefined\") {\n        setImmediate(function () {\n          return window.addEventListener(\"mousedown\", _this3.handleOutsideMouseClick);\n        });\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (typeof window !== \"undefined\") {\n        window.removeEventListener(\"mousedown\", this.handleOutsideMouseClick);\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var href = this.props.link.data.get(\"href\");\n      var hasResults = this.state.results.length > 0;\n      var Tooltip = this.props.editor.props.tooltip;\n\n      return React.createElement(\n        \"span\",\n        { ref: this.setWrapperRef },\n        React.createElement(\n          LinkEditor,\n          null,\n          React.createElement(Input, {\n            ref: function ref(_ref3) {\n              return _this4.input = _ref3;\n            },\n            defaultValue: href,\n            placeholder: \"Search or paste a link\\u2026\",\n            onKeyDown: this.onKeyDown,\n            onChange: this.onChange,\n            autoFocus: href === \"\"\n          }),\n          this.state.isEditing && React.createElement(\n            _ToolbarButton2.default,\n            { onMouseDown: this.openLink },\n            React.createElement(\n              Tooltip,\n              { tooltip: \"Open link\", placement: \"top\" },\n              React.createElement(_outlineIcons.OpenIcon, { color: this.props.theme.toolbarItem })\n            )\n          ),\n          React.createElement(\n            _ToolbarButton2.default,\n            { onMouseDown: this.removeLink },\n            this.state.isEditing ? React.createElement(\n              Tooltip,\n              { tooltip: \"Remove link\", placement: \"top\" },\n              React.createElement(_outlineIcons.TrashIcon, { color: this.props.theme.toolbarItem })\n            ) : React.createElement(\n              Tooltip,\n              { tooltip: \"Discard link\", placement: \"top\" },\n              React.createElement(_outlineIcons.CloseIcon, { color: this.props.theme.toolbarItem })\n            )\n          )\n        ),\n        hasResults && React.createElement(\n          SearchResults,\n          null,\n          React.createElement(\n            _build2.default,\n            {\n              mode: _build2.default.mode.VERTICAL,\n              defaultActiveChildIndex: 0\n            },\n            this.state.results.map(function (result, index) {\n              return React.createElement(_LinkSearchResult2.default, {\n                ref: function ref(_ref4) {\n                  return index === 0 && _this4.setFirstResultRef(_ref4);\n                },\n                title: result.title,\n                key: result.url,\n                onClick: function onClick(ev) {\n                  return _this4.selectSearchResult(ev, result.url);\n                },\n                onKeyDown: _this4.onResultKeyDown\n              });\n            })\n          )\n        )\n      );\n    }\n  }]);\n\n  return LinkToolbar;\n}(React.Component)) || _class;\n\nvar SearchResults = _styledComponents2.default.div.withConfig({\n  displayName: \"LinkToolbar__SearchResults\",\n  componentId: \"pbs8fd-0\"\n})([\"background:\", \";position:absolute;top:100%;width:100%;height:auto;left:0;padding:8px;margin-top:-3px;margin-bottom:0;border-radius:0 0 4px 4px;\"], function (props) {\n  return props.theme.toolbarBackground;\n});\n\nvar LinkEditor = (0, _styledComponents2.default)(_Flex2.default).withConfig({\n  displayName: \"LinkToolbar__LinkEditor\",\n  componentId: \"pbs8fd-1\"\n})([\"margin-left:-8px;margin-right:-8px;min-width:300px;\"]);\n\nvar Input = _styledComponents2.default.input.withConfig({\n  displayName: \"LinkToolbar__Input\",\n  componentId: \"pbs8fd-2\"\n})([\"font-size:15px;background:\", \";color:\", \";border-radius:2px;padding:4px 8px;border:0;margin:0;outline:none;flex-grow:1;\"], function (props) {\n  return props.theme.toolbarInput;\n}, function (props) {\n  return props.theme.toolbarItem;\n});\n\nexports.default = (0, _styledComponents.withTheme)(LinkToolbar);"]},"metadata":{},"sourceType":"script"}