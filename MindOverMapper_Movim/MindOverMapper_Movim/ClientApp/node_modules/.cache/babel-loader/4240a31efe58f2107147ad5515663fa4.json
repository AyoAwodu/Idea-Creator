{"ast":null,"code":"import { PureComponent, Component, createElement, Fragment } from 'react';\nimport memoizeOne from 'memoize-one';\nimport { ContextMenuTarget, Menu, MenuItem, Button, Popover, Dialog, Classes, Hotkey, Hotkeys, HotkeysTarget } from '@blueprintjs/core';\nimport { ModelModifier, FocusMode, BlockType, TopicDirection, DiagramLayoutType, TopicVisualLevel, getRelationship, TopicRelationship, Controller } from '@blink-mind/core';\nimport styled, { css, ThemeProvider } from 'styled-components';\nimport debug from 'debug';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport { Stack, List } from 'immutable';\nimport cx from 'classnames';\nimport { Select } from '@blueprintjs/select';\nimport { SketchPicker } from 'react-color';\nimport { isEqual } from 'lodash';\nimport '@blueprintjs/core/lib/css/blueprint.css';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\nvar extendStatics = function (d, b) {\n  extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n  };\n\n  return extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nvar __assign = function () {\n  __assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nfunction __decorate(decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n}\n\nfunction __values(o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function () {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n}\n\nfunction __read(o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n}\n\nfunction __spread() {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n}\n\nfunction __makeTemplateObject(cooked, raw) {\n  if (Object.defineProperty) {\n    Object.defineProperty(cooked, \"raw\", {\n      value: raw\n    });\n  } else {\n    cooked.raw = raw;\n  }\n\n  return cooked;\n}\n\nvar BaseWidget =\n/** @class */\nfunction (_super) {\n  __extends(BaseWidget, _super);\n\n  function BaseWidget(props) {\n    return _super.call(this, props) || this;\n  }\n\n  BaseWidget.prototype.operation = function (opType, arg) {\n    this.props.controller.run('operation', __assign({\n      opType: opType\n    }, arg));\n  };\n\n  BaseWidget.prototype.run = function (name, arg) {\n    this.props.controller.run(name, arg);\n  };\n\n  Object.defineProperty(BaseWidget.prototype, \"topic\", {\n    get: function () {\n      return this.props.model.getTopic(this.props.topicKey);\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return BaseWidget;\n}(PureComponent);\n\nvar SaveRef =\n/** @class */\nfunction (_super) {\n  __extends(SaveRef, _super);\n\n  function SaveRef() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.getRef = function (name) {\n      return _this[name];\n    };\n\n    _this.saveRef = function (name) {\n      return function (node) {\n        if (node) {\n          _this[name] = node;\n\n          _this.fireListener(name, node);\n        }\n      };\n    };\n\n    _this.observers = new Map();\n\n    _this.fireListener = function (name, ref) {\n      var e_1, _a;\n\n      if (_this.observers.has(name)) {\n        var listeners = _this.observers.get(name);\n\n        try {\n          for (var listeners_1 = __values(listeners), listeners_1_1 = listeners_1.next(); !listeners_1_1.done; listeners_1_1 = listeners_1.next()) {\n            var listener = listeners_1_1.value;\n            listener(name, ref);\n          }\n        } catch (e_1_1) {\n          e_1 = {\n            error: e_1_1\n          };\n        } finally {\n          try {\n            if (listeners_1_1 && !listeners_1_1.done && (_a = listeners_1.return)) _a.call(listeners_1);\n          } finally {\n            if (e_1) throw e_1.error;\n          }\n        }\n      }\n    };\n\n    _this.registerRefListener = function (name, listener) {\n      if (!_this.observers.has(name)) {\n        _this.observers.set(name, [listener]);\n      } else {\n        _this.observers.get(name).push(listener);\n      }\n    };\n\n    return _this;\n  }\n\n  SaveRef.prototype.render = function () {\n    return this.props.children(this.saveRef, this.getRef, this.registerRefListener.bind(this));\n  };\n\n  return SaveRef;\n}(Component);\n\nvar log = debug('node:drag-scroll-widget');\nvar DragScrollView = styled.div(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\n  position: relative;\\n  width: 100%;\\n  height: 100%;\\n  overflow: scroll;\\n\"], [\"\\n  position: relative;\\n  width: 100%;\\n  height: 100%;\\n  overflow: scroll;\\n\"])));\nvar DragScrollContent = styled.div(templateObject_2 || (templateObject_2 = __makeTemplateObject([\"\\n  position: relative;\\n  width: max-content;\\n\"], [\"\\n  position: relative;\\n  width: max-content;\\n\"])));\n\nvar DragScrollWidget =\n/** @class */\nfunction (_super) {\n  __extends(DragScrollWidget, _super);\n\n  function DragScrollWidget(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.contentResizeCallback = function (entries, observer) {\n      if (_this.oldContentRect) {\n        var widgetStyle = {\n          width: _this.content.clientWidth + _this.viewBox.clientWidth * 2,\n          height: _this.content.clientHeight + _this.viewBox.clientHeight * 2\n        };\n        _this.bigView.style.width = widgetStyle.width + 'px';\n        _this.bigView.style.height = widgetStyle.height + 'px';\n      }\n\n      _this.oldContentRect = entries[0].contentRect;\n    };\n\n    _this.contentResizeObserver = new ResizeObserver(_this.contentResizeCallback);\n\n    _this.contentRef = function (ref) {\n      if (ref) {\n        _this.content = ref;\n\n        _this.contentResizeObserver.observe(_this.content);\n      }\n    };\n\n    _this.viewBoxRef = function (ref) {\n      if (ref) {\n        _this.viewBox = ref;\n\n        _this.setViewBoxScroll(_this.viewBox.clientWidth, _this.viewBox.clientHeight);\n      }\n    };\n\n    _this.bigViewRef = function (ref) {\n      if (ref) {\n        _this.bigView = ref;\n      }\n    };\n\n    _this.setWidgetStyle = function () {\n      if (_this.content && _this.viewBox && _this.bigView) {\n        _this.bigView.style.width = (_this.content.clientWidth + _this.viewBox.clientWidth) * 2 + 'px';\n        _this.bigView.style.height = (_this.content.clientHeight + _this.viewBox.clientHeight) * 2 + 'px';\n        _this.content.style.left = _this.viewBox.clientWidth + 'px';\n        _this.content.style.top = _this.viewBox.clientHeight + 'px';\n      }\n    };\n\n    _this.setViewBoxScroll = function (left, top) {\n      log(\"setViewBoxScroll \" + left + \" \" + top);\n\n      if (_this.viewBox) {\n        _this.viewBox.scrollLeft = left;\n        _this.viewBox.scrollTop = top;\n      }\n    };\n\n    _this.setViewBoxScrollDelta = function (deltaLeft, deltaTop) {\n      log(\"setViewBoxScrollDelta \" + deltaLeft + \" \" + deltaTop);\n\n      if (_this.viewBox) {\n        _this.viewBox.scrollLeft += deltaLeft;\n        _this.viewBox.scrollTop += deltaTop;\n      }\n    };\n\n    _this.onMouseDown = function (e) {\n      // log('Drag Scroll onMouseDown');\n      // log(e.nativeEvent.target);\n      // mouseKey 表示鼠标按下那个键才可以进行拖动，左键或者右键\n      // needKeyPressed 为了支持是否需要按下ctrl键，才可以进行拖动\n      // canDragFunc是一个函数，它是为了支持使用者以传入函数的方式，这个函数的返回值表示当前的内容是否可以被拖拽而移动\n      var _a = _this.props,\n          mouseKey = _a.mouseKey,\n          needKeyPressed = _a.needKeyPressed,\n          canDragFunc = _a.canDragFunc;\n      if (canDragFunc && !canDragFunc()) return;\n\n      if (e.button === 0 && mouseKey === 'left' || e.button === 2 && mouseKey === 'right') {\n        if (needKeyPressed) {\n          if (!e.ctrlKey) return;\n        }\n\n        _this._lastCoordX = _this.viewBox.scrollLeft + e.nativeEvent.clientX;\n        _this._lastCoordY = _this.viewBox.scrollTop + e.nativeEvent.clientY;\n        window.addEventListener('mousemove', _this.onMouseMove);\n        window.addEventListener('mouseup', _this.onMouseUp);\n      }\n    };\n\n    _this.onMouseUp = function (e) {\n      window.removeEventListener('mousemove', _this.onMouseMove);\n      window.removeEventListener('mouseup', _this.onMouseUp);\n    };\n\n    _this.onMouseMove = function (e) {\n      _this.viewBox.scrollLeft = _this._lastCoordX - e.clientX;\n      _this.viewBox.scrollTop = _this._lastCoordY - e.clientY; // log(`onMouseMove ${this.viewBox.scrollLeft} ${this.viewBox.scrollTop}`);\n    };\n\n    _this.handleContextMenu = function (e) {\n      e.preventDefault();\n    };\n\n    _this.state = {\n      widgetStyle: {\n        width: '10000px',\n        height: '10000px'\n      }\n    };\n    return _this;\n  }\n\n  DragScrollWidget.prototype.componentDidMount = function () {\n    this.setWidgetStyle();\n    document.addEventListener('contextmenu', this.handleContextMenu);\n  };\n\n  DragScrollWidget.prototype.componentWillUnmount = function () {\n    document.removeEventListener('contextmenu', this.handleContextMenu);\n  };\n\n  DragScrollWidget.prototype.render = function () {\n    return createElement(DragScrollView, {\n      ref: this.viewBoxRef,\n      onMouseDown: this.onMouseDown\n    }, createElement(\"div\", {\n      style: this.state.widgetStyle,\n      ref: this.bigViewRef\n    }, createElement(DragScrollContent, {\n      ref: this.contentRef,\n      style: this.state.contentStyle\n    }, this.props.children(this.setViewBoxScroll, this.setViewBoxScrollDelta))));\n  };\n\n  DragScrollWidget.defaultProps = {\n    mouseKey: 'left',\n    needKeyPressed: false\n  };\n  return DragScrollWidget;\n}(Component);\n\nvar templateObject_1, templateObject_2;\nvar log$1 = debug('plugin:operation');\nvar OpType = {\n  TOGGLE_COLLAPSE: 'TOGGLE_COLLAPSE',\n  ADD_CHILD: 'ADD_CHILD',\n  ADD_SIBLING: 'ADD_SIBLING',\n  DELETE_TOPIC: 'DELETE_TOPIC',\n  FOCUS_TOPIC: 'FOCUS_TOPIC',\n  SET_STYLE: 'SET_STYLE',\n  SET_TOPIC_CONTENT: 'SET_TOPIC_CONTENT',\n  SET_TOPIC_DESC: 'SET_TOPIC_DESC',\n  START_EDITING_CONTENT: 'START_EDITING_CONTENT',\n  START_EDITING_DESC: 'START_EDITING_DESC',\n  DRAG_AND_DROP: 'DRAG_AND_DROP'\n};\n\nfunction OperationPlugin() {\n  var startEditingContent = function (_a) {\n    var model = _a.model,\n        topicKey = _a.topicKey;\n    return ModelModifier.focusTopic({\n      model: model,\n      topicKey: topicKey,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  };\n\n  var startEditingDesc = function (_a) {\n    var model = _a.model,\n        topicKey = _a.topicKey;\n    var topic = model.getTopic(topicKey);\n    var desc = topic.getBlock(BlockType.DESC);\n\n    if (desc.block == null || desc.block.data == null) {\n      model = ModelModifier.setDesc({\n        model: model,\n        topicKey: topicKey,\n        desc: ''\n      });\n    }\n\n    return ModelModifier.focusTopic({\n      model: model,\n      topicKey: topicKey,\n      focusMode: FocusMode.EDITING_DESC\n    });\n  };\n\n  function dragAndDrop(props) {\n    var srcKey = props.srcKey,\n        dstKey = props.dstKey,\n        dropDir = props.dropDir;\n    var model = props.model;\n    var srcTopic = model.getTopic(srcKey);\n    var dstTopic = model.getTopic(dstKey);\n    var srcParentKey = srcTopic.parentKey;\n    var srcParentTopic = model.getTopic(srcParentKey);\n    var srcParentSubKeys = srcParentTopic.subKeys;\n    var srcIndex = srcParentSubKeys.indexOf(srcKey);\n    srcParentSubKeys = srcParentSubKeys.delete(srcIndex);\n\n    if (dropDir === 'in') {\n      var dstSubKeys_1 = dstTopic.subKeys;\n      dstSubKeys_1 = dstSubKeys_1.push(srcKey);\n      model = model.withMutations(function (m) {\n        m.setIn(['topics', srcParentKey, 'subKeys'], srcParentSubKeys).setIn(['topics', srcKey, 'parentKey'], dstKey).setIn(['topics', dstKey, 'subKeys'], dstSubKeys_1).setIn(['topics', dstKey, 'collapse'], false);\n      });\n    } else {\n      var dstParentKey_1 = dstTopic.parentKey;\n      var dstParentItem = model.getTopic(dstParentKey_1);\n      var dstParentSubKeys_1 = dstParentItem.subKeys;\n      var dstIndex = dstParentSubKeys_1.indexOf(dstKey); //src 和 dst 的父亲相同，这种情况要做特殊处理\n\n      if (srcParentKey === dstParentKey_1) {\n        var newDstParentSubKeys_1 = List();\n        dstParentSubKeys_1.forEach(function (key) {\n          if (key !== srcKey) {\n            if (key === dstKey) {\n              if (dropDir === 'prev') {\n                newDstParentSubKeys_1 = newDstParentSubKeys_1.push(srcKey).push(key);\n              } else {\n                newDstParentSubKeys_1 = newDstParentSubKeys_1.push(key).push(srcKey);\n              }\n            } else {\n              newDstParentSubKeys_1 = newDstParentSubKeys_1.push(key);\n            }\n          }\n        });\n        model = model.withMutations(function (m) {\n          m.setIn(['topics', dstParentKey_1, 'subKeys'], newDstParentSubKeys_1);\n        });\n      } else {\n        if (dropDir === 'prev') {\n          dstParentSubKeys_1 = dstParentSubKeys_1.insert(dstIndex, srcKey);\n        } else if (dropDir === 'next') {\n          dstParentSubKeys_1 = dstParentSubKeys_1.insert(dstIndex + 1, srcKey);\n        }\n\n        model = model.withMutations(function (m) {\n          m.setIn(['topics', srcParentKey, 'subKeys'], srcParentSubKeys).setIn(['topics', srcKey, 'parentKey'], dstParentKey_1).setIn(['topics', dstParentKey_1, 'subKeys'], dstParentSubKeys_1).setIn(['topics', dstParentKey_1, 'collapse'], false);\n        });\n      }\n    }\n\n    return model;\n  }\n\n  var OpMap = new Map([[OpType.TOGGLE_COLLAPSE, ModelModifier.toggleCollapse], [OpType.ADD_CHILD, ModelModifier.addChild], [OpType.ADD_SIBLING, ModelModifier.addSibling], [OpType.DELETE_TOPIC, ModelModifier.deleteTopic], [OpType.FOCUS_TOPIC, ModelModifier.focusTopic], [OpType.SET_STYLE, ModelModifier.setStyle], [OpType.SET_TOPIC_CONTENT, ModelModifier.setContent], [OpType.SET_TOPIC_DESC, ModelModifier.setDesc], [OpType.START_EDITING_CONTENT, startEditingContent], [OpType.START_EDITING_DESC, startEditingDesc], [OpType.DRAG_AND_DROP, dragAndDrop]]);\n  var undoStack = Stack();\n  var redoStack = Stack();\n  return {\n    getAllowUndo: function (props) {\n      var model = props.model,\n          opType = props.opType;\n\n      if (opType) {\n        switch (opType) {\n          case OpType.FOCUS_TOPIC:\n          case OpType.START_EDITING_CONTENT:\n            return false;\n        }\n      }\n\n      return model.config.allowUndo;\n    },\n    getUndoRedoStack: function () {\n      return {\n        undoStack: undoStack,\n        redoStack: redoStack\n      };\n    },\n    setUndoStack: function (props) {\n      log$1('setUndoStack', props.undoStack);\n      undoStack = props.undoStack;\n    },\n    setRedoStack: function (props) {\n      log$1('setRedoStack', props.redoStack);\n      redoStack = props.redoStack;\n    },\n    canUndo: function (props) {\n      var controller = props.controller;\n      var undoStack = controller.run('getUndoRedoStack', props).undoStack;\n      var allowUndo = controller.run('getAllowUndo', props);\n      return undoStack.size > 0 && allowUndo;\n    },\n    canRedo: function (props) {\n      var controller = props.controller;\n      var redoStack = controller.run('getUndoRedoStack', props).redoStack;\n      var allowUndo = controller.run('getAllowUndo', props);\n      return redoStack.size > 0 && allowUndo;\n    },\n    undo: function (props) {\n      var controller = props.controller,\n          model = props.model;\n\n      if (!controller.run('getAllowUndo', props)) {\n        return;\n      }\n\n      var _a = controller.run('getUndoRedoStack', props),\n          undoStack = _a.undoStack,\n          redoStack = _a.redoStack;\n\n      var newModel = undoStack.peek();\n      if (!newModel) return;\n      controller.run('setUndoStack', __assign(__assign({}, props), {\n        undoStack: undoStack.shift()\n      }));\n      controller.run('setRedoStack', __assign(__assign({}, props), {\n        redoStack: redoStack.push(model)\n      }));\n      log$1(newModel);\n      controller.change(newModel);\n    },\n    redo: function (props) {\n      var controller = props.controller,\n          model = props.model;\n\n      if (!controller.run('getAllowUndo', props)) {\n        return;\n      }\n\n      var _a = controller.run('getUndoRedoStack', props),\n          undoStack = _a.undoStack,\n          redoStack = _a.redoStack;\n\n      var newModel = redoStack.peek();\n      if (!newModel) return;\n      controller.run('setUndoStack', __assign(__assign({}, props), {\n        undoStack: undoStack.push(model)\n      }));\n      controller.run('setRedoStack', __assign(__assign({}, props), {\n        redoStack: redoStack.shift()\n      }));\n      controller.change(newModel);\n    },\n    beforeOperation: function (props) {},\n    operation: function (props) {\n      var opType = props.opType,\n          controller = props.controller,\n          model = props.model;\n      log$1('operation:', opType);\n      controller.run('beforeOperation', props);\n\n      if (OpMap.has(opType)) {\n        if (controller.run('getAllowUndo', props)) {\n          var undoStack_1 = controller.run('getUndoRedoStack', props).undoStack;\n          controller.run('setUndoStack', __assign(__assign({}, props), {\n            undoStack: undoStack_1.push(model)\n          }));\n        }\n\n        var opFunc = OpMap.get(opType);\n        var newModel = opFunc(props);\n        controller.change(newModel);\n      }\n\n      controller.run('afterOperation', props);\n    },\n    afterOperation: function (props) {}\n  };\n}\n\nvar IconName = {\n  SHOW_MENU: 'show-menu',\n  CLOSE: 'close',\n  COLOR_PICKER: 'color-picker',\n  NOTES: 'notes'\n};\n\nfunction iconClassName(name) {\n  return \"icon iconfont bm-\" + name;\n}\n\nfunction Icon(iconName) {\n  return createElement(\"span\", {\n    className: iconClassName(iconName)\n  });\n}\n\nfunction contentRefKey(key) {\n  return \"content-\" + key;\n}\n\nfunction topicRefKey(key) {\n  return \"topic-\" + key;\n}\n\nfunction linksRefKey(key) {\n  return \"links-\" + key;\n}\n\nfunction linksSvgRefKey(key) {\n  return \"links-svg-\" + key;\n}\n\nfunction collapseRefKey(key) {\n  return \"collapse-\" + key;\n}\n\nfunction getLinkKey(fromKey, toKey) {\n  return \"link-\" + fromKey + \"-\" + toKey;\n}\n\nfunction centerY(rect) {\n  return (rect.top + rect.bottom) / 2;\n}\n\nfunction centerX(rect) {\n  return (rect.left + rect.right) / 2;\n}\n\nfunction centerPointX(p1, p2) {\n  return (p1.x + p2.x) / 2;\n}\n\nfunction centerPointY(p1, p2) {\n  return (p1.y + p2.y) / 2;\n}\n\nvar log$2 = debug('node:topic-content-widget');\nvar TopicContent = styled.div(templateObject_1$1 || (templateObject_1$1 = __makeTemplateObject([\"\\n  display: flex;\\n  align-items: center;\\n  word-wrap: break-word;\\n  white-space: pre-line;\\n  cursor: pointer;\\n  overflow: hidden;\\n\"], [\"\\n  display: flex;\\n  align-items: center;\\n  word-wrap: break-word;\\n  white-space: pre-line;\\n  cursor: pointer;\\n  overflow: hidden;\\n\"])));\nvar TopicContentWithDropArea = styled.div(templateObject_2$1 || (templateObject_2$1 = __makeTemplateObject([\"\\n  position: relative;\\n\"], [\"\\n  position: relative;\\n\"])));\n\nvar TopicContentWidget =\n/** @class */\nfunction (_super) {\n  __extends(TopicContentWidget, _super);\n\n  function TopicContentWidget(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.onDragStart = function (ev) {\n      _this.run('handleTopicDragStart', __assign(__assign({}, _this.props), {\n        ev: ev\n      }));\n    };\n\n    _this.onDragOver = function (ev) {\n      ev.preventDefault();\n    };\n\n    _this.onDragEnter = function (ev) {\n      _this.run('handleTopicDragEnter', __assign(__assign({}, _this.props), {\n        ev: ev,\n        dropDir: 'in'\n      }));\n    };\n\n    _this.onDragLeave = function (ev) {\n      _this.run('handleTopicDragLeave', __assign(__assign({}, _this.props), {\n        ev: ev,\n        dropDir: 'in'\n      }));\n    };\n\n    _this.onDrop = function (ev) {\n      _this.run('handleTopicDrop', __assign(__assign({}, _this.props), {\n        ev: ev,\n        dropDir: 'in'\n      }));\n    };\n\n    _this.onClick = function (ev) {\n      _this.isDoubleClick = false;\n      log$2(ev.nativeEvent);\n      var props = _this.props;\n      var controller = props.controller;\n      setTimeout(function () {\n        if (!_this.isDoubleClick) {\n          controller.run('handleTopicClick', __assign(__assign({}, props), {\n            ev: ev\n          }));\n        }\n      });\n    };\n\n    _this.onDoubleClick = function (ev) {\n      _this.isDoubleClick = true;\n      var controller = _this.props.controller;\n      controller.run('handleTopicDoubleClick', __assign(__assign({}, _this.props), {\n        ev: ev\n      }));\n    };\n\n    _this.onContextMenu = function (ev) {\n      var controller = _this.props.controller;\n      controller.run('handleTopicContextMenu', __assign(__assign({}, _this.props), {\n        ev: ev\n      }));\n\n      _this.setState({\n        showPopMenu: true\n      });\n    };\n\n    _this.handlePopMenuVisibleChange = function (visible) {\n      _this.setState({\n        showPopMenu: visible\n      });\n    };\n\n    _this.needRelocation = false;\n\n    _this.onClickCollapse = function (e) {\n      e.stopPropagation();\n      var _a = _this.props,\n          topicKey = _a.topicKey,\n          getRef = _a.getRef;\n      _this.needRelocation = true;\n      _this.oldCollapseIconRect = getRef(collapseRefKey(topicKey)).getBoundingClientRect();\n\n      _this.operation(OpType.TOGGLE_COLLAPSE, _this.props);\n    };\n\n    _this.state = {\n      dragEnter: false,\n      showPopMenu: false\n    };\n    return _this;\n  }\n\n  TopicContentWidget.prototype.renderContextMenu = function () {\n    var controller = this.props.controller;\n    return controller.run('renderTopicContextMenu', this.props);\n  };\n\n  TopicContentWidget.prototype.onContextMenuClose = function () {// Optional method called once the context menu is closed.\n  };\n\n  TopicContentWidget.prototype.componentDidUpdate = function () {\n    if (this.needRelocation) {\n      var _a = this.props,\n          getRef = _a.getRef,\n          topicKey = _a.topicKey,\n          setViewBoxScrollDelta = _a.setViewBoxScrollDelta;\n      var newRect = getRef(collapseRefKey(topicKey)).getBoundingClientRect();\n      log$2('newRect:', newRect);\n      log$2('oldRect:', this.oldCollapseIconRect);\n      setViewBoxScrollDelta(newRect.left - this.oldCollapseIconRect.left, newRect.top - this.oldCollapseIconRect.top);\n      this.needRelocation = false;\n    }\n  };\n\n  TopicContentWidget.prototype.render = function () {\n    var props = this.props;\n    var saveRef = props.saveRef,\n        topicKey = props.topicKey,\n        model = props.model,\n        controller = props.controller,\n        topicStyle = props.topicStyle,\n        dir = props.dir;\n    var draggable = model.editingContentKey !== topicKey;\n    var showPopMenu = this.state.showPopMenu;\n    var collapseIcon = controller.run('renderTopicCollapseIcon', __assign(__assign({}, props), {\n      onClickCollapse: this.onClickCollapse.bind(this)\n    }));\n    log$2(dir);\n    var prevDropArea = controller.run('renderTopicDropArea', __assign(__assign({}, props), {\n      dropDir: 'prev'\n    }));\n    var nextDropArea = controller.run('renderTopicDropArea', __assign(__assign({}, props), {\n      dropDir: 'next'\n    }));\n    var dropEventHandlers = {\n      onDragEnter: this.onDragEnter,\n      onDragLeave: this.onDragLeave,\n      onDragOver: this.onDragOver,\n      onDrop: this.onDrop\n    };\n    return createElement(TopicContentWithDropArea, null, prevDropArea, createElement(TopicContent // theme={getTopicTheme(visualLevel, model.config.theme)}\n    // dragEnter={this.state.dragEnter}\n    , __assign({\n      // theme={getTopicTheme(visualLevel, model.config.theme)}\n      // dragEnter={this.state.dragEnter}\n      style: topicStyle,\n      draggable: draggable,\n      ref: saveRef(contentRefKey(topicKey)),\n      onDragStart: this.onDragStart,\n      onClick: this.onClick,\n      onDoubleClick: this.onDoubleClick,\n      onContextMenu: this.onContextMenu\n    }, dropEventHandlers), controller.run('renderBlocks', props), showPopMenu && controller.run('renderTopicPopupMenu', __assign(__assign({}, props), {\n      handleVisibleChange: this.handlePopMenuVisibleChange,\n      visible: true\n    }))), nextDropArea, dir !== TopicDirection.MAIN && collapseIcon);\n  };\n\n  TopicContentWidget = __decorate([ContextMenuTarget], TopicContentWidget);\n  return TopicContentWidget;\n}(BaseWidget);\n\nvar templateObject_1$1, templateObject_2$1;\nvar log$3 = debug('RootNode');\nvar LayerPart = styled.div(templateObject_1$2 || (templateObject_1$2 = __makeTemplateObject([\"\\n  display: flex;\\n  position: relative;\\n\\n  align-items: \", \";\\n  flex-direction: column;\\n\\n  padding: \", \";\\n\"], [\"\\n  display: flex;\\n  position: relative;\\n\\n  align-items: \", \";\\n  flex-direction: column;\\n\\n  padding: \", \";\\n\"])), function (props) {\n  //@ts-ignore\n  return props.topicDirection === TopicDirection.LEFT ? 'flex-end' : 'flex-start';\n}, function (props) {\n  //@ts-ignore\n  return props.topicDirection === TopicDirection.LEFT ? '15px 60px 15px 0px' : '15px 0px 15px 60px';\n});\nvar Topic = styled.div(templateObject_2$2 || (templateObject_2$2 = __makeTemplateObject([\"\\n  display: flex;\\n  position: relative;\\n  align-items: center;\\n  z-index: 3;\\n\"], [\"\\n  display: flex;\\n  position: relative;\\n  align-items: center;\\n  z-index: 3;\\n\"])));\n\nvar RootWidget =\n/** @class */\nfunction (_super) {\n  __extends(RootWidget, _super);\n\n  function RootWidget() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  RootWidget.prototype.renderPartTopics = function (topics, dir) {\n    var _a = this.props,\n        controller = _a.controller,\n        saveRef = _a.saveRef;\n    var res = controller.run('createSubTopics', {\n      props: __assign(__assign({}, this.props), {\n        dir: dir,\n        isRoot: true\n      }),\n      topics: topics\n    });\n    if (!res) return null;\n    var subTopics = res.subTopics;\n    var cxName = \"bm-layer-\" + (dir === TopicDirection.LEFT ? 'left' : 'right');\n    return (//@ts-ignore\n      createElement(LayerPart, {\n        topicDirection: dir,\n        ref: saveRef(cxName)\n      }, subTopics)\n    );\n  };\n\n  RootWidget.prototype.componentDidMount = function () {\n    this.layout();\n  };\n\n  RootWidget.prototype.componentDidUpdate = function () {\n    this.layout();\n  };\n\n  RootWidget.prototype.layout = function () {\n    var controller = this.props.controller;\n    controller.run('layout', this.props);\n  };\n\n  RootWidget.prototype.render = function () {\n    log$3('render');\n    var props = this.props;\n    var model = props.model,\n        topicKey = props.topicKey,\n        saveRef = props.saveRef,\n        controller = props.controller,\n        dir = props.dir;\n    var topicStyle = controller.run('getTopicStyle', props);\n    var config = model.config;\n    var topicContent = controller.run('renderTopicContent', __assign(__assign({}, props), {\n      topicStyle: topicStyle,\n      dir: TopicDirection.MAIN\n    }));\n    var partTopics = controller.run('getPartTopics', {\n      layout: config.layoutDir,\n      model: model,\n      topicKey: topicKey\n    });\n    var rootTopic = createElement(Topic, {\n      ref: saveRef(topicRefKey(topicKey))\n    }, topicContent);\n    var children = controller.run('renderRootWidgetOtherChildren', props);\n\n    switch (config.layoutDir) {\n      case DiagramLayoutType.LEFT_AND_RIGHT:\n        return createElement(Fragment, null, this.renderPartTopics(partTopics.L, 'L'), rootTopic, this.renderPartTopics(partTopics.R, 'R'), children);\n\n      case DiagramLayoutType.LEFT_TO_RIGHT:\n        return createElement(Fragment, null, rootTopic, this.renderPartTopics(partTopics.R, 'R'), children);\n\n      case DiagramLayoutType.RIGHT_TO_LEFT:\n        return createElement(Fragment, null, this.renderPartTopics(partTopics.L, 'L'), rootTopic, children);\n\n      case DiagramLayoutType.TOP_TO_BOTTOM:\n        return createElement(Fragment, null, rootTopic, this.renderPartTopics(partTopics.B, 'B'), children);\n    }\n\n    return null;\n  };\n\n  return RootWidget;\n}(Component);\n\nvar templateObject_1$2, templateObject_2$2;\nvar log$4 = debug('node:topic-widget');\nvar Node = styled.div(templateObject_1$3 || (templateObject_1$3 = __makeTemplateObject([\"\\n  display: flex;\\n  align-items: center;\\n  flex-direction: \", \";\\n\"], [\"\\n  display: flex;\\n  align-items: center;\\n  flex-direction: \", \";\\n\"])), function (props) {\n  return props.topicDirection === TopicDirection.RIGHT ? 'row' : 'row-reverse';\n}); // TODO\n\nvar NodeChildren = styled.div(templateObject_2$3 || (templateObject_2$3 = __makeTemplateObject([\"\\n  position: relative;\\n  padding: \", \";\\n\"], [\"\\n  position: relative;\\n  padding: \", \";\\n\"])), function (props) {\n  return props.dir === TopicDirection.RIGHT ? \"0 0 0 \" + props.marginH + \"px\" : \"0 \" + props.marginH + \"px 0 0\";\n});\nvar NodeTopic = styled.div(templateObject_3 || (templateObject_3 = __makeTemplateObject([\"\\n  display: flex;\\n  position: relative;\\n  align-items: center;\\n\\n  flex-direction: \", \";\\n\"], [\"\\n  display: flex;\\n  position: relative;\\n  align-items: center;\\n\\n  flex-direction: \", \";\\n\"])), function (props) {\n  return props.topicDirection === TopicDirection.RIGHT ? 'row' : 'row-reverse';\n});\n\nvar TopicWidget =\n/** @class */\nfunction (_super) {\n  __extends(TopicWidget, _super);\n\n  function TopicWidget() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  TopicWidget.prototype.renderSubTopics = function () {\n    var props = this.props;\n    var controller = props.controller,\n        model = props.model,\n        topicKey = props.topicKey,\n        dir = props.dir,\n        saveRef = props.saveRef,\n        getRef = props.getRef;\n    var topics = model.getTopic(topicKey).subKeys.toArray();\n    var res = controller.run('createSubTopics', {\n      props: props,\n      topics: topics\n    });\n    if (!res) return null;\n    var subTopics = res.subTopics;\n    var subLinks = controller.run('renderSubLinks', props);\n    return createElement(NodeChildren, {\n      dir: dir,\n      marginH: model.config.theme.marginH\n    }, subTopics, \" \", subLinks);\n  };\n\n  TopicWidget.prototype.componentDidUpdate = function () {\n    this.layoutLinks();\n  };\n\n  TopicWidget.prototype.componentDidMount = function () {\n    this.layoutLinks();\n  };\n\n  TopicWidget.prototype.layoutLinks = function () {\n    var _a = this.props,\n        getRef = _a.getRef,\n        topicKey = _a.topicKey;\n    var links = getRef(linksRefKey(topicKey));\n    links && links.layout();\n  };\n\n  TopicWidget.prototype.render = function () {\n    log$4('render');\n    var props = this.props;\n    var controller = props.controller,\n        topicKey = props.topicKey,\n        dir = props.dir,\n        saveRef = props.saveRef;\n    var topicStyle = controller.run('getTopicStyle', props);\n\n    var propsMore = __assign(__assign({}, props), {\n      topicStyle: topicStyle\n    });\n\n    var topicContent = controller.run('renderTopicContent', propsMore);\n    return createElement(Node, {\n      topicDirection: dir\n    }, createElement(NodeTopic, {\n      topicDirection: dir,\n      ref: saveRef(topicRefKey(topicKey))\n    }, topicContent), this.renderSubTopics());\n  };\n\n  return TopicWidget;\n}(Component);\n\nvar templateObject_1$3, templateObject_2$3, templateObject_3;\n\nvar TopicContextMenu =\n/** @class */\nfunction (_super) {\n  __extends(TopicContextMenu, _super);\n\n  function TopicContextMenu() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  TopicContextMenu.prototype.render = function () {\n    var controller = this.props.controller;\n    return createElement(Menu, null, controller.run('customizeTopicContextMenu', this.props));\n  };\n\n  return TopicContextMenu;\n}(BaseWidget);\n\nvar Icon$1 = styled.div(templateObject_3$1 || (templateObject_3$1 = __makeTemplateObject([\"\\n  position: absolute;\\n  top: calc(50% - 10px);\\n  \", \";\\n  border-radius: 50%;\\n  width: 20px;\\n  height: 20px;\\n  text-align: center;\\n  //@ts-ignore\\n  background: \", \";\\n  cursor: pointer;\\n  padding: 0;\\n  font-size: 14px;\\n  line-height: 20px;\\n  border: 0;\\n  z-index: 2;\\n\"], [\"\\n  position: absolute;\\n  top: calc(50% - 10px);\\n  \", \";\\n  border-radius: 50%;\\n  width: 20px;\\n  height: 20px;\\n  text-align: center;\\n  //@ts-ignore\\n  background: \", \";\\n  cursor: pointer;\\n  padding: 0;\\n  font-size: 14px;\\n  line-height: 20px;\\n  border: 0;\\n  z-index: 2;\\n\"])), function (_a) {\n  var dir = _a.dir;\n  if (dir === TopicDirection.RIGHT) return css(templateObject_1$4 || (templateObject_1$4 = __makeTemplateObject([\"\\n        right: -25px;\\n      \"], [\"\\n        right: -25px;\\n      \"])));\n  if (dir === TopicDirection.LEFT) return css(templateObject_2$4 || (templateObject_2$4 = __makeTemplateObject([\"\\n        left: -25px;\\n      \"], [\"\\n        left: -25px;\\n      \"])));\n}, function (props) {\n  return props.background;\n});\n\nfunction TopicCollapseIcon(props) {\n  var _a;\n\n  var model = props.model,\n      topicKey = props.topicKey,\n      topicStyle = props.topicStyle,\n      dir = props.dir,\n      saveRef = props.saveRef,\n      onClickCollapse = props.onClickCollapse;\n  var topic = model.getTopic(topicKey);\n  return topic.subKeys.size > 0 ? createElement(Icon$1, {\n    ref: saveRef(collapseRefKey(topicKey)),\n    onClick: onClickCollapse,\n    background: topicStyle.background,\n    dir: dir,\n    className: cx((_a = {\n      icon: true,\n      iconfont: true\n    }, _a[\"bm-\" + (topic.collapse ? 'plus' : 'minus')] = true, _a))\n  }) : null;\n}\n\nvar templateObject_1$4, templateObject_2$4, templateObject_3$1;\nvar log$5 = debug('node:style-editor');\nvar StyleEditorRoot = styled.div(templateObject_1$5 || (templateObject_1$5 = __makeTemplateObject([\"\\n  position: absolute;\\n  background: white;\\n  right: 30px;\\n  top: 20px;\\n  border-radius: 2px;\\n  z-index: 4;\\n\"], [\"\\n  position: absolute;\\n  background: white;\\n  right: 30px;\\n  top: 20px;\\n  border-radius: 2px;\\n  z-index: 4;\\n\"])));\nvar Title = styled.div(templateObject_2$5 || (templateObject_2$5 = __makeTemplateObject([\"\\n  height: 16px;\\n\"], [\"\\n  height: 16px;\\n\"])));\nvar CloseIcon = styled.div(templateObject_3$2 || (templateObject_3$2 = __makeTemplateObject([\"\\n  position: absolute;\\n  right: 5px;\\n  top: 5px;\\n  cursor: pointer;\\n  &:hover {\\n    color: #1ea7fd;\\n  }\\n\"], [\"\\n  position: absolute;\\n  right: 5px;\\n  top: 5px;\\n  cursor: pointer;\\n  &:hover {\\n    color: #1ea7fd;\\n  }\\n\"])));\nvar PopRoot = styled.div(templateObject_4 || (templateObject_4 = __makeTemplateObject([\"\\n  padding: 10px;\\n\"], [\"\\n  padding: 10px;\\n\"])));\nvar ShowMenuIcon = styled.a(templateObject_5 || (templateObject_5 = __makeTemplateObject([\"\\n  font-size: 20px !important;\\n\"], [\"\\n  font-size: 20px !important;\\n\"])));\nvar IconBg = styled.div(templateObject_6 || (templateObject_6 = __makeTemplateObject([\"\\n  padding: 5px;\\n  cursor: pointer;\\n\"], [\"\\n  padding: 5px;\\n  cursor: pointer;\\n\"])));\nvar WithBorder = styled.div(templateObject_7 || (templateObject_7 = __makeTemplateObject([\"\\n  border: 1px solid grey;\\n  cursor: pointer;\\n  font-weight: bold;\\n\"], [\"\\n  border: 1px solid grey;\\n  cursor: pointer;\\n  font-weight: bold;\\n\"])));\nvar SettingTitle = styled.div(templateObject_8 || (templateObject_8 = __makeTemplateObject([\"\\n  margin-top: 10px;\\n  margin-bottom: 5px;\\n\"], [\"\\n  margin-top: 10px;\\n  margin-bottom: 5px;\\n\"])));\nvar SettingItem = styled.span(templateObject_9 || (templateObject_9 = __makeTemplateObject([\"\\n  margin: 0px 10px 0px 0px;\\n\"], [\"\\n  margin: 0px 10px 0px 0px;\\n\"])));\nvar ColorBar = styled.div(templateObject_10 || (templateObject_10 = __makeTemplateObject([\"\\n  height: 3px;\\n  width: 80%;\\n  margin-left: 10%;\\n  margin-right: 10%;\\n  margin-bottom: 2px;\\n  background: \", \";\\n\"], [\"\\n  height: 3px;\\n  width: 80%;\\n  margin-left: 10%;\\n  margin-right: 10%;\\n  margin-bottom: 2px;\\n  background: \", \";\\n\"])), function (props) {\n  return props.color;\n});\nvar PxSelect = Select.ofType();\n\nvar renderItem = function (unit) {\n  return function (width, _a) {\n    var handleClick = _a.handleClick,\n        modifiers = _a.modifiers,\n        query = _a.query;\n    return createElement(MenuItem, {\n      text: \"\" + width + unit,\n      key: width,\n      onClick: handleClick\n    });\n  };\n};\n\nvar StyleEditor =\n/** @class */\nfunction (_super) {\n  __extends(StyleEditor, _super);\n\n  function StyleEditor(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.setShowPanel = function (showPanel) {\n      return function () {\n        _this.setState({\n          showPanel: showPanel\n        });\n      };\n    };\n\n    _this.setStyle = function (obj) {\n      var style = _this.topic.style;\n      var styleObj = style ? JSON.parse(style) : {};\n\n      var newStyleObj = __assign(__assign({}, styleObj), obj);\n\n      if (!isEqual(styleObj, newStyleObj)) {\n        var newStyleStr = JSON.stringify(newStyleObj);\n\n        _this.operation(OpType.SET_STYLE, __assign(__assign({}, _this.props), {\n          style: newStyleStr\n        }));\n      }\n    };\n\n    _this.setLinkStyle = function (obj) {\n      var style = _this.topic.style;\n      var styleObj = style ? JSON.parse(style) : {};\n\n      var newStyleObj = __assign(__assign({}, styleObj), {\n        linkStyle: __assign(__assign({}, styleObj.linkStyle), obj)\n      });\n\n      if (!isEqual(styleObj, newStyleObj)) {\n        var newStyleStr = JSON.stringify(newStyleObj);\n\n        _this.operation(OpType.SET_STYLE, __assign(__assign({}, _this.props), {\n          style: newStyleStr\n        }));\n      }\n    };\n\n    _this.handleBorderWidthChange = function (value) {\n      log$5('handleBorderWithChange:', value);\n\n      _this.setStyle({\n        borderWidth: value + \"px\"\n      });\n    };\n\n    _this.handleBorderStyleChange = function (value) {\n      _this.setStyle({\n        borderStyle: value\n      });\n    };\n\n    _this.handleBorderRadiusChange = function (value) {\n      log$5('handleBorderRadiusChange:', value);\n\n      _this.setStyle({\n        borderRadius: value + \"px\"\n      });\n    };\n\n    _this.handleLinkWidthChange = function (value) {\n      log$5('handleBorderRadiusChange:', value);\n\n      _this.setLinkStyle({\n        lineWidth: value + \"px\"\n      });\n    };\n\n    _this.handleBorderColorChange = function (color) {\n      log$5(color);\n\n      _this.setStyle({\n        borderColor: color.hex\n      });\n    };\n\n    _this.handleBackgroundColorChange = function (color) {\n      log$5(color);\n\n      _this.setStyle({\n        background: color.hex\n      });\n    };\n\n    _this.handleLinkColorChange = function (color) {\n      log$5(color);\n\n      _this.setLinkStyle({\n        lineColor: color.hex\n      });\n    };\n\n    _this.state = {\n      showPanel: false\n    };\n    return _this;\n  }\n\n  StyleEditor.prototype.render = function () {\n    var props = this.props;\n    var controller = props.controller,\n        model = props.model;\n    if (!model.focusKey) return null;\n    var topicStyle = controller.run('getTopicStyle', props);\n    var linkStyle = topicStyle.linkStyle;\n\n    if (!this.state.showPanel) {\n      return createElement(StyleEditorRoot, null, createElement(IconBg, {\n        onClick: this.setShowPanel(true)\n      }, createElement(ShowMenuIcon, {\n        className: iconClassName(IconName.SHOW_MENU)\n      })));\n    }\n\n    var borderWidthItems = __spread(Array(7).keys());\n\n    var borderRadiusItems = [0, 5, 10, 15, 20, 25, 30, 35];\n    var borderStyleItems = ['none', 'solid', 'dotted', 'dashed', 'double'];\n    return createElement(StyleEditorRoot, null, createElement(Title, null, createElement(CloseIcon, {\n      className: iconClassName(IconName.CLOSE),\n      onClick: this.setShowPanel(false)\n    })), createElement(PopRoot, null, createElement(SettingTitle, null, \"Border\"), createElement(\"div\", null, createElement(SettingItem, null, createElement(PxSelect, {\n      items: borderWidthItems,\n      itemRenderer: renderItem('px'),\n      filterable: false,\n      onItemSelect: this.handleBorderWidthChange\n    }, createElement(Button, {\n      text: \"width: \" + (topicStyle.borderWidth ? topicStyle.borderWidth : '0px')\n    }))), createElement(SettingItem, null, createElement(PxSelect, {\n      items: borderStyleItems,\n      itemRenderer: renderItem(''),\n      filterable: false,\n      onItemSelect: this.handleBorderStyleChange\n    }, createElement(Button, {\n      text: \"style: \" + (topicStyle.borderStyle ? topicStyle.borderStyle : 'none')\n    }))), createElement(SettingItem, null, createElement(PxSelect, {\n      items: borderRadiusItems,\n      itemRenderer: renderItem('px'),\n      filterable: false,\n      onItemSelect: this.handleBorderRadiusChange\n    }, createElement(Button, {\n      text: \"radius: \" + topicStyle.borderRadius\n    }))), createElement(SettingItem, null, createElement(Popover, null, createElement(WithBorder, null, createElement(\"div\", {\n      className: iconClassName(IconName.COLOR_PICKER)\n    }), createElement(ColorBar, {\n      color: topicStyle.borderColor\n    })), createElement(\"div\", null, createElement(SketchPicker, {\n      color: topicStyle.borderColor,\n      onChangeComplete: this.handleBorderColorChange\n    }))))), createElement(SettingTitle, null, \"Background\"), createElement(\"div\", null, createElement(SettingItem, null, createElement(Popover, null, createElement(WithBorder, null, createElement(\"div\", {\n      className: iconClassName(IconName.COLOR_PICKER)\n    }), createElement(ColorBar, {\n      color: topicStyle.background\n    })), createElement(\"div\", null, createElement(SketchPicker, {\n      color: topicStyle.background,\n      onChangeComplete: this.handleBackgroundColorChange\n    }))))), createElement(SettingTitle, null, \"Link\"), createElement(\"div\", null, createElement(SettingItem, null, createElement(PxSelect, {\n      items: borderWidthItems,\n      itemRenderer: renderItem('px'),\n      filterable: false,\n      onItemSelect: this.handleLinkWidthChange\n    }, createElement(Button, {\n      text: \"width: \" + (linkStyle ? linkStyle.lineWidth : '0px')\n    }))), createElement(SettingItem, null, createElement(Popover, null, createElement(WithBorder, null, createElement(\"div\", {\n      className: iconClassName(IconName.COLOR_PICKER)\n    }), createElement(ColorBar, {\n      color: topicStyle.background\n    })), createElement(\"div\", null, createElement(SketchPicker, {\n      color: topicStyle.background,\n      onChangeComplete: this.handleLinkColorChange\n    })))))));\n  };\n\n  return StyleEditor;\n}(BaseWidget);\n\nvar templateObject_1$5, templateObject_2$5, templateObject_3$2, templateObject_4, templateObject_5, templateObject_6, templateObject_7, templateObject_8, templateObject_9, templateObject_10;\nvar TopicLinksSvg = styled.svg(templateObject_1$6 || (templateObject_1$6 = __makeTemplateObject([\"\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 1;\\n  pointer-events: none;\\n\"], [\"\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 1;\\n  pointer-events: none;\\n\"])));\nvar log$6 = debug('node:topic-sub-links');\n\nvar TopicSubLinks =\n/** @class */\nfunction (_super) {\n  __extends(TopicSubLinks, _super);\n\n  function TopicSubLinks() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      curves: []\n    };\n    return _this;\n  }\n\n  TopicSubLinks.prototype.layout = function () {\n    var props = this.props;\n    var model = props.model,\n        getRef = props.getRef,\n        topicKey = props.topicKey,\n        dir = props.dir,\n        controller = props.controller;\n    var topic = model.getTopic(topicKey);\n    var content = getRef(contentRefKey(topicKey));\n    var svgRect = getRef(linksSvgRefKey(topicKey)).getBoundingClientRect();\n    var collapseRect = getRef(collapseRefKey(topicKey)).getBoundingClientRect();\n    var contentRect = content.getBoundingClientRect();\n    var p1, p2, p3;\n\n    if (dir === TopicDirection.RIGHT) {\n      p1 = {\n        x: 0,\n        y: centerY(contentRect) - svgRect.top\n      };\n      p2 = {\n        x: collapseRect.right - svgRect.left + 10,\n        y: p1.y\n      };\n    } else if (dir === TopicDirection.LEFT) {\n      p1 = {\n        x: svgRect.right,\n        y: centerY(contentRect) - svgRect.top\n      };\n      p2 = {\n        x: collapseRect.left - svgRect.left - 10,\n        y: p1.y\n      };\n    }\n\n    var curves = [];\n    topic.subKeys.forEach(function (key) {\n      var curve;\n      var linkStyle = controller.run('getLinkStyle', __assign(__assign({}, props), {\n        topicKey: key\n      }));\n      var rect = getRef(contentRefKey(key)).getBoundingClientRect();\n\n      if (dir === TopicDirection.RIGHT) {\n        p3 = {\n          x: rect.left - svgRect.left,\n          y: centerY(rect) - svgRect.top\n        };\n      }\n\n      if (dir === TopicDirection.LEFT) {\n        p3 = {\n          x: rect.right - svgRect.left,\n          y: centerY(rect) - svgRect.top\n        };\n      }\n\n      var lineType = linkStyle.lineType;\n\n      if (lineType === 'curve') {\n        curve = \"M \" + p1.x + \" \" + p1.y + \" L \" + p2.x + \" \" + p2.y + \" C \" + p2.x + \" \" + centerPointY(p2, p3) + \" \" + centerPointX(p2, p3) + \" \" + p3.y + \" \" + p3.x + \" \" + p3.y;\n      } else if (lineType === 'round') {\n        var vDir = p3.y > p1.y ? 1 : -1;\n        var hDir = p3.x > p1.x ? 1 : -1;\n        var radius = linkStyle.lineRadius;\n\n        if (p3.y === p1.y) {\n          curve = \"M \" + p1.x + \" \" + p1.y + \" H \" + p3.x;\n        } else {\n          // 0 表示逆时针 1 表示顺时针\n          curve = \"M \" + p1.x + \" \" + p1.y + \" H \" + p2.x + \" V \" + (p3.y - vDir * radius) + \" A \" + radius + \" \" + radius + \" 0 0 \" + (vDir * hDir === 1 ? 0 : 1) + \" \" + (p2.x + radius * hDir) + \" \" + p3.y + \" H \" + p3.x;\n        }\n      } else if (lineType === 'line') {\n        curve = \"M \" + p1.x + \" \" + p1.y + \" H \" + p2.x + \" L \" + p3.x + \" \" + p3.y;\n      }\n\n      curves.push(createElement(\"path\", {\n        key: \"link-\" + key,\n        d: curve,\n        strokeWidth: linkStyle.lineWidth,\n        stroke: linkStyle.lineColor,\n        fill: \"none\"\n      }));\n    });\n    log$6('curves:', curves);\n    this.setState({\n      curves: curves\n    });\n  };\n\n  TopicSubLinks.prototype.render = function () {\n    var _a = this.props,\n        topicKey = _a.topicKey,\n        saveRef = _a.saveRef;\n    return createElement(TopicLinksSvg, {\n      ref: saveRef(linksSvgRefKey(topicKey))\n    }, createElement(\"g\", null, this.state.curves));\n  };\n\n  return TopicSubLinks;\n}(BaseWidget);\n\nvar templateObject_1$6;\nvar RootLinksSvg = styled.svg(templateObject_1$7 || (templateObject_1$7 = __makeTemplateObject([\"\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 1;\\n  pointer-events: none;\\n\"], [\"\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 1;\\n  pointer-events: none;\\n\"])));\nvar log$7 = debug('node:topic-sub-links');\n\nvar RootSubLinks =\n/** @class */\nfunction (_super) {\n  __extends(RootSubLinks, _super);\n\n  function RootSubLinks() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      curves: []\n    };\n    return _this;\n  }\n\n  RootSubLinks.prototype.layout = function () {\n    var props = this.props;\n    var model = props.model,\n        getRef = props.getRef,\n        topicKey = props.topicKey,\n        dir = props.dir,\n        controller = props.controller;\n    var topic = model.getTopic(topicKey);\n    var contentRect = getRef(contentRefKey(topicKey)).getBoundingClientRect();\n    var svgRect = getRef(linksSvgRefKey(topicKey)).getBoundingClientRect();\n    var p1, p2;\n    p1 = {\n      x: centerX(contentRect) - svgRect.left,\n      y: centerY(contentRect) - svgRect.top\n    };\n    var curves = [];\n    topic.subKeys.forEach(function (key) {\n      var style = controller.run('getTopicStyle', __assign(__assign({}, props), {\n        topicKey: key\n      }));\n      var linkStyle = style.linkStyle;\n      var lineType = linkStyle.lineType;\n      var rect = getRef(contentRefKey(key)).getBoundingClientRect();\n\n      if (rect.left > contentRect.right) {\n        p2 = {\n          x: rect.left,\n          y: centerY(rect)\n        };\n      } else {\n        p2 = {\n          x: rect.right,\n          y: centerY(rect)\n        };\n      }\n\n      p2 = {\n        x: p2.x - svgRect.left,\n        y: p2.y - svgRect.top\n      };\n      var curve;\n\n      if (lineType === 'curve') {\n        curve = \"M \" + p1.x + \" \" + p1.y + \" C \" + p1.x + \" \" + centerPointY(p1, p2) + \" \" + centerPointX(p1, p2) + \" \" + p2.y + \" \" + p2.x + \" \" + p2.y;\n      } else if (lineType === 'line') {\n        curve = \"M \" + p1.x + \" \" + p1.y + \" L \" + p2.x + \" \" + p2.y;\n      } else if (lineType === 'round') {\n        var vDir = p2.y > p1.y ? 1 : -1;\n        var hDir = p2.x > p1.x ? 1 : -1;\n        var radius = linkStyle.lineRadius;\n\n        if (radius == null) {\n          throw new Error('link line type is round, but lineRadius is not provided!');\n        }\n\n        if (p2.y === p1.y) {\n          curve = \"M \" + p1.x + \" \" + p1.y + \" H \" + p2.x;\n        } else {\n          // 0 表示逆时针 1 表示顺时针\n          curve = \"M \" + p1.x + \" \" + p1.y + \"  V \" + (p2.y - vDir * radius) + \" A \" + radius + \" \" + radius + \" 0 0 \" + (vDir * hDir === 1 ? 0 : 1) + \" \" + (p1.x + radius * hDir) + \" \" + p2.y + \" H \" + p2.x;\n        }\n      }\n\n      curves.push(createElement(\"path\", {\n        key: \"link-\" + key,\n        d: curve,\n        strokeWidth: style.linkStyle.lineWidth,\n        stroke: style.linkStyle.lineColor,\n        fill: \"none\"\n      }));\n    });\n    this.setState({\n      curves: curves\n    });\n  };\n\n  RootSubLinks.prototype.render = function () {\n    var _a = this.props,\n        topicKey = _a.topicKey,\n        saveRef = _a.saveRef;\n    return createElement(RootLinksSvg, {\n      ref: saveRef(linksSvgRefKey(topicKey))\n    }, createElement(\"g\", null, this.state.curves));\n  };\n\n  return RootSubLinks;\n}(BaseWidget);\n\nvar templateObject_1$7;\nvar FocusHighlightSvg = styled.svg(templateObject_1$8 || (templateObject_1$8 = __makeTemplateObject([\"\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 2;\\n  pointer-events: none;\\n\"], [\"\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 2;\\n  pointer-events: none;\\n\"])));\n\nvar TopicHighlight =\n/** @class */\nfunction (_super) {\n  __extends(TopicHighlight, _super);\n\n  function TopicHighlight() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      content: null\n    };\n    return _this;\n  }\n\n  TopicHighlight.prototype.layout = function () {\n    var _a = this.props,\n        getRef = _a.getRef,\n        model = _a.model;\n    var focusKey = model.focusKey;\n    var focusMode = model.focusMode;\n\n    if (!focusKey || focusMode === FocusMode.EDITING_CONTENT) {\n      this.setState({\n        content: null\n      });\n      return;\n    }\n\n    var contentRect = getRef(contentRefKey(focusKey)).getBoundingClientRect();\n    var svgRect = getRef('svg-highlight').getBoundingClientRect();\n    var padding = 3;\n    var x = contentRect.left - svgRect.left - padding;\n    var y = contentRect.top - svgRect.top - padding;\n    var width = contentRect.width + 2 * padding;\n    var height = contentRect.height + 2 * padding;\n    this.setState({\n      content: createElement(\"rect\", {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n        fill: \"none\",\n        stroke: model.config.theme.highlightColor,\n        strokeWidth: 2\n      })\n    });\n  };\n\n  TopicHighlight.prototype.render = function () {\n    var saveRef = this.props.saveRef;\n    return createElement(FocusHighlightSvg, {\n      ref: saveRef('svg-highlight')\n    }, this.state.content);\n  };\n\n  return TopicHighlight;\n}(BaseWidget);\n\nvar templateObject_1$8;\nvar NodeLayer = styled.div(templateObject_1$9 || (templateObject_1$9 = __makeTemplateObject([\"\\n  position: relative;\\n  display: flex;\\n  align-items: center;\\n  padding: 5px;\\n\"], [\"\\n  position: relative;\\n  display: flex;\\n  align-items: center;\\n  padding: 5px;\\n\"])));\nvar DIV = styled.div(templateObject_2$6 || (templateObject_2$6 = __makeTemplateObject([\"\\n  width: 100%;\\n  height: 100%;\\n  background: \", \";\\n\"], [\"\\n  width: 100%;\\n  height: 100%;\\n  background: \", \";\\n\"])), function (props) {\n  return props.theme.background;\n});\n\nvar MindDragScrollWidget =\n/** @class */\nfunction (_super) {\n  __extends(MindDragScrollWidget, _super);\n\n  function MindDragScrollWidget(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.onClick = function (e) {};\n\n    return _this;\n  }\n\n  MindDragScrollWidget.prototype.componentDidMount = function () {\n    var _a = this.props,\n        getRef = _a.getRef,\n        model = _a.model;\n    var rootTopic = getRef(topicRefKey(model.editorRootTopicKey));\n    var nodeLayer = getRef('node-layer');\n    var rootTopicRect = rootTopic.getBoundingClientRect();\n    var nodeLayerRect = nodeLayer.getBoundingClientRect();\n    this.dragScrollWidget.setViewBoxScrollDelta(0, rootTopicRect.top - nodeLayerRect.top - this.dragScrollWidget.viewBox.getBoundingClientRect().height / 2 + rootTopicRect.height);\n  };\n\n  Object.defineProperty(MindDragScrollWidget.prototype, \"dragScrollWidget\", {\n    get: function () {\n      return this.props.getRef('DragScrollWidget');\n    },\n    enumerable: true,\n    configurable: true\n  });\n\n  MindDragScrollWidget.prototype.render = function () {\n    var _this = this;\n\n    var _a = this.props,\n        saveRef = _a.saveRef,\n        model = _a.model,\n        controller = _a.controller;\n    var nodeKey = model.editorRootTopicKey;\n    return createElement(DIV // onClick={this.onClick}\n    , null, createElement(DragScrollWidget, __assign({}, this.state, {\n      ref: saveRef('DragScrollWidget')\n    }), function (setViewBoxScroll, setViewBoxScrollDelta) {\n      var rootWidgetProps = __assign(__assign({}, _this.props), {\n        topicKey: nodeKey,\n        setViewBoxScroll: setViewBoxScroll,\n        setViewBoxScrollDelta: setViewBoxScrollDelta\n      });\n\n      return createElement(NodeLayer, {\n        ref: saveRef('node-layer')\n      }, controller.run('renderRootWidget', rootWidgetProps));\n    }));\n  };\n\n  return MindDragScrollWidget;\n}(Component);\n\nvar templateObject_1$9, templateObject_2$6;\nvar DescWrapper = styled.div(templateObject_1$a || (templateObject_1$a = __makeTemplateObject([\"\\n  border: 1px solid #d9d9d9;\\n  height: calc(100% - 50px);\\n  padding: 0 1rem;\\n  overflow: auto;\\n  margin: 0.5rem 0.5rem 0 0.5rem;\\n\"], [\"\\n  border: 1px solid #d9d9d9;\\n  height: calc(100% - 50px);\\n  padding: 0 1rem;\\n  overflow: auto;\\n  margin: 0.5rem 0.5rem 0 0.5rem;\\n\"])));\n\nvar Modals =\n/** @class */\nfunction (_super) {\n  __extends(Modals, _super);\n\n  function Modals() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.handleClose = function () {\n      var controller = _this.props.controller;\n      var handleActiveModalClose = controller.run('handleActiveModalClose', _this.props);\n      handleActiveModalClose && handleActiveModalClose();\n    };\n\n    return _this;\n  }\n\n  Modals.prototype.render = function () {\n    var controller = this.props.controller;\n    var onClose = controller.run('handleActiveModalClose', this.props);\n    var activeModal = controller.run('renderModal', this.props);\n    var activeModalProps = controller.run('getActiveModalProps', this.props);\n    return createElement(Dialog, {\n      onClose: this.handleClose,\n      isOpen: activeModal !== null,\n      autoFocus: true,\n      enforceFocus: true,\n      usePortal: true,\n      title: activeModalProps && activeModalProps.title,\n      style: activeModalProps && activeModalProps.style\n    }, createElement(\"div\", {\n      className: Classes.DIALOG_BODY,\n      style: {\n        minHeight: 0\n      }\n    }, activeModal));\n  };\n\n  return Modals;\n}(BaseWidget);\n\nvar templateObject_1$a;\nvar DescIcon = styled.div(templateObject_1$b || (templateObject_1$b = __makeTemplateObject([\"\\n  &:hover {\\n  }\\n\"], [\"\\n  &:hover {\\n  }\\n\"])));\n\nfunction TopicDescIcon(props) {\n  var controller = props.controller,\n      model = props.model,\n      topicKey = props.topicKey;\n\n  var onClick = function (e) {\n    e.stopPropagation();\n    controller.run('operation', __assign(__assign({}, props), {\n      opType: OpType.START_EDITING_DESC\n    }));\n  };\n\n  var desc = model.getTopic(topicKey).getBlock(BlockType.DESC);\n  return desc.block && createElement(DescIcon, {\n    onClick: onClick,\n    className: iconClassName(IconName.NOTES)\n  });\n}\n\nvar templateObject_1$b;\nvar ContentEditable = styled.span(templateObject_1$c || (templateObject_1$c = __makeTemplateObject([\"\\n  &:focus {\\n    outline: 0px;\\n  }\\n\"], [\"\\n  &:focus {\\n    outline: 0px;\\n  }\\n\"])));\n\nvar SimpleTextEditor =\n/** @class */\nfunction (_super) {\n  __extends(SimpleTextEditor, _super);\n\n  function SimpleTextEditor() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.domNodeRef = function (ref) {\n      _this.domNode = ref;\n    };\n\n    _this.emitChange = function () {\n      var html = _this.domNode.innerHTML;\n\n      if (_this.props.onChange && html !== _this.lastHtml) {\n        _this.props.onChange(html);\n      }\n\n      _this.lastHtml = html;\n    };\n\n    return _this;\n  }\n\n  SimpleTextEditor.prototype.render = function () {\n    return createElement(ContentEditable, {\n      ref: this.domNodeRef,\n      // onInput={this.emitChange}\n      onBlur: this.emitChange.bind(this),\n      contentEditable: !this.props.readOnly,\n      suppressContentEditableWarning: true\n    }, this.props.editorValue);\n  };\n\n  SimpleTextEditor.prototype.shouldComponentUpdate = function (nextProps) {\n    return nextProps.html !== this.domNode.innerHTML;\n  };\n\n  return SimpleTextEditor;\n}(Component);\n\nvar templateObject_1$c;\nvar log$8 = debug('node:topic-content-editor');\nvar NodeContent = styled.div(templateObject_1$d || (templateObject_1$d = __makeTemplateObject([\"\\n  padding: 6px;\\n  background-color: \", \";\\n  color: black;\\n  cursor: \", \";\\n\"], [\"\\n  padding: 6px;\\n  background-color: \", \";\\n  color: black;\\n  cursor: \", \";\\n\"])), function (props) {\n  return props.readOnly ? null : 'white';\n}, function (props) {\n  return props.readOnly ? 'pointer' : 'text';\n});\n\nvar SimpleTopicContentEditor =\n/** @class */\nfunction (_super) {\n  __extends(SimpleTopicContentEditor, _super);\n\n  function SimpleTopicContentEditor() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.onMouseDown = function (e) {\n      e.stopPropagation();\n    };\n\n    _this.onMouseMove = function (e) {\n      e.stopPropagation();\n    };\n\n    _this.onChange = function (value) {\n      _this.operation(OpType.SET_TOPIC_CONTENT, __assign(__assign({}, _this.props), {\n        content: value\n      }));\n    };\n\n    return _this;\n  }\n\n  SimpleTopicContentEditor.prototype.render = function () {\n    var _a = this.props,\n        model = _a.model,\n        topicKey = _a.topicKey,\n        saveRef = _a.saveRef,\n        block = _a.block;\n    var content = block.data;\n    var editingContentKey = model.editingContentKey;\n    var readOnly = !(topicKey === editingContentKey);\n    var key = \"editor-\" + topicKey;\n    return createElement(NodeContent, {\n      key: key,\n      readOnly: readOnly,\n      ref: saveRef(key),\n      onMouseDown: this.onMouseDown,\n      onMouseMove: this.onMouseMove\n    }, createElement(SimpleTextEditor, {\n      editorValue: content,\n      readOnly: readOnly,\n      onChange: this.onChange\n    }));\n  };\n\n  return SimpleTopicContentEditor;\n}(BaseWidget);\n\nvar templateObject_1$d;\nvar ModalBody = styled.div(templateObject_1$e || (templateObject_1$e = __makeTemplateObject([\"\\n  height: 100%;\\n  flex: 1;\\n  display: flex;\\n  overflow: auto;\\n  background: white;\\n\"], [\"\\n  height: 100%;\\n  flex: 1;\\n  display: flex;\\n  overflow: auto;\\n  background: white;\\n\"])));\nvar ModalDescEditor = styled.div(templateObject_2$7 || (templateObject_2$7 = __makeTemplateObject([\"\\n  padding: 6px;\\n  width: 100%;\\n\"], [\"\\n  padding: 6px;\\n  width: 100%;\\n\"])));\nvar templateObject_1$e, templateObject_2$7;\nvar log$9 = debug('node:topic-content-editor');\nvar NodeContent$1 = styled.div(templateObject_1$f || (templateObject_1$f = __makeTemplateObject([\"\\n  padding: 6px;\\n  background-color: \", \";\\n  color: black;\\n  cursor: \", \";\\n\"], [\"\\n  padding: 6px;\\n  background-color: \", \";\\n  color: black;\\n  cursor: \", \";\\n\"])), function (props) {\n  return props.readOnly ? null : 'white';\n}, function (props) {\n  return props.readOnly ? 'pointer' : 'text';\n});\n\nvar SimpleTopicDescEditor =\n/** @class */\nfunction (_super) {\n  __extends(SimpleTopicDescEditor, _super);\n\n  function SimpleTopicDescEditor() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.onMouseDown = function (e) {\n      e.stopPropagation();\n    };\n\n    _this.onMouseMove = function (e) {\n      e.stopPropagation();\n    };\n\n    _this.onChange = function (value) {\n      _this.operation(OpType.SET_TOPIC_DESC, __assign(__assign({}, _this.props), {\n        desc: value\n      }));\n    };\n\n    return _this;\n  }\n\n  SimpleTopicDescEditor.prototype.render = function () {\n    var _a = this.props,\n        model = _a.model,\n        topicKey = _a.topicKey,\n        saveRef = _a.saveRef;\n    var block = model.getTopic(topicKey).getBlock(BlockType.DESC).block;\n    var content = block.data;\n    var editingDescKey = model.editingDescKey;\n    var readOnly = !(topicKey === editingDescKey);\n    var key = \"desc-\" + topicKey;\n    return createElement(NodeContent$1, {\n      key: key,\n      readOnly: readOnly,\n      ref: saveRef(key),\n      onMouseDown: this.onMouseDown,\n      onMouseMove: this.onMouseMove\n    }, createElement(SimpleTextEditor, {\n      editorValue: content,\n      readOnly: readOnly,\n      onChange: this.onChange\n    }));\n  };\n\n  return SimpleTopicDescEditor;\n}(BaseWidget);\n\nvar templateObject_1$f;\n\nfunction Theme(_a) {\n  var theme = _a.theme,\n      children = _a.children;\n  return (//@ts-ignore\n    createElement(ThemeProvider, {\n      theme: theme\n    }, createElement(Fragment, null, children))\n  );\n}\n\nvar items = [{\n  icon: 'edit',\n  label: 'edit',\n  rootCanUse: true,\n  opType: OpType.START_EDITING_CONTENT\n}, {\n  icon: 'add-sibling',\n  label: 'add sibling',\n  shortcut: 'enter',\n  opType: OpType.ADD_SIBLING\n}, {\n  icon: 'add-child',\n  label: 'add child',\n  shortcut: 'Tab',\n  rootCanUse: true,\n  opType: OpType.ADD_CHILD\n}, {\n  icon: 'notes',\n  label: 'edit notes',\n  shortcut: 'Alt + D',\n  opType: OpType.START_EDITING_DESC\n}, {\n  icon: 'delete-node',\n  label: 'delete node',\n  shortcut: 'Del',\n  opType: OpType.DELETE_TOPIC\n}];\n\nfunction customizeTopicContextMenu(props) {\n  var topicKey = props.topicKey,\n      model = props.model,\n      controller = props.controller;\n  var isRoot = topicKey === model.editorRootTopicKey;\n\n  function onClickItem(item) {\n    return function (e) {\n      item.opType && controller.run('operation', __assign(__assign({}, props), {\n        opType: item.opType\n      }));\n    };\n  }\n\n  return items.map(function (item) {\n    return isRoot && !item.rootCanUse ? null : createElement(MenuItem, {\n      key: item.label,\n      icon: Icon(item.icon),\n      text: item.label,\n      labelElement: createElement(\"kbd\", null, item.shortcut),\n      onClick: onClickItem(item)\n    });\n  });\n}\n\nvar log$a = debug('plugin:rendering');\n\nfunction RenderingPlugin() {\n  var DiagramRoot = styled.div(templateObject_1$g || (templateObject_1$g = __makeTemplateObject([\"\\n    width: 100%;\\n    height: 100%;\\n    background: \", \";\\n    position: relative;\\n  \"], [\"\\n    width: 100%;\\n    height: 100%;\\n    background: \", \";\\n    position: relative;\\n  \"])), function (props) {\n    return props.theme.background;\n  });\n  return {\n    renderDiagram: function (props) {\n      var model = props.model,\n          controller = props.controller;\n      return createElement(SaveRef, null, function (saveRef, getRef) {\n        var widgetProps = __assign(__assign({}, props), {\n          saveRef: saveRef,\n          getRef: getRef\n        });\n\n        log$a('renderDiagram', model);\n        return createElement(Theme, {\n          theme: model.config.theme\n        }, createElement(DiagramRoot, null, createElement(MindDragScrollWidget, __assign({}, widgetProps)), controller.run('renderDiagramCustomize', widgetProps)));\n      });\n    },\n    renderDiagramCustomize: function (props) {\n      var controller = props.controller,\n          model = props.model;\n      var styleEditor = controller.run('renderStyleEditor', __assign(__assign({}, props), {\n        topicKey: model.focusKey\n      }));\n      var modals = controller.run('renderModals', __assign(__assign({}, props), {\n        topicKey: model.focusKey\n      }));\n      return [styleEditor, modals];\n    },\n    renderModals: function (props) {\n      return createElement(Modals, __assign({\n        key: \"modals\"\n      }, props));\n    },\n    renderModal: function (props) {\n      var controller = props.controller,\n          model = props.model;\n      var activeModalProps = controller.run('getActiveModalProps', props);\n\n      if (activeModalProps) {\n        if (activeModalProps.name === 'edit-desc') {\n          var modalProps = __assign(__assign({}, props), {\n            topicKey: model.focusKey\n          });\n\n          return createElement(ModalBody, null, createElement(ModalDescEditor, null, controller.run('renderTopicDescEditor', modalProps)));\n        }\n      }\n\n      return null;\n    },\n    getActiveModalProps: function (props) {\n      var model = props.model;\n      if (model.focusKey && model.focusMode === FocusMode.EDITING_DESC) return {\n        name: 'edit-desc',\n        title: 'Edit Notes',\n        style: {\n          width: '50%',\n          height: '600px'\n        }\n      };\n      return null;\n    },\n    renderDoc: function (_a) {\n      var children = _a.children;\n      return children;\n    },\n    renderRootWidget: function (props) {\n      return createElement(RootWidget, __assign({}, props));\n    },\n    renderTopicWidget: function (props) {\n      return createElement(TopicWidget, __assign({}, props));\n    },\n    renderTopicContent: function (props) {\n      return createElement(TopicContentWidget, __assign({}, props));\n    },\n    renderTopicContextMenu: function (props) {\n      return createElement(TopicContextMenu, __assign({}, props));\n    },\n    customizeTopicContextMenu: customizeTopicContextMenu,\n    renderTopicContentEditor: function (props) {\n      log$a('renderTopicContentEditor', props); // return <TopicContentEditor {...props} />;\n\n      return createElement(SimpleTopicContentEditor, __assign({}, props));\n    },\n    renderTopicDescEditor: function (props) {\n      return createElement(SimpleTopicDescEditor, __assign({}, props));\n    },\n    renderTopicCollapseIcon: function (props) {\n      return createElement(TopicCollapseIcon, __assign({}, props));\n    },\n    renderBlocks: function (props) {\n      var model = props.model,\n          topicKey = props.topicKey,\n          controller = props.controller;\n      var topic = model.getTopic(topicKey);\n      var blocks = topic.blocks;\n      var res = [];\n      var i = 0;\n      blocks.forEach(function (block) {\n        var b = controller.run('renderBlock', __assign(__assign({}, props), {\n          block: block,\n          blockKey: \"block-\" + i\n        }));\n\n        if (b) {\n          res.push(createElement(Fragment, {\n            key: \"block-\" + i\n          }, b));\n          i++;\n        }\n      });\n      return res;\n    },\n    renderBlock: function (props) {\n      var controller = props.controller,\n          block = props.block;\n\n      switch (block.type) {\n        case BlockType.CONTENT:\n          return controller.run('renderTopicContentEditor', props);\n\n        case BlockType.DESC:\n          return createElement(TopicDescIcon, __assign({}, props));\n      }\n    },\n    renderSubLinks: function (props) {\n      var saveRef = props.saveRef,\n          topicKey = props.topicKey,\n          model = props.model;\n      var topic = model.getTopic(topicKey);\n      if (topic.subKeys.size === 0 || topic.collapse) return null;\n      return createElement(TopicSubLinks, __assign({\n        ref: saveRef(linksRefKey(topicKey))\n      }, props));\n    },\n    renderRootSubLinks: function (props) {\n      var saveRef = props.saveRef,\n          topicKey = props.topicKey,\n          model = props.model;\n      var topic = model.getTopic(topicKey);\n      if (topic.subKeys.size === 0) return null;\n      return createElement(RootSubLinks, __assign({\n        ref: saveRef(linksRefKey(topicKey))\n      }, props));\n    },\n    renderFocusItemHighlight: function (props) {\n      var saveRef = props.saveRef;\n      return createElement(TopicHighlight, __assign({\n        ref: saveRef('focus-highlight')\n      }, props));\n    },\n    renderRootWidgetOtherChildren: function (props) {\n      var controller = props.controller;\n      return createElement(Fragment, null, controller.run('renderRootSubLinks', props), controller.run('renderFocusItemHighlight', props), controller.run('renderDragAndDropEffect', props));\n    },\n    renderStyleEditor: function (props) {\n      return createElement(StyleEditor, __assign({\n        key: \"style-editor\"\n      }, props));\n    }\n  };\n}\n\nvar templateObject_1$g;\n\nfunction ReactPlugin(options) {\n  var renderingPlugin = RenderingPlugin();\n  return [renderingPlugin];\n}\n\nfunction LayoutPlugin() {\n  return {\n    getPartTopics: function (_a) {\n      var layout = _a.layout,\n          model = _a.model,\n          topicKey = _a.topicKey;\n      var topic = model.getTopic(topicKey);\n      var subTopicCount = topic.subKeys.size;\n      var topics = topic.subKeys.toArray();\n\n      switch (layout) {\n        case DiagramLayoutType.LEFT_TO_RIGHT:\n          return {\n            R: topics\n          };\n\n        case DiagramLayoutType.RIGHT_TO_LEFT:\n          return {\n            L: topics\n          };\n\n        case DiagramLayoutType.LEFT_AND_RIGHT:\n          return {\n            L: topics.slice(Math.ceil(subTopicCount / 2), subTopicCount),\n            R: topics.slice(0, Math.ceil(subTopicCount / 2))\n          };\n\n        case DiagramLayoutType.TOP_TO_BOTTOM:\n          return {\n            B: topics\n          };\n      }\n    },\n    createSubTopics: function (_a) {\n      var props = _a.props,\n          topics = _a.topics;\n      var model = props.model,\n          topicKey = props.topicKey;\n      var topic = model.getTopic(topicKey);\n      if (topics.size === 0 || topic.collapse) return null;\n      var subTopics = [];\n      topics.forEach(function (tKey) {\n        var subTopicProps = __assign(__assign({}, props), {\n          topicKey: tKey\n        });\n\n        subTopics.push(createElement(TopicWidget, __assign({\n          key: tKey\n        }, subTopicProps)));\n      });\n      return {\n        subTopics: subTopics\n      };\n    },\n    layout: function (props) {\n      var getRef = props.getRef,\n          topicKey = props.topicKey;\n      var links = getRef(linksRefKey(topicKey));\n      var highlight = getRef('focus-highlight');\n      var dropEffect = getRef('drop-effect');\n      links && links.layout();\n      highlight && highlight.layout();\n      dropEffect && dropEffect.layout();\n    },\n    setLayoutDir: function (props) {\n      var layoutDir = props.layoutDir,\n          model = props.model,\n          controller = props.controller;\n      controller.change(ModelModifier.setLayoutDir({\n        model: model,\n        layoutDir: layoutDir\n      }));\n    }\n  };\n}\n\nvar log$b = debug('plugin:StylePlugin');\n\nfunction StylePlugin() {\n  var colorMap = new Map();\n  var colorIndex = 0;\n  return {\n    getTopicStyle: function (props) {\n      log$b('getTopicStyle');\n      var topicKey = props.topicKey,\n          model = props.model,\n          controller = props.controller;\n      var visualLevel = model.getTopicVisualLevel(topicKey);\n      var theme = model.config.theme;\n      var themeStyle;\n      if (visualLevel === TopicVisualLevel.ROOT) themeStyle = theme.rootTopic;else if (visualLevel === TopicVisualLevel.PRIMARY) themeStyle = theme.primaryTopic;else themeStyle = theme.normalTopic;\n\n      if (theme.randomColor) {\n        var randomColor = controller.run('getRandomColor', props);\n        themeStyle = __assign(__assign({}, themeStyle), {\n          background: randomColor,\n          borderColor: randomColor,\n          linkStyle: __assign(__assign({}, themeStyle.linkStyle), {\n            lineColor: randomColor\n          })\n        });\n      }\n\n      var topic = model.getTopic(topicKey);\n\n      if (!topic.style) {\n        return themeStyle;\n      }\n\n      var customStyle = JSON.parse(topic.style);\n      return __assign(__assign(__assign({}, themeStyle), customStyle), {\n        linkStyle: __assign(__assign({}, themeStyle.linkStyle), customStyle.linkStyle)\n      });\n    },\n    getLinkStyle: function (props) {\n      var topicKey = props.topicKey,\n          model = props.model,\n          controller = props.controller;\n      var visualLevel = model.getTopicVisualLevel(topicKey);\n      var theme = model.config.theme;\n      var linkStyle;\n      if (visualLevel === TopicVisualLevel.ROOT) linkStyle = theme.rootTopic.linkStyle;else if (visualLevel === TopicVisualLevel.PRIMARY) linkStyle = theme.primaryTopic.linkStyle;else linkStyle = theme.normalTopic.linkStyle;\n      var topic = model.getTopic(topicKey);\n\n      if (theme.randomColor) {\n        var randomColor = controller.run('getRandomColor', __assign(__assign({}, props), {\n          topicKey: topic.parentKey !== model.editorRootTopicKey ? topic.parentKey : topicKey\n        }));\n        linkStyle = __assign(__assign({}, linkStyle), {\n          lineColor: randomColor\n        });\n      }\n\n      if (!topic.style) {\n        return linkStyle;\n      }\n\n      var customStyle = JSON.parse(topic.style);\n      return __assign(__assign({}, linkStyle), customStyle.linkStyle);\n    },\n    getTopicThemeStyle: function (props) {\n      var topicKey = props.topicKey,\n          model = props.model;\n      var visualLevel = model.getTopicVisualLevel(topicKey);\n      var theme = model.config.theme;\n      if (visualLevel === TopicVisualLevel.ROOT) return theme.rootTopic;\n      if (visualLevel === TopicVisualLevel.PRIMARY) return theme.primaryTopic;\n      return theme.normalTopic;\n    },\n    getRandomColor: function (props) {\n      var topicKey = props.topicKey;\n      if (colorMap.has(topicKey)) return colorMap.get(topicKey);\n      var colors = ['#00CC99', '#FFEE88', '#A167A5', '#E5F993', '#F5C396', '#DB995A', '#83BCFF', '#ED7B84', '#F92A82', '#83BCFF'];\n      var color = colors[++colorIndex % colors.length];\n      colorMap.set(topicKey, color);\n      return color;\n    }\n  };\n}\n\nvar log$c = debug('plugin:event');\n\nfunction EventPlugin() {\n  return {\n    handleTopicClick: function (props) {\n      log$c('handleTopicClick');\n      var controller = props.controller,\n          model = props.model,\n          topicKey = props.topicKey;\n      if (model.focusKey === topicKey && model.focusMode === FocusMode.EDITING_CONTENT) return;\n      controller.run('operation', __assign(__assign({}, props), {\n        opType: OpType.FOCUS_TOPIC,\n        focusMode: FocusMode.NORMAL\n      }));\n    },\n    handleTopicDoubleClick: function (props) {\n      var controller = props.controller;\n      controller.run('operation', __assign(__assign({}, props), {\n        opType: OpType.FOCUS_TOPIC,\n        focusMode: FocusMode.EDITING_CONTENT\n      }));\n    },\n    handleTopicContextMenu: function (props) {\n      var controller = props.controller;\n      controller.run('operation', __assign(__assign({}, props), {\n        opType: OpType.FOCUS_TOPIC,\n        focusMode: FocusMode.SHOW_POPUP\n      }));\n    },\n    handleActiveModalClose: function (props) {\n      var controller = props.controller;\n      var activeModalProps = controller.run('getActiveModalProps', props);\n      if (activeModalProps == null) return null;\n\n      if (activeModalProps.name === 'edit-desc') {\n        return function () {\n          controller.run('operation', __assign(__assign({}, props), {\n            focusMode: FocusMode.NORMAL,\n            opType: OpType.FOCUS_TOPIC\n          }));\n        };\n      }\n    }\n  };\n}\n\nvar HotKeyName = {\n  ADD_CHILD: 'ADD_CHILD',\n  ADD_SIBLING: 'ADD_SIBLING',\n  DELETE_TOPIC: 'DELETE_TOPIC',\n  EDIT_NOTES: 'EDIT_NOTES'\n};\n\nfunction op(opType, props) {\n  var topicKey = props.topicKey,\n      model = props.model,\n      controller = props.controller;\n\n  if (topicKey === undefined) {\n    props = __assign(__assign({}, props), {\n      topicKey: model.focusKey\n    });\n  }\n\n  controller.run('operation', __assign(__assign({}, props), {\n    opType: opType\n  }));\n}\n\nfunction HotKeyPlugin() {\n  return {\n    customizeHotKeys: function (props) {\n      var hotKeyMap = new Map([[HotKeyName.ADD_CHILD, {\n        label: 'add child',\n        combo: 'tab',\n        onKeyDown: function (e) {\n          op(OpType.ADD_CHILD, props);\n        }\n      }], [HotKeyName.ADD_SIBLING, {\n        label: 'add sibling',\n        combo: 'enter',\n        onKeyDown: function (e) {\n          op(OpType.ADD_SIBLING, props);\n        }\n      }], [HotKeyName.DELETE_TOPIC, {\n        label: 'delete topic',\n        combo: 'del',\n        onKeyDown: function (e) {\n          op(OpType.DELETE_TOPIC, props);\n        }\n      }], [HotKeyName.EDIT_NOTES, {\n        label: 'edit notes',\n        combo: 'alt + d',\n        onKeyDown: function (e) {\n          op(OpType.START_EDITING_DESC, props);\n        }\n      }]]);\n      return hotKeyMap;\n    }\n  };\n}\n\nvar log$d = debug('node:topic-drop-effect');\nvar DropEffectSvg = styled.svg(templateObject_1$h || (templateObject_1$h = __makeTemplateObject([\"\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 2;\\n  pointer-events: none;\\n\"], [\"\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  z-index: 2;\\n  pointer-events: none;\\n\"])));\n\nvar TopicDropEffect =\n/** @class */\nfunction (_super) {\n  __extends(TopicDropEffect, _super);\n\n  function TopicDropEffect() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      content: null\n    };\n    return _this;\n  }\n\n  TopicDropEffect.prototype.layout = function () {\n    var props = this.props;\n    var _a = this.props,\n        getRef = _a.getRef,\n        model = _a.model,\n        controller = _a.controller;\n    var targetProps = controller.run('getDragTargetProps', props);\n    var key = targetProps.key,\n        dropDir = targetProps.dropDir;\n    log$d('layout', dropDir);\n\n    if (key === null) {\n      this.setState({\n        content: null\n      });\n      return;\n    }\n\n    var dropAreaRefKey;\n\n    if (dropDir === 'in') {\n      dropAreaRefKey = contentRefKey(key);\n    } else {\n      dropAreaRefKey = \"dropArea-\" + dropDir + \"-\" + key;\n    }\n\n    var contentRect = getRef(dropAreaRefKey).getBoundingClientRect();\n    var svgRect = getRef('svg-drop-effect').getBoundingClientRect();\n    var padding = 3;\n    var x = contentRect.left - svgRect.left - padding;\n    var y = contentRect.top - svgRect.top - padding;\n    var width = contentRect.width + 2 * padding;\n    var height = contentRect.height + 2 * padding;\n    this.setState({\n      content: createElement(\"g\", null, createElement(\"rect\", {\n        x: x,\n        y: y,\n        width: width,\n        height: height,\n        fill: \"none\",\n        stroke: model.config.theme.highlightColor,\n        strokeDasharray: \"5,5\",\n        strokeWidth: 2\n      }))\n    });\n  };\n\n  TopicDropEffect.prototype.render = function () {\n    var saveRef = this.props.saveRef;\n    return createElement(DropEffectSvg, {\n      ref: saveRef('svg-drop-effect')\n    }, this.state.content);\n  };\n\n  return TopicDropEffect;\n}(BaseWidget);\n\nvar templateObject_1$h;\nvar log$e = debug('plugin:drag-and-drop');\nvar DropArea = styled.div(templateObject_1$i || (templateObject_1$i = __makeTemplateObject([\"\\n  height: \", \";\\n  width: 100%;\\n  margin: 5px 0px;\\n\"], [\"\\n  height: \", \";\\n  width: 100%;\\n  margin: 5px 0px;\\n\"])), function (props) {\n  return props.height + \"px\";\n});\nvar DropEffects = styled.svg(templateObject_2$8 || (templateObject_2$8 = __makeTemplateObject([\"\"], [\"\"])));\n\nfunction DragAndDrop() {\n  var dragTargetKey = null;\n  var dragTargetDir = null;\n  return {\n    renderTopicDropArea: function (props) {\n      var topicKey = props.topicKey,\n          dropDir = props.dropDir,\n          saveRef = props.saveRef,\n          controller = props.controller,\n          model = props.model;\n\n      var onDragEnter = function (ev) {\n        log$e('onDragEnter', topicKey, dropDir);\n        controller.run('handleTopicDragEnter', __assign(__assign({}, props), {\n          ev: ev,\n          dropDir: dropDir\n        }));\n      };\n\n      var onDragLeave = function (ev) {\n        log$e('onDragLeave', topicKey, dropDir);\n        controller.run('handleTopicDragLeave', __assign(__assign({}, props), {\n          ev: ev,\n          dropDir: dropDir\n        }));\n      };\n\n      var onDragOver = function (ev) {\n        ev.preventDefault();\n      };\n\n      var onDrop = function (ev) {\n        log$e('onDrop', topicKey, dropDir);\n        controller.run('handleTopicDrop', __assign(__assign({}, props), {\n          ev: ev,\n          dropDir: dropDir\n        }));\n      };\n\n      var eventHandlers = {\n        onDragEnter: onDragEnter,\n        onDragLeave: onDragLeave,\n        onDragOver: onDragOver,\n        onDrop: onDrop\n      };\n      return createElement(DropArea, __assign({\n        height: model.config.theme.marginV / 2,\n        ref: saveRef(\"dropArea-\" + dropDir + \"-\" + topicKey)\n      }, eventHandlers));\n    },\n    renderDragAndDropEffect: function (props) {\n      log$e('renderDragAndDropEffect');\n      var saveRef = props.saveRef;\n      return createElement(TopicDropEffect, __assign({\n        ref: saveRef('drop-effect')\n      }, props));\n    },\n    // getTopicDropEventHandlers(props) {\n    //   const { dropDir, controller, topicKey } = props;\n    //   const onDragEnter = ev => {\n    //     log('onDragEnter', topicKey, dropDir);\n    //     controller.run('handleTopicDragEnter', { ...props, ev, dropDir });\n    //   };\n    //   const onDragLeave = ev => {\n    //     log('onDragLeave', topicKey, dropDir);\n    //     controller.run('handleTopicDragLeave', { ...props, ev, dropDir });\n    //   };\n    //   const onDragOver = ev => {\n    //     ev.preventDefault();\n    //   };\n    //   const onDrop = ev => {\n    //     log('onDrop', topicKey, dropDir);\n    //     controller.run('handleTopicDrop', { ...props, ev, dropDir });\n    //   };\n    //   const eventHandlers = {\n    //     onDragEnter,\n    //     onDragLeave,\n    //     onDragOver,\n    //     onDrop\n    //   };\n    //   return eventHandlers;\n    // },\n    getDragTargetProps: function (props) {\n      return {\n        key: dragTargetKey,\n        dropDir: dragTargetDir\n      };\n    },\n    handleTopicDragStart: function (props) {\n      var controller = props.controller,\n          ev = props.ev;\n      ev.stopPropagation();\n      controller.run('operation', __assign(__assign({}, props), {\n        opType: OpType.FOCUS_TOPIC,\n        focusMode: FocusMode.DRAGGING\n      }));\n    },\n    canDrop: function (props) {\n      var srcKey = props.srcKey,\n          dstKey = props.dstKey,\n          model = props.model,\n          dropDir = props.dropDir;\n      if (srcKey === model.editorRootTopicKey || srcKey === dstKey || getRelationship(model, srcKey, dstKey) === TopicRelationship.ANCESTOR) return false;\n      if (dstKey === model.editorRootTopicKey && dropDir !== 'in') return false;\n      var srcTopic = model.getTopic(srcKey);\n      if (srcTopic.parentKey === dstKey && dropDir === 'in') return false;\n      return true;\n    },\n    handleTopicDragEnter: function (props) {\n      var dropDir = props.dropDir,\n          topicKey = props.topicKey,\n          controller = props.controller,\n          model = props.model,\n          ev = props.ev;\n      log$e('handleTopicDragEnter:', topicKey, dropDir);\n      var canDrop = controller.run('canDrop', __assign(__assign({}, props), {\n        srcKey: model.focusKey,\n        dstKey: topicKey\n      }));\n\n      if (canDrop) {\n        dragTargetKey = topicKey;\n        dragTargetDir = dropDir;\n        controller.change(model);\n      }\n    },\n    handleTopicDragLeave: function (props) {\n      var controller = props.controller,\n          model = props.model,\n          topicKey = props.topicKey,\n          dropDir = props.dropDir,\n          getRef = props.getRef,\n          ev = props.ev;\n      var relatedTarget = ev.nativeEvent.relatedTarget;\n      log$e('handleTopicDragLeave:', topicKey, dropDir);\n      var content = getRef(contentRefKey(topicKey));\n\n      if (content == relatedTarget || content.contains(relatedTarget)) {\n        return;\n      }\n\n      dragTargetKey = null;\n      dragTargetDir = null;\n      controller.change(model);\n    },\n    handleTopicDrop: function (props) {\n      log$e('handleTopicDrop');\n      var controller = props.controller,\n          topicKey = props.topicKey,\n          model = props.model;\n      props = __assign(__assign({}, props), {\n        srcKey: model.focusKey,\n        dstKey: topicKey\n      });\n      dragTargetKey = null;\n      dragTargetDir = null;\n\n      if (controller.run('canDrop', props)) {\n        controller.run('operation', __assign(__assign({}, props), {\n          opType: OpType.DRAG_AND_DROP\n        }));\n      }\n    }\n  };\n}\n\nvar templateObject_1$i, templateObject_2$8;\n\nfunction DefaultPlugin() {\n  return [ReactPlugin(), LayoutPlugin(), OperationPlugin(), StylePlugin(), EventPlugin(), HotKeyPlugin(), DragAndDrop()];\n}\n\nvar log$f = debug('node:Diagram');\n\nvar Diagram =\n/** @class */\nfunction (_super) {\n  __extends(Diagram, _super);\n\n  function Diagram() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.resolveController = memoizeOne(function (plugins, commands, TheDefaultPlugin) {\n      if (plugins === void 0) {\n        plugins = [];\n      }\n\n      var defaultPlugin = TheDefaultPlugin();\n      _this.controller = new Controller({\n        plugins: [plugins, defaultPlugin],\n        commands: commands,\n        construct: false,\n        onChange: _this.props.onChange\n      });\n\n      _this.controller.run('onConstruct');\n    });\n    return _this;\n  }\n\n  Diagram.prototype.getDiagramProps = function () {\n    return this.diagramProps;\n  };\n\n  Diagram.prototype.renderHotkeys = function () {\n    log$f(\"renderHotkeys\");\n    var controller = this.diagramProps.controller;\n    var hotKeys = controller.run('customizeHotKeys', this.diagramProps);\n    if (hotKeys === null) return null;\n\n    if (!(hotKeys instanceof Map)) {\n      throw new TypeError('customizeHotKeys must return a Map');\n    }\n\n    log$f(hotKeys);\n    var children = [];\n    hotKeys.forEach(function (v, k) {\n      log$f(k, v);\n      children.push(createElement(Hotkey, __assign({\n        key: k\n      }, v, {\n        global: true\n      })));\n    });\n    return createElement(Hotkeys, null, children);\n  };\n\n  Diagram.prototype.render = function () {\n    var _a = this.props,\n        commands = _a.commands,\n        plugins = _a.plugins,\n        model = _a.model;\n    this.resolveController(plugins, commands, DefaultPlugin);\n    this.diagramProps = __assign(__assign({}, this.props), {\n      controller: this.controller,\n      model: model,\n      diagram: this\n    });\n    return this.controller.run('renderDiagram', this.diagramProps);\n  };\n\n  Diagram = __decorate([HotkeysTarget], Diagram);\n  return Diagram;\n}(Component);\n\nexport { BaseWidget, Diagram, Icon, IconName, OpType, centerPointX, centerPointY, centerX, centerY, collapseRefKey, contentRefKey, getLinkKey, iconClassName, linksRefKey, linksSvgRefKey, topicRefKey };","map":{"version":3,"sources":["../src/components/common/base-widget.tsx","../src/components/common/save-ref.tsx","../src/components/common/drag-scroll-widget.tsx","../src/plugins/operation.ts","../src/utils/icon.tsx","../src/utils/keys.ts","../src/utils/index.ts","../src/plugins/react/components/topic-content-widget.tsx","../src/plugins/react/components/root-widget.tsx","../src/plugins/react/components/topic-widget.tsx","../src/plugins/react/components/topic-context-menu.tsx","../src/plugins/react/components/topic-collapse-icon.tsx","../src/plugins/react/components/style-editor/style-editor.tsx","../src/plugins/react/components/topic-sub-links.tsx","../src/plugins/react/components/root-sublinks.tsx","../src/plugins/react/components/topic-highlight.tsx","../src/plugins/react/components/mind-drag-scroll-widget.tsx","../src/plugins/react/components/modals.tsx","../src/plugins/react/components/topic-desc-icon.tsx","../src/plugins/react/components/simple-text-editor.tsx","../src/plugins/react/components/simple-topic-content-editor.tsx","../src/plugins/react/components/modal-body.tsx","../src/plugins/react/components/simple-topic-desc-editor.tsx","../src/plugins/react/theme.tsx","../src/plugins/react/context-menus.tsx","../src/plugins/react/rendering.tsx","../src/plugins/react/index.ts","../src/plugins/layout.tsx","../src/plugins/style.ts","../src/plugins/event.ts","../src/plugins/hotkey.ts","../src/plugins/react/components/topic-drop-effect.tsx","../src/plugins/drag-and-drop.tsx","../src/plugins/index.ts","../src/components/diagram.tsx"],"names":["React.PureComponent","React.Component","React.createElement","log","Icon","NodeContent","React.Fragment"],"mappings":"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","sourcesContent":["import * as React from 'react';\n\nimport { BaseProps } from '../base-props';\n\nexport class BaseWidget<\n  P extends BaseProps = BaseProps,\n  S = any\n> extends React.PureComponent<P, S> {\n  constructor(props: P) {\n    super(props);\n  }\n\n  operation(opType: string, arg: any) {\n    this.props.controller.run('operation', {\n      opType,\n      ...arg\n    });\n  }\n\n  run(name: string, arg: any) {\n    this.props.controller.run(name, arg);\n  }\n\n  get topic() {\n    return this.props.model.getTopic(this.props.topicKey);\n  }\n}\n","import * as React from 'react';\n\ninterface SaveRefProps {\n  children: (\n    saveRef: Function,\n    getRef: Function,\n    registerRefListener: Function\n  ) => React.ReactNode;\n}\n\ntype RefListener = (name: string, ref: HTMLElement) => void;\n\nexport class SaveRef extends React.Component<SaveRefProps> {\n  getRef = name => {\n    return this[name];\n  };\n\n  saveRef = name => {\n    return node => {\n      if (node) {\n        this[name] = node;\n        this.fireListener(name, node);\n      }\n    };\n  };\n\n  observers: Map<string, [RefListener]> = new Map();\n\n  fireListener = (name: string, ref: HTMLElement) => {\n    if (this.observers.has(name)) {\n      const listeners = this.observers.get(name);\n      for (const listener of listeners) {\n        listener(name, ref);\n      }\n    }\n  };\n\n  registerRefListener = (name, listener: RefListener) => {\n    if (!this.observers.has(name)) {\n      this.observers.set(name, [listener]);\n    } else {\n      this.observers.get(name).push(listener);\n    }\n  };\n\n  render() {\n    return this.props.children(\n      this.saveRef,\n      this.getRef,\n      this.registerRefListener.bind(this)\n    );\n  }\n}\n","import * as React from 'react';\nimport { BaseWidget } from './base-widget';\nimport ResizeObserver from 'resize-observer-polyfill';\nimport styled from 'styled-components';\n\nimport debug from 'debug';\nconst log = debug('node:drag-scroll-widget');\n\nconst DragScrollView = styled.div`\n  position: relative;\n  width: 100%;\n  height: 100%;\n  overflow: scroll;\n`;\n\nconst DragScrollContent = styled.div`\n  position: relative;\n  width: max-content;\n`;\n\ninterface DragScrollWidgetProps {\n  mouseKey?: 'left' | 'right';\n  needKeyPressed?: boolean;\n  canDragFunc?: () => Boolean;\n  children: (\n    setViewBoxScroll: (left: number, top: number) => void,\n    setViewBoxScrollDelta: (left: number, top: number) => void\n  ) => React.ReactNode;\n}\n\nexport class DragScrollWidget extends React.Component<\n  DragScrollWidgetProps,\n  any\n> {\n  constructor(props: DragScrollWidgetProps) {\n    super(props);\n    this.state = {\n      widgetStyle: {\n        width: '10000px',\n        height: '10000px'\n      }\n    };\n  }\n\n  static defaultProps = {\n    mouseKey: 'left',\n    needKeyPressed: false\n  };\n\n  contentResizeCallback = (\n    entries: ResizeObserverEntry[],\n    observer: ResizeObserver\n  ) => {\n    if (this.oldContentRect) {\n      const widgetStyle = {\n        width: this.content.clientWidth + this.viewBox.clientWidth * 2,\n        height: this.content.clientHeight + this.viewBox.clientHeight * 2\n      };\n      this.bigView.style.width = widgetStyle.width + 'px';\n      this.bigView.style.height = widgetStyle.height + 'px';\n    }\n    this.oldContentRect = entries[0].contentRect;\n  };\n\n  contentResizeObserver = new ResizeObserver(this.contentResizeCallback);\n  // oldScroll: { left: number; top: number };\n  oldContentRect: any;\n  content: HTMLElement;\n  contentRef = ref => {\n    if (ref) {\n      this.content = ref;\n      this.contentResizeObserver.observe(this.content);\n    }\n  };\n\n  viewBox: HTMLElement;\n  viewBoxRef = ref => {\n    if (ref) {\n      this.viewBox = ref;\n      this.setViewBoxScroll(\n        this.viewBox.clientWidth,\n        this.viewBox.clientHeight\n      );\n    }\n  };\n\n  bigView: HTMLElement;\n  bigViewRef = ref => {\n    if (ref) {\n      this.bigView = ref;\n    }\n  };\n\n  setWidgetStyle = () => {\n    if (this.content && this.viewBox && this.bigView) {\n      this.bigView.style.width =\n        (this.content.clientWidth + this.viewBox.clientWidth) * 2 + 'px';\n      this.bigView.style.height =\n        (this.content.clientHeight + this.viewBox.clientHeight) * 2 + 'px';\n\n      this.content.style.left = this.viewBox.clientWidth + 'px';\n      this.content.style.top = this.viewBox.clientHeight + 'px';\n    }\n  };\n\n  setViewBoxScroll = (left: number, top: number) => {\n    log(`setViewBoxScroll ${left} ${top}`);\n    if (this.viewBox) {\n      this.viewBox.scrollLeft = left;\n      this.viewBox.scrollTop = top;\n    }\n  };\n\n  setViewBoxScrollDelta = (deltaLeft: number, deltaTop: number) => {\n    log(`setViewBoxScrollDelta ${deltaLeft} ${deltaTop}`);\n    if (this.viewBox) {\n      this.viewBox.scrollLeft += deltaLeft;\n      this.viewBox.scrollTop += deltaTop;\n    }\n  };\n\n  onMouseDown = e => {\n    // log('Drag Scroll onMouseDown');\n    // log(e.nativeEvent.target);\n\n    // mouseKey 表示鼠标按下那个键才可以进行拖动，左键或者右键\n    // needKeyPressed 为了支持是否需要按下ctrl键，才可以进行拖动\n    // canDragFunc是一个函数，它是为了支持使用者以传入函数的方式，这个函数的返回值表示当前的内容是否可以被拖拽而移动\n    const { mouseKey, needKeyPressed, canDragFunc } = this.props;\n    if (canDragFunc && !canDragFunc()) return;\n    if (\n      (e.button === 0 && mouseKey === 'left') ||\n      (e.button === 2 && mouseKey === 'right')\n    ) {\n      if (needKeyPressed) {\n        if (!e.ctrlKey) return;\n      }\n      this._lastCoordX = this.viewBox.scrollLeft + e.nativeEvent.clientX;\n      this._lastCoordY = this.viewBox.scrollTop + e.nativeEvent.clientY;\n      window.addEventListener('mousemove', this.onMouseMove);\n      window.addEventListener('mouseup', this.onMouseUp);\n    }\n  };\n\n  onMouseUp = e => {\n    window.removeEventListener('mousemove', this.onMouseMove);\n    window.removeEventListener('mouseup', this.onMouseUp);\n  };\n\n  // _lastCoordX和_lastCorrdY 是为了在拖动过程中 计算 viewBox的scrollLeft和scrollTop值用到\n  // _lastCoordX和_lastCorrdY 记录下拖动开始时刻viewBox的scroll值和鼠标位置值\n  _lastCoordX: number;\n  _lastCoordY: number;\n\n  onMouseMove = (e: MouseEvent) => {\n    this.viewBox.scrollLeft = this._lastCoordX - e.clientX;\n    this.viewBox.scrollTop = this._lastCoordY - e.clientY;\n    // log(`onMouseMove ${this.viewBox.scrollLeft} ${this.viewBox.scrollTop}`);\n  };\n\n  handleContextMenu = e => {\n    e.preventDefault();\n  };\n\n  componentDidMount(): void {\n    this.setWidgetStyle();\n    document.addEventListener('contextmenu', this.handleContextMenu);\n  }\n\n  componentWillUnmount(): void {\n    document.removeEventListener('contextmenu', this.handleContextMenu);\n  }\n\n  render() {\n    return (\n      <DragScrollView ref={this.viewBoxRef} onMouseDown={this.onMouseDown}>\n        <div style={this.state.widgetStyle} ref={this.bigViewRef}>\n          <DragScrollContent\n            ref={this.contentRef}\n            style={this.state.contentStyle}\n          >\n            {this.props.children(\n              this.setViewBoxScroll,\n              this.setViewBoxScrollDelta\n            )}\n          </DragScrollContent>\n        </div>\n      </DragScrollView>\n    );\n  }\n}\n","import { ModelModifier, BlockType, FocusMode, Model } from '@blink-mind/core';\nimport { List, Stack } from 'immutable';\nimport debug from 'debug';\nconst log = debug('plugin:operation');\nexport const OpType = {\n  TOGGLE_COLLAPSE: 'TOGGLE_COLLAPSE',\n  ADD_CHILD: 'ADD_CHILD',\n  ADD_SIBLING: 'ADD_SIBLING',\n  DELETE_TOPIC: 'DELETE_TOPIC',\n  FOCUS_TOPIC: 'FOCUS_TOPIC',\n  SET_STYLE: 'SET_STYLE',\n  SET_TOPIC_CONTENT: 'SET_TOPIC_CONTENT',\n  SET_TOPIC_DESC: 'SET_TOPIC_DESC',\n  START_EDITING_CONTENT: 'START_EDITING_CONTENT',\n  START_EDITING_DESC: 'START_EDITING_DESC',\n  DRAG_AND_DROP: 'DRAG_AND_DROP'\n};\n\nexport function OperationPlugin() {\n  const startEditingContent = ({ model, topicKey }) => {\n    return ModelModifier.focusTopic({\n      model,\n      topicKey,\n      focusMode: FocusMode.EDITING_CONTENT\n    });\n  };\n  const startEditingDesc = ({ model, topicKey }) => {\n    const topic = model.getTopic(topicKey);\n    const desc = topic.getBlock(BlockType.DESC);\n    if (desc.block == null || desc.block.data == null) {\n      model = ModelModifier.setDesc({ model, topicKey, desc: '' });\n    }\n    return ModelModifier.focusTopic({\n      model,\n      topicKey,\n      focusMode: FocusMode.EDITING_DESC\n    });\n  };\n\n  function dragAndDrop(props) {\n    const { srcKey, dstKey, dropDir } = props;\n    let { model } = props;\n    const srcTopic = model.getTopic(srcKey);\n    const dstTopic = model.getTopic(dstKey);\n\n    const srcParentKey = srcTopic.parentKey;\n    const srcParentTopic = model.getTopic(srcParentKey);\n    let srcParentSubKeys = srcParentTopic.subKeys;\n    const srcIndex = srcParentSubKeys.indexOf(srcKey);\n\n    srcParentSubKeys = srcParentSubKeys.delete(srcIndex);\n\n    if (dropDir === 'in') {\n      let dstSubKeys = dstTopic.subKeys;\n      dstSubKeys = dstSubKeys.push(srcKey);\n      model = model.withMutations(m => {\n        m.setIn(['topics', srcParentKey, 'subKeys'], srcParentSubKeys)\n          .setIn(['topics', srcKey, 'parentKey'], dstKey)\n          .setIn(['topics', dstKey, 'subKeys'], dstSubKeys)\n          .setIn(['topics', dstKey, 'collapse'], false);\n      });\n    } else {\n      const dstParentKey = dstTopic.parentKey;\n      const dstParentItem = model.getTopic(dstParentKey);\n      let dstParentSubKeys = dstParentItem.subKeys;\n      const dstIndex = dstParentSubKeys.indexOf(dstKey);\n      //src 和 dst 的父亲相同，这种情况要做特殊处理\n      if (srcParentKey === dstParentKey) {\n        let newDstParentSubKeys = List();\n        dstParentSubKeys.forEach(key => {\n          if (key !== srcKey) {\n            if (key === dstKey) {\n              if (dropDir === 'prev') {\n                newDstParentSubKeys = newDstParentSubKeys\n                  .push(srcKey)\n                  .push(key);\n              } else {\n                newDstParentSubKeys = newDstParentSubKeys\n                  .push(key)\n                  .push(srcKey);\n              }\n            } else {\n              newDstParentSubKeys = newDstParentSubKeys.push(key);\n            }\n          }\n        });\n        model = model.withMutations(m => {\n          m.setIn(['topics', dstParentKey, 'subKeys'], newDstParentSubKeys);\n        });\n      } else {\n        if (dropDir === 'prev') {\n          dstParentSubKeys = dstParentSubKeys.insert(dstIndex, srcKey);\n        } else if (dropDir === 'next') {\n          dstParentSubKeys = dstParentSubKeys.insert(dstIndex + 1, srcKey);\n        }\n        model = model.withMutations(m => {\n          m.setIn(['topics', srcParentKey, 'subKeys'], srcParentSubKeys)\n            .setIn(['topics', srcKey, 'parentKey'], dstParentKey)\n            .setIn(['topics', dstParentKey, 'subKeys'], dstParentSubKeys)\n            .setIn(['topics', dstParentKey, 'collapse'], false);\n        });\n      }\n    }\n    return model;\n  }\n  const OpMap = new Map([\n    [OpType.TOGGLE_COLLAPSE, ModelModifier.toggleCollapse],\n    [OpType.ADD_CHILD, ModelModifier.addChild],\n    [OpType.ADD_SIBLING, ModelModifier.addSibling],\n    [OpType.DELETE_TOPIC, ModelModifier.deleteTopic],\n    [OpType.FOCUS_TOPIC, ModelModifier.focusTopic],\n    [OpType.SET_STYLE, ModelModifier.setStyle],\n    [OpType.SET_TOPIC_CONTENT, ModelModifier.setContent],\n    [OpType.SET_TOPIC_DESC, ModelModifier.setDesc],\n    [OpType.START_EDITING_CONTENT, startEditingContent],\n    [OpType.START_EDITING_DESC, startEditingDesc],\n    [OpType.DRAG_AND_DROP, dragAndDrop]\n  ]);\n\n  let undoStack = Stack<Model>();\n  let redoStack = Stack<Model>();\n\n  return {\n    getAllowUndo(props) {\n      const { model, opType } = props;\n      if (opType) {\n        switch (opType) {\n          case OpType.FOCUS_TOPIC:\n          case OpType.START_EDITING_CONTENT:\n            return false;\n          default:\n            break;\n        }\n      }\n      return model.config.allowUndo;\n    },\n\n    getUndoRedoStack() {\n      return {\n        undoStack,\n        redoStack\n      };\n    },\n\n    setUndoStack(props) {\n      log('setUndoStack', props.undoStack);\n      undoStack = props.undoStack;\n    },\n\n    setRedoStack(props) {\n      log('setRedoStack', props.redoStack);\n      redoStack = props.redoStack;\n    },\n\n    canUndo(props) {\n      const { controller } = props;\n      const { undoStack } = controller.run('getUndoRedoStack', props);\n      const allowUndo = controller.run('getAllowUndo', props);\n      return undoStack.size > 0 && allowUndo;\n    },\n\n    canRedo(props) {\n      const { controller } = props;\n      const { redoStack } = controller.run('getUndoRedoStack', props);\n      const allowUndo = controller.run('getAllowUndo', props);\n      return redoStack.size > 0 && allowUndo;\n    },\n\n    undo(props) {\n      const { controller, model } = props;\n      if (!controller.run('getAllowUndo', props)) {\n        return;\n      }\n      const { undoStack, redoStack } = controller.run(\n        'getUndoRedoStack',\n        props\n      );\n      const newModel = undoStack.peek();\n      if (!newModel) return;\n      controller.run('setUndoStack', {\n        ...props,\n        undoStack: undoStack.shift()\n      });\n      controller.run('setRedoStack', {\n        ...props,\n        redoStack: redoStack.push(model)\n      });\n      log(newModel);\n      controller.change(newModel);\n    },\n\n    redo(props) {\n      const { controller, model } = props;\n      if (!controller.run('getAllowUndo', props)) {\n        return;\n      }\n      const { undoStack, redoStack } = controller.run(\n        'getUndoRedoStack',\n        props\n      );\n      const newModel = redoStack.peek();\n      if (!newModel) return;\n      controller.run('setUndoStack', {\n        ...props,\n        undoStack: undoStack.push(model)\n      });\n      controller.run('setRedoStack', {\n        ...props,\n        redoStack: redoStack.shift()\n      });\n      controller.change(newModel);\n    },\n\n    beforeOperation(props) {},\n    operation(props) {\n      const { opType, controller, model } = props;\n      log('operation:', opType);\n      controller.run('beforeOperation', props);\n      if (OpMap.has(opType)) {\n        if (controller.run('getAllowUndo', props)) {\n          const { undoStack } = controller.run('getUndoRedoStack', props);\n          controller.run('setUndoStack', {\n            ...props,\n            undoStack: undoStack.push(model)\n          });\n        }\n\n        const opFunc = OpMap.get(opType);\n        const newModel = opFunc(props);\n        controller.change(newModel);\n      }\n      controller.run('afterOperation', props);\n    },\n    afterOperation(props) {}\n  };\n}\n","import * as React from 'react';\nexport const IconName = {\n  SHOW_MENU: 'show-menu',\n  CLOSE: 'close',\n  COLOR_PICKER: 'color-picker',\n  NOTES: 'notes'\n};\n\nexport function iconClassName(name) {\n  return `icon iconfont bm-${name}`;\n}\n\nexport function Icon(iconName) {\n  return <span className={iconClassName(iconName)} />;\n}\n","export function contentRefKey(key) {\n  return `content-${key}`;\n}\n\nexport function topicRefKey(key) {\n  return `topic-${key}`;\n}\n\nexport function linksRefKey(key) {\n  return `links-${key}`;\n}\n\nexport function linksSvgRefKey(key) {\n  return `links-svg-${key}`;\n}\n\nexport function collapseRefKey(key) {\n  return `collapse-${key}`;\n}\n","import { KeyType } from '@blink-mind/core';\n\nexport function getLinkKey(fromKey: KeyType, toKey: KeyType) {\n  return `link-${fromKey}-${toKey}`;\n}\n\nexport type Point = {\n  x: number;\n  y: number;\n};\n\nexport function centerY(rect: ClientRect) {\n  return (rect.top + rect.bottom) / 2;\n}\n\nexport function centerX(rect: ClientRect) {\n  return (rect.left + rect.right) / 2;\n}\n\nexport function centerPointX(p1, p2) {\n  return (p1.x + p2.x) / 2;\n}\n\nexport function centerPointY(p1, p2) {\n  return (p1.y + p2.y) / 2;\n}\n\nexport * from './icon';\nexport * from './keys';\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { ContextMenuTarget } from '@blueprintjs/core';\nimport { TopicDirection, KeyType, TopicVisualLevel } from '@blink-mind/core';\nimport { BaseProps } from '../../../components/base-props';\nimport debug from 'debug';\nimport { BaseWidget } from '../../../components/common';\nimport { OpType } from '../../operation';\nimport { collapseRefKey, contentRefKey } from '../../../utils';\n\nconst log = debug('node:topic-content-widget');\n\ninterface TopicContentProps {\n  dragEnter?: boolean;\n}\n\nconst TopicContent = styled.div<TopicContentProps>`\n  display: flex;\n  align-items: center;\n  word-wrap: break-word;\n  white-space: pre-line;\n  cursor: pointer;\n  overflow: hidden;\n`;\n\nconst TopicContentWithDropArea = styled.div`\n  position: relative;\n`;\n\ninterface Props extends BaseProps {\n  draggable: boolean;\n}\n\ninterface State {\n  dragEnter: boolean;\n  showPopMenu: boolean;\n}\n\n@ContextMenuTarget\nexport class TopicContentWidget extends BaseWidget<Props, State> {\n  constructor(props) {\n    super(props);\n    this.state = {\n      dragEnter: false,\n      showPopMenu: false\n    };\n  }\n\n  onDragStart = ev => {\n    this.run('handleTopicDragStart', { ...this.props, ev });\n  };\n\n  onDragOver = ev => {\n    ev.preventDefault();\n  };\n\n  onDragEnter = ev => {\n    this.run('handleTopicDragEnter', { ...this.props, ev, dropDir: 'in' });\n  };\n\n  onDragLeave = ev => {\n    this.run('handleTopicDragLeave', { ...this.props, ev, dropDir: 'in' });\n  };\n\n  onDrop = ev => {\n    this.run('handleTopicDrop', { ...this.props, ev, dropDir: 'in' });\n  };\n\n  public renderContextMenu() {\n    const { controller } = this.props;\n    return controller.run('renderTopicContextMenu', this.props);\n  }\n\n  public onContextMenuClose() {\n    // Optional method called once the context menu is closed.\n  }\n\n  isDoubleClick: boolean;\n\n  onClick = ev => {\n    this.isDoubleClick = false;\n    log(ev.nativeEvent);\n    const props = this.props;\n    const { controller } = props;\n    setTimeout(() => {\n      if (!this.isDoubleClick) {\n        controller.run('handleTopicClick', { ...props, ev });\n      }\n    });\n  };\n\n  onDoubleClick = ev => {\n    this.isDoubleClick = true;\n    const { controller } = this.props;\n    controller.run('handleTopicDoubleClick', { ...this.props, ev });\n  };\n\n  onContextMenu = ev => {\n    const { controller } = this.props;\n    controller.run('handleTopicContextMenu', { ...this.props, ev });\n    this.setState({\n      showPopMenu: true\n    });\n  };\n\n  handlePopMenuVisibleChange = visible => {\n    this.setState({\n      showPopMenu: visible\n    });\n  };\n\n  needRelocation: boolean = false;\n  oldCollapseIconRect: ClientRect;\n\n  componentDidUpdate() {\n    if (this.needRelocation) {\n      const { getRef, topicKey, setViewBoxScrollDelta } = this.props;\n      const newRect = getRef(collapseRefKey(topicKey)).getBoundingClientRect();\n      log('newRect:', newRect);\n      log('oldRect:', this.oldCollapseIconRect);\n      setViewBoxScrollDelta(\n        newRect.left - this.oldCollapseIconRect.left,\n        newRect.top - this.oldCollapseIconRect.top\n      );\n      this.needRelocation = false;\n    }\n  }\n\n  onClickCollapse = e => {\n    e.stopPropagation();\n    const { topicKey, getRef } = this.props;\n    this.needRelocation = true;\n    this.oldCollapseIconRect = getRef(\n      collapseRefKey(topicKey)\n    ).getBoundingClientRect();\n    this.operation(OpType.TOGGLE_COLLAPSE, this.props);\n  };\n\n  render() {\n    const props = this.props;\n    const { saveRef, topicKey, model, controller, topicStyle, dir } = props;\n    const draggable = model.editingContentKey !== topicKey;\n    const showPopMenu = this.state.showPopMenu;\n    const collapseIcon = controller.run('renderTopicCollapseIcon', {\n      ...props,\n      onClickCollapse: this.onClickCollapse.bind(this)\n    });\n    log(dir);\n    const prevDropArea = controller.run('renderTopicDropArea', {\n      ...props,\n      dropDir: 'prev'\n    });\n    const nextDropArea = controller.run('renderTopicDropArea', {\n      ...props,\n      dropDir: 'next'\n    });\n    const dropEventHandlers = {\n      onDragEnter: this.onDragEnter,\n      onDragLeave: this.onDragLeave,\n      onDragOver: this.onDragOver,\n      onDrop: this.onDrop\n    };\n    return (\n      <TopicContentWithDropArea>\n        {prevDropArea}\n        <TopicContent\n          // theme={getTopicTheme(visualLevel, model.config.theme)}\n          // dragEnter={this.state.dragEnter}\n          style={topicStyle}\n          draggable={draggable}\n          ref={saveRef(contentRefKey(topicKey))}\n          onDragStart={this.onDragStart}\n          onClick={this.onClick}\n          onDoubleClick={this.onDoubleClick}\n          onContextMenu={this.onContextMenu}\n          {...dropEventHandlers}\n        >\n          {controller.run('renderBlocks', props)}\n          {showPopMenu &&\n            controller.run('renderTopicPopupMenu', {\n              ...props,\n              handleVisibleChange: this.handlePopMenuVisibleChange,\n              visible: true\n            })}\n        </TopicContent>\n        {nextDropArea}\n        {dir !== TopicDirection.MAIN && collapseIcon}\n      </TopicContentWithDropArea>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { DiagramLayoutType, KeyType, TopicDirection } from '@blink-mind/core';\nimport debug from 'debug';\nimport { BaseProps } from '../../../components/base-props';\nimport { TopicSubLinks } from './topic-sub-links';\nimport { linksRefKey, topicRefKey } from '../../../utils';\n\nconst log = debug('RootNode');\n\nconst LayerPart = styled.div`\n  display: flex;\n  position: relative;\n\n  align-items: ${props =>\n    //@ts-ignore\n    props.topicDirection === TopicDirection.LEFT ? 'flex-end' : 'flex-start'};\n  flex-direction: column;\n\n  padding: ${props =>\n    //@ts-ignore\n    props.topicDirection === TopicDirection.LEFT\n      ? '15px 60px 15px 0px'\n      : '15px 0px 15px 60px'};\n`;\n\nconst Topic = styled.div`\n  display: flex;\n  position: relative;\n  align-items: center;\n  z-index: 3;\n`;\n\ninterface Props extends BaseProps {\n  setViewBoxScroll?: (left: number, top: number) => void;\n  setViewBoxScrollDelta?: (left: number, top: number) => void;\n}\n\nexport class RootWidget extends React.Component<Props> {\n  renderPartTopics(topics: KeyType[], dir: string) {\n    const { controller, saveRef } = this.props;\n    const res = controller.run('createSubTopics', {\n      props: { ...this.props, dir, isRoot: true },\n      topics\n    });\n    if (!res) return null;\n    const { subTopics } = res;\n    const cxName = `bm-layer-${dir === TopicDirection.LEFT ? 'left' : 'right'}`;\n    return (\n      //@ts-ignore\n      <LayerPart topicDirection={dir} ref={saveRef(cxName)}>\n        {subTopics}\n      </LayerPart>\n    );\n  }\n\n  componentDidMount(): void {\n    this.layout();\n  }\n\n  componentDidUpdate(): void {\n    this.layout();\n  }\n\n  layout() {\n    const { controller } = this.props;\n    controller.run('layout', this.props);\n  }\n\n  render() {\n    log('render');\n    const props = this.props;\n    const { model, topicKey, saveRef, controller, dir } = props;\n    const topicStyle = controller.run('getTopicStyle', props);\n    const config = model.config;\n    const topicContent = controller.run('renderTopicContent', {\n      ...props,\n      topicStyle,\n      dir: TopicDirection.MAIN\n    });\n    const partTopics = controller.run('getPartTopics', {\n      layout: config.layoutDir,\n      model,\n      topicKey\n    });\n    const rootTopic = (\n      <Topic ref={saveRef(topicRefKey(topicKey))}>{topicContent}</Topic>\n    );\n    const children = controller.run('renderRootWidgetOtherChildren', props);\n    switch (config.layoutDir) {\n      case DiagramLayoutType.LEFT_AND_RIGHT:\n        return (\n          <>\n            {this.renderPartTopics(partTopics.L, 'L')}\n            {rootTopic}\n            {this.renderPartTopics(partTopics.R, 'R')}\n            {children}\n          </>\n        );\n      case DiagramLayoutType.LEFT_TO_RIGHT:\n        return (\n          <>\n            {rootTopic}\n            {this.renderPartTopics(partTopics.R, 'R')}\n            {children}\n          </>\n        );\n      case DiagramLayoutType.RIGHT_TO_LEFT:\n        return (\n          <>\n            {this.renderPartTopics(partTopics.L, 'L')}\n            {rootTopic}\n            {children}\n          </>\n        );\n      case DiagramLayoutType.TOP_TO_BOTTOM:\n        return (\n          <>\n            {rootTopic}\n            {this.renderPartTopics(partTopics.B, 'B')}\n            {children}\n          </>\n        );\n    }\n    return null;\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { TopicDirection } from '@blink-mind/core';\nimport { BaseProps } from '../../../components/base-props';\nimport { TopicSubLinks } from './topic-sub-links';\nimport debug from 'debug';\nimport { linksRefKey, topicRefKey } from '../../../utils';\n\nconst log = debug('node:topic-widget');\n\ntype NodeProps = {\n  topicDirection: string;\n};\n\nconst Node = styled.div<NodeProps>`\n  display: flex;\n  align-items: center;\n  flex-direction: ${props =>\n    props.topicDirection === TopicDirection.RIGHT ? 'row' : 'row-reverse'};\n`;\n\ninterface NodeChildrenProps {\n  dir: string;\n  marginH: number;\n}\n\n// TODO\nconst NodeChildren = styled.div<NodeChildrenProps>`\n  position: relative;\n  padding: ${props =>\n    props.dir === TopicDirection.RIGHT\n      ? `0 0 0 ${props.marginH}px`\n      : `0 ${props.marginH}px 0 0`};\n`;\n\ninterface NodeTopicProps {\n  topicDirection: string;\n}\n\nconst NodeTopic = styled.div<NodeTopicProps>`\n  display: flex;\n  position: relative;\n  align-items: center;\n\n  flex-direction: ${props =>\n    props.topicDirection === TopicDirection.RIGHT ? 'row' : 'row-reverse'};\n`;\n\ninterface Props extends BaseProps {\n  setViewBoxScroll?: (left: number, top: number) => void;\n  setViewBoxScrollDelta?: (left: number, top: number) => void;\n}\n\nexport class TopicWidget extends React.Component<Props> {\n  renderSubTopics() {\n    const props = this.props;\n    const { controller, model, topicKey, dir, saveRef, getRef } = props;\n    const topics = model.getTopic(topicKey).subKeys.toArray();\n    const res = controller.run('createSubTopics', { props, topics });\n    if (!res) return null;\n    const { subTopics } = res;\n    const subLinks = controller.run('renderSubLinks', props);\n    return (\n      <NodeChildren dir={dir} marginH={model.config.theme.marginH}>\n        {subTopics} {subLinks}\n      </NodeChildren>\n    );\n  }\n\n  componentDidUpdate(): void {\n    this.layoutLinks();\n  }\n\n  componentDidMount(): void {\n    this.layoutLinks();\n  }\n\n  layoutLinks() {\n    const { getRef, topicKey } = this.props;\n    const links: TopicSubLinks = getRef(linksRefKey(topicKey));\n    links && links.layout();\n  }\n\n  render() {\n    log('render');\n    const props = this.props;\n    const { controller, topicKey, dir, saveRef } = props;\n    const topicStyle = controller.run('getTopicStyle', props);\n    const propsMore = {\n      ...props,\n      topicStyle\n    };\n    const topicContent = controller.run('renderTopicContent', propsMore);\n\n    return (\n      <Node topicDirection={dir}>\n        <NodeTopic topicDirection={dir} ref={saveRef(topicRefKey(topicKey))}>\n          {topicContent}\n        </NodeTopic>\n        {this.renderSubTopics()}\n      </Node>\n    );\n  }\n}\n","import * as React from 'react';\nimport { Menu } from '@blueprintjs/core';\nimport { BaseWidget } from '../../../components/common';\n\nexport class TopicContextMenu extends BaseWidget {\n  render() {\n    const { controller } = this.props;\n    return (\n      <Menu>{controller.run('customizeTopicContextMenu', this.props)}</Menu>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled, { css } from 'styled-components';\nimport cx from 'classnames';\nimport { TopicDirection } from '@blink-mind/core';\nimport { collapseRefKey } from '../../../utils';\n\nconst Icon = styled.div`\n  position: absolute;\n  top: calc(50% - 10px);\n  ${({ dir }) => {\n    if (dir === TopicDirection.RIGHT)\n      return css`\n        right: -25px;\n      `;\n    if (dir === TopicDirection.LEFT)\n      return css`\n        left: -25px;\n      `;\n  }};\n  border-radius: 50%;\n  width: 20px;\n  height: 20px;\n  text-align: center;\n  //@ts-ignore\n  background: ${props => props.background};\n  cursor: pointer;\n  padding: 0;\n  font-size: 14px;\n  line-height: 20px;\n  border: 0;\n  z-index: 2;\n`;\n\nexport function TopicCollapseIcon(props) {\n  const { model, topicKey, topicStyle, dir, saveRef, onClickCollapse } = props;\n  const topic = model.getTopic(topicKey);\n  return topic.subKeys.size > 0 ? (\n    <Icon\n      ref={saveRef(collapseRefKey(topicKey))}\n      onClick={onClickCollapse}\n      background={topicStyle.background}\n      dir={dir}\n      className={cx({\n        icon: true,\n        iconfont: true,\n        [`bm-${topic.collapse ? 'plus' : 'minus'}`]: true\n      })}\n    />\n  ) : null;\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { Button, MenuItem, Popover } from '@blueprintjs/core';\nimport { Select } from '@blueprintjs/select';\nimport { BaseWidget } from '../../../../components/common';\nimport { SketchPicker } from 'react-color';\nimport { isEqual } from 'lodash';\nimport debug from 'debug';\nimport { OpType } from '../../../operation';\nimport { iconClassName, IconName } from '../../../../utils';\n\nconst log = debug('node:style-editor');\n\nconst StyleEditorRoot = styled.div`\n  position: absolute;\n  background: white;\n  right: 30px;\n  top: 20px;\n  border-radius: 2px;\n  z-index: 4;\n`;\n\nconst Title = styled.div`\n  height: 16px;\n`;\n\nconst CloseIcon = styled.div`\n  position: absolute;\n  right: 5px;\n  top: 5px;\n  cursor: pointer;\n  &:hover {\n    color: #1ea7fd;\n  }\n`;\n\nconst PopRoot = styled.div`\n  padding: 10px;\n`;\n\nconst ShowMenuIcon = styled.a`\n  font-size: 20px !important;\n`;\n\nconst IconBg = styled.div`\n  padding: 5px;\n  cursor: pointer;\n`;\n\nconst WithBorder = styled.div`\n  border: 1px solid grey;\n  cursor: pointer;\n  font-weight: bold;\n`;\n\nconst SettingTitle = styled.div`\n  margin-top: 10px;\n  margin-bottom: 5px;\n`;\n\nconst SettingItem = styled.span`\n  margin: 0px 10px 0px 0px;\n`;\n\nconst ColorBar = styled.div`\n  height: 3px;\n  width: 80%;\n  margin-left: 10%;\n  margin-right: 10%;\n  margin-bottom: 2px;\n  background: ${props => props.color};\n`;\n\nconst PxSelect = Select.ofType();\n\nconst renderItem = unit => (width, { handleClick, modifiers, query }) => {\n  return (\n    <MenuItem text={`${width}${unit}`} key={width} onClick={handleClick} />\n  );\n};\n\nexport class StyleEditor extends BaseWidget {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showPanel: false\n    };\n  }\n\n  setShowPanel = showPanel => () => {\n    this.setState({\n      showPanel: showPanel\n    });\n  };\n\n  setStyle = obj => {\n    const style = this.topic.style;\n    const styleObj = style ? JSON.parse(style) : {};\n    const newStyleObj = {\n      ...styleObj,\n      ...obj\n    };\n    if (!isEqual(styleObj, newStyleObj)) {\n      const newStyleStr = JSON.stringify(newStyleObj);\n      this.operation(OpType.SET_STYLE, { ...this.props, style: newStyleStr });\n    }\n  };\n\n  setLinkStyle = obj => {\n    const style = this.topic.style;\n    const styleObj = style ? JSON.parse(style) : {};\n    const newStyleObj = {\n      ...styleObj,\n      linkStyle: {\n        ...styleObj.linkStyle,\n        ...obj\n      }\n    };\n    if (!isEqual(styleObj, newStyleObj)) {\n      const newStyleStr = JSON.stringify(newStyleObj);\n      this.operation(OpType.SET_STYLE, { ...this.props, style: newStyleStr });\n    }\n  };\n\n  handleBorderWidthChange = value => {\n    log('handleBorderWithChange:', value);\n    this.setStyle({ borderWidth: `${value}px` });\n  };\n\n  handleBorderStyleChange = value => {\n    this.setStyle({ borderStyle: value });\n  };\n\n  handleBorderRadiusChange = value => {\n    log('handleBorderRadiusChange:', value);\n    this.setStyle({ borderRadius: `${value}px` });\n  };\n\n  handleLinkWidthChange = value => {\n    log('handleBorderRadiusChange:', value);\n    this.setLinkStyle({ lineWidth: `${value}px` });\n  };\n\n  handleBorderColorChange = color => {\n    log(color);\n    this.setStyle({ borderColor: color.hex });\n  };\n\n  handleBackgroundColorChange = color => {\n    log(color);\n    this.setStyle({ background: color.hex });\n  };\n\n  handleLinkColorChange = color => {\n    log(color);\n    this.setLinkStyle({ lineColor: color.hex });\n  };\n\n  render() {\n    const props = this.props;\n    const { controller, model } = props;\n    if (!model.focusKey) return null;\n    const topicStyle = controller.run('getTopicStyle', props);\n    const linkStyle = topicStyle.linkStyle;\n    if (!this.state.showPanel) {\n      return (\n        <StyleEditorRoot>\n          <IconBg onClick={this.setShowPanel(true)}>\n            <ShowMenuIcon className={iconClassName(IconName.SHOW_MENU)} />\n          </IconBg>\n        </StyleEditorRoot>\n      );\n    }\n\n    const borderWidthItems = [...Array(7).keys()];\n    const borderRadiusItems = [0, 5, 10, 15, 20, 25, 30, 35];\n    const borderStyleItems = ['none', 'solid', 'dotted', 'dashed', 'double'];\n    return (\n      <StyleEditorRoot>\n        <Title>\n          <CloseIcon\n            className={iconClassName(IconName.CLOSE)}\n            onClick={this.setShowPanel(false)}\n          />\n        </Title>\n        <PopRoot>\n          <SettingTitle>Border</SettingTitle>\n          <div>\n            <SettingItem>\n              <PxSelect\n                items={borderWidthItems}\n                itemRenderer={renderItem('px')}\n                filterable={false}\n                onItemSelect={this.handleBorderWidthChange}\n              >\n                <Button\n                  text={`width: ${\n                    topicStyle.borderWidth ? topicStyle.borderWidth : '0px'\n                  }`}\n                />\n              </PxSelect>\n            </SettingItem>\n            <SettingItem>\n              <PxSelect\n                items={borderStyleItems}\n                itemRenderer={renderItem('')}\n                filterable={false}\n                onItemSelect={this.handleBorderStyleChange}\n              >\n                <Button\n                  text={`style: ${\n                    topicStyle.borderStyle ? topicStyle.borderStyle : 'none'\n                  }`}\n                />\n              </PxSelect>\n            </SettingItem>\n            <SettingItem>\n              <PxSelect\n                items={borderRadiusItems}\n                itemRenderer={renderItem('px')}\n                filterable={false}\n                onItemSelect={this.handleBorderRadiusChange}\n              >\n                <Button text={`radius: ${topicStyle.borderRadius}`} />\n              </PxSelect>\n            </SettingItem>\n            <SettingItem>\n              <Popover>\n                <WithBorder>\n                  <div className={iconClassName(IconName.COLOR_PICKER)} />\n                  <ColorBar color={topicStyle.borderColor} />\n                </WithBorder>\n                <div>\n                  <SketchPicker\n                    color={topicStyle.borderColor}\n                    onChangeComplete={this.handleBorderColorChange}\n                  />\n                </div>\n              </Popover>\n            </SettingItem>\n          </div>\n          <SettingTitle>Background</SettingTitle>\n          <div>\n            <SettingItem>\n              <Popover>\n                <WithBorder>\n                  <div className={iconClassName(IconName.COLOR_PICKER)} />\n                  <ColorBar color={topicStyle.background} />\n                </WithBorder>\n                <div>\n                  <SketchPicker\n                    color={topicStyle.background}\n                    onChangeComplete={this.handleBackgroundColorChange}\n                  />\n                </div>\n              </Popover>\n            </SettingItem>\n          </div>\n          <SettingTitle>Link</SettingTitle>\n          <div>\n            <SettingItem>\n              <PxSelect\n                items={borderWidthItems}\n                itemRenderer={renderItem('px')}\n                filterable={false}\n                onItemSelect={this.handleLinkWidthChange}\n              >\n                <Button\n                  text={`width: ${linkStyle ? linkStyle.lineWidth : '0px'}`}\n                />\n              </PxSelect>\n            </SettingItem>\n            <SettingItem>\n              <Popover>\n                <WithBorder>\n                  <div className={iconClassName(IconName.COLOR_PICKER)} />\n                  <ColorBar color={topicStyle.background} />\n                </WithBorder>\n                <div>\n                  <SketchPicker\n                    color={topicStyle.background}\n                    onChangeComplete={this.handleLinkColorChange}\n                  />\n                </div>\n              </Popover>\n            </SettingItem>\n          </div>\n        </PopRoot>\n      </StyleEditorRoot>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { TopicDirection, TopicStyle } from '@blink-mind/core';\nimport { BaseWidget } from '../../../components/common';\nimport { BaseProps } from '../../../components/base-props';\nimport {\n  Point,\n  centerX,\n  centerY,\n  centerPointX,\n  centerPointY\n} from '../../../utils';\n\nimport { collapseRefKey, contentRefKey, linksSvgRefKey } from '../../../utils';\nconst TopicLinksSvg = styled.svg`\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1;\n  pointer-events: none;\n`;\nimport debug from 'debug';\nconst log = debug('node:topic-sub-links');\n\ninterface Props extends BaseProps {}\n\ninterface State {\n  curves: any[];\n}\n\nexport class TopicSubLinks extends BaseWidget<Props, State> {\n  state = {\n    curves: []\n  };\n  layout() {\n    const props = this.props;\n    const { model, getRef, topicKey, dir, controller } = props;\n    const topic = model.getTopic(topicKey);\n    const content = getRef(contentRefKey(topicKey));\n    const svgRect: ClientRect = getRef(\n      linksSvgRefKey(topicKey)\n    ).getBoundingClientRect();\n    const collapseRect: ClientRect = getRef(\n      collapseRefKey(topicKey)\n    ).getBoundingClientRect();\n    const contentRect = content.getBoundingClientRect();\n\n    let p1: Point, p2: Point, p3: Point;\n\n    if (dir === TopicDirection.RIGHT) {\n      p1 = {\n        x: 0,\n        y: centerY(contentRect) - svgRect.top\n      };\n      p2 = {\n        x: collapseRect.right - svgRect.left + 10,\n        y: p1.y\n      };\n    } else if (dir === TopicDirection.LEFT) {\n      p1 = {\n        x: svgRect.right,\n        y: centerY(contentRect) - svgRect.top\n      };\n      p2 = {\n        x: collapseRect.left - svgRect.left - 10,\n        y: p1.y\n      };\n    }\n    const curves = [];\n\n    topic.subKeys.forEach(key => {\n      let curve;\n      const linkStyle = controller.run('getLinkStyle', {\n        ...props,\n        topicKey: key\n      });\n\n      const rect = getRef(contentRefKey(key)).getBoundingClientRect();\n      if (dir === TopicDirection.RIGHT) {\n        p3 = {\n          x: rect.left - svgRect.left,\n          y: centerY(rect) - svgRect.top\n        };\n      }\n      if (dir === TopicDirection.LEFT) {\n        p3 = {\n          x: rect.right - svgRect.left,\n          y: centerY(rect) - svgRect.top\n        };\n      }\n      const { lineType } = linkStyle;\n      if (lineType === 'curve') {\n        curve = `M ${p1.x} ${p1.y} L ${p2.x} ${p2.y} C ${p2.x} ${centerPointY(\n          p2,\n          p3\n        )} ${centerPointX(p2, p3)} ${p3.y} ${p3.x} ${p3.y}`;\n      } else if (lineType === 'round') {\n        const vDir = p3.y > p1.y ? 1 : -1;\n        const hDir = p3.x > p1.x ? 1 : -1;\n        const radius = linkStyle.lineRadius;\n        if (p3.y === p1.y) {\n          curve = `M ${p1.x} ${p1.y} H ${p3.x}`;\n        } else {\n          // 0 表示逆时针 1 表示顺时针\n          curve = `M ${p1.x} ${p1.y} H ${p2.x} V ${p3.y -\n            vDir * radius} A ${radius} ${radius} 0 0 ${\n            vDir * hDir === 1 ? 0 : 1\n          } ${p2.x + radius * hDir} ${p3.y} H ${p3.x}`;\n        }\n      } else if (lineType === 'line') {\n        curve = `M ${p1.x} ${p1.y} H ${p2.x} L ${p3.x} ${p3.y}`;\n      }\n\n      curves.push(\n        <path\n          key={`link-${key}`}\n          d={curve}\n          strokeWidth={linkStyle.lineWidth}\n          stroke={linkStyle.lineColor}\n          fill=\"none\"\n        />\n      );\n    });\n\n    log('curves:', curves);\n    this.setState({\n      curves\n    });\n  }\n\n  render() {\n    const { topicKey, saveRef } = this.props;\n    return (\n      <TopicLinksSvg ref={saveRef(linksSvgRefKey(topicKey))}>\n        <g>{this.state.curves}</g>\n      </TopicLinksSvg>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { TopicDirection, TopicStyle } from '@blink-mind/core';\nimport { BaseWidget } from '../../../components/common';\nimport { BaseProps } from '../../../components/base-props';\nimport {\n  Point,\n  centerX,\n  centerY,\n  centerPointX,\n  centerPointY\n} from '../../../utils';\n\nimport debug from 'debug';\nimport { contentRefKey, linksSvgRefKey } from '../../../utils';\nconst RootLinksSvg = styled.svg`\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1;\n  pointer-events: none;\n`;\n\nconst log = debug('node:topic-sub-links');\n\ninterface Props extends BaseProps {}\n\ninterface State {\n  curves: any[];\n}\n\nexport class RootSubLinks extends BaseWidget<Props, State> {\n  state = {\n    curves: []\n  };\n\n  layout() {\n    const props = this.props;\n    const { model, getRef, topicKey, dir, controller } = props;\n    const topic = model.getTopic(topicKey);\n    const contentRect = getRef(contentRefKey(topicKey)).getBoundingClientRect();\n    const svgRect: ClientRect = getRef(\n      linksSvgRefKey(topicKey)\n    ).getBoundingClientRect();\n    let p1: Point, p2: Point;\n\n    p1 = {\n      x: centerX(contentRect) - svgRect.left,\n      y: centerY(contentRect) - svgRect.top\n    };\n    const curves = [];\n    topic.subKeys.forEach(key => {\n      const style = controller.run('getTopicStyle', {\n        ...props,\n        topicKey: key\n      });\n      const { linkStyle } = style;\n      const lineType = linkStyle.lineType;\n      const rect = getRef(contentRefKey(key)).getBoundingClientRect();\n      if (rect.left > contentRect.right) {\n        p2 = {\n          x: rect.left,\n          y: centerY(rect)\n        };\n      } else {\n        p2 = {\n          x: rect.right,\n          y: centerY(rect)\n        };\n      }\n      p2 = { x: p2.x - svgRect.left, y: p2.y - svgRect.top };\n      let curve;\n      if (lineType === 'curve') {\n        curve = `M ${p1.x} ${p1.y} C ${p1.x} ${centerPointY(\n          p1,\n          p2\n        )} ${centerPointX(p1, p2)} ${p2.y} ${p2.x} ${p2.y}`;\n      } else if (lineType === 'line') {\n        curve = `M ${p1.x} ${p1.y} L ${p2.x} ${p2.y}`;\n      } else if (lineType === 'round') {\n        const vDir = p2.y > p1.y ? 1 : -1;\n        const hDir = p2.x > p1.x ? 1 : -1;\n        const radius = linkStyle.lineRadius;\n        if (radius == null) {\n          throw new Error(\n            'link line type is round, but lineRadius is not provided!'\n          );\n        }\n        if (p2.y === p1.y) {\n          curve = `M ${p1.x} ${p1.y} H ${p2.x}`;\n        } else {\n          // 0 表示逆时针 1 表示顺时针\n          curve = `M ${p1.x} ${p1.y}  V ${p2.y -\n            vDir * radius} A ${radius} ${radius} 0 0 ${\n            vDir * hDir === 1 ? 0 : 1\n          } ${p1.x + radius * hDir} ${p2.y} H ${p2.x}`;\n        }\n      }\n      curves.push(\n        <path\n          key={`link-${key}`}\n          d={curve}\n          strokeWidth={style.linkStyle.lineWidth}\n          stroke={style.linkStyle.lineColor}\n          fill=\"none\"\n        />\n      );\n    });\n    this.setState({\n      curves\n    });\n  }\n\n  render() {\n    const { topicKey, saveRef } = this.props;\n    return (\n      <RootLinksSvg ref={saveRef(linksSvgRefKey(topicKey))}>\n        <g>{this.state.curves}</g>\n      </RootLinksSvg>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { BaseWidget } from '../../../components/common';\nimport { contentRefKey } from '../../../utils';\nimport { BaseProps } from '../../../components/base-props';\nimport { FocusMode } from '@blink-mind/core';\n\nconst FocusHighlightSvg = styled.svg`\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 2;\n  pointer-events: none;\n`;\n\ninterface State {\n  content: any;\n}\n\nexport class TopicHighlight extends BaseWidget<BaseProps, State> {\n  state = {\n    content: null\n  };\n\n  layout() {\n    const { getRef, model } = this.props;\n    const focusKey = model.focusKey;\n    const focusMode = model.focusMode;\n    if (!focusKey || focusMode === FocusMode.EDITING_CONTENT) {\n      this.setState({\n        content: null\n      });\n      return;\n    }\n    const contentRect = getRef(contentRefKey(focusKey)).getBoundingClientRect();\n    const svgRect = getRef('svg-highlight').getBoundingClientRect();\n    const padding = 3;\n    const x = contentRect.left - svgRect.left - padding;\n    const y = contentRect.top - svgRect.top - padding;\n    const width = contentRect.width + 2 * padding;\n    const height = contentRect.height + 2 * padding;\n    this.setState({\n      content: (\n        <rect\n          x={x}\n          y={y}\n          width={width}\n          height={height}\n          fill=\"none\"\n          stroke={model.config.theme.highlightColor}\n          strokeWidth={2}\n        />\n      )\n    });\n  }\n\n  render() {\n    const { saveRef } = this.props;\n    return (\n      <FocusHighlightSvg ref={saveRef('svg-highlight')}>\n        {this.state.content}\n      </FocusHighlightSvg>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { Controller, Model } from '@blink-mind/core';\nimport { DragScrollWidget } from '../../../components/common';\nimport { topicRefKey } from '../../../utils';\nconst NodeLayer = styled.div`\n  position: relative;\n  display: flex;\n  align-items: center;\n  padding: 5px;\n`;\n\nconst DIV = styled.div`\n  width: 100%;\n  height: 100%;\n  background: ${props => props.theme.background};\n`;\n\nexport interface MindDragScrollWidgetProps {\n  controller: Controller;\n  model: Model;\n  saveRef?: Function;\n  getRef?: Function;\n}\n\nexport class MindDragScrollWidget<\n  P extends MindDragScrollWidgetProps\n> extends React.Component<MindDragScrollWidgetProps> {\n  constructor(props: MindDragScrollWidgetProps) {\n    super(props);\n  }\n\n  componentDidMount(): void {\n    const { getRef, model } = this.props;\n    const rootTopic: HTMLElement = getRef(\n      topicRefKey(model.editorRootTopicKey)\n    );\n    const nodeLayer: HTMLElement = getRef('node-layer');\n    const rootTopicRect = rootTopic.getBoundingClientRect();\n    const nodeLayerRect = nodeLayer.getBoundingClientRect();\n    this.dragScrollWidget.setViewBoxScrollDelta(\n      0,\n      rootTopicRect.top -\n        nodeLayerRect.top -\n        this.dragScrollWidget.viewBox.getBoundingClientRect().height / 2 +\n        rootTopicRect.height\n    );\n  }\n\n  get dragScrollWidget(): DragScrollWidget {\n    return this.props.getRef('DragScrollWidget');\n  }\n\n  onClick = e => {};\n\n  render() {\n    const { saveRef, model, controller } = this.props;\n    const nodeKey = model.editorRootTopicKey;\n    return (\n      <DIV\n      // onClick={this.onClick}\n      >\n        <DragScrollWidget {...this.state} ref={saveRef('DragScrollWidget')}>\n          {(\n            setViewBoxScroll: (left: number, top: number) => void,\n            setViewBoxScrollDelta: (left: number, top: number) => void\n          ) => {\n            const rootWidgetProps = {\n              ...this.props,\n              topicKey: nodeKey,\n              setViewBoxScroll,\n              setViewBoxScrollDelta\n            };\n            return (\n              <NodeLayer ref={saveRef('node-layer')}>\n                {controller.run('renderRootWidget', rootWidgetProps)}\n              </NodeLayer>\n            );\n          }}\n        </DragScrollWidget>\n      </DIV>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { Classes, Dialog } from '@blueprintjs/core';\nimport { BaseProps } from '../../../components/base-props';\nimport { BaseWidget } from '../../../components/common';\n\ninterface Props extends BaseProps {\n  saveRef?: Function;\n}\nconst DescWrapper = styled.div`\n  border: 1px solid #d9d9d9;\n  height: calc(100% - 50px);\n  padding: 0 1rem;\n  overflow: auto;\n  margin: 0.5rem 0.5rem 0 0.5rem;\n`;\n\nexport class Modals extends BaseWidget<Props> {\n  handleClose = () => {\n    const { controller } = this.props;\n    const handleActiveModalClose = controller.run(\n      'handleActiveModalClose',\n      this.props\n    );\n\n    handleActiveModalClose && handleActiveModalClose();\n  };\n\n  render() {\n    const { controller } = this.props;\n    const onClose = controller.run('handleActiveModalClose', this.props);\n    const activeModal = controller.run('renderModal', this.props);\n    const activeModalProps = controller.run('getActiveModalProps', this.props);\n    return (\n      <Dialog\n        onClose={this.handleClose}\n        isOpen={activeModal !== null}\n        autoFocus\n        enforceFocus\n        usePortal\n        title={activeModalProps && activeModalProps.title}\n        style={activeModalProps && activeModalProps.style}\n      >\n        <div className={Classes.DIALOG_BODY} style={{ minHeight: 0 }}>\n          {activeModal}\n        </div>\n      </Dialog>\n    );\n  }\n}\n","import * as React from 'react';\nimport { iconClassName, IconName } from '../../../utils';\nimport { OpType } from '../../operation';\nimport { BlockType } from '@blink-mind/core';\nimport styled from 'styled-components';\n\nconst DescIcon = styled.div`\n  &:hover {\n  }\n`;\n\nexport function TopicDescIcon(props) {\n  const { controller, model, topicKey } = props;\n  const onClick = e => {\n    e.stopPropagation();\n    controller.run('operation', {\n      ...props,\n      opType: OpType.START_EDITING_DESC\n    });\n  };\n  const desc = model.getTopic(topicKey).getBlock(BlockType.DESC);\n  return (\n    desc.block && (\n      <DescIcon\n        onClick={onClick}\n        className={iconClassName(IconName.NOTES)}\n      ></DescIcon>\n    )\n  );\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\n\nconst ContentEditable = styled.span`\n  &:focus {\n    outline: 0px;\n  }\n`;\n\ninterface Props {\n  editorValue: any;\n  readOnly: boolean;\n  onChange: Function;\n}\n\nexport class SimpleTextEditor extends React.Component<Props> {\n  domNode;\n  domNodeRef = ref => {\n    this.domNode = ref;\n  };\n  render() {\n    return (\n      <ContentEditable\n        ref={this.domNodeRef}\n        // onInput={this.emitChange}\n        onBlur={this.emitChange.bind(this)}\n        contentEditable={!this.props.readOnly}\n        suppressContentEditableWarning\n      >\n        {this.props.editorValue}\n      </ContentEditable>\n    );\n  }\n  shouldComponentUpdate(nextProps) {\n    return nextProps.html !== this.domNode.innerHTML;\n  }\n\n  lastHtml: any;\n  emitChange = () => {\n    const html = this.domNode.innerHTML;\n    if (this.props.onChange && html !== this.lastHtml) {\n      this.props.onChange(html);\n    }\n    this.lastHtml = html;\n  };\n}\n","import * as React from 'react';\nimport { BaseProps } from '../../../components/base-props';\nimport styled from 'styled-components';\nimport { Block } from '@blink-mind/core';\nimport { BaseWidget } from '../../../components/common';\nimport { OpType } from '../../operation';\nimport debug from 'debug';\nimport { SimpleTextEditor } from './simple-text-editor';\nconst log = debug('node:topic-content-editor');\n\ninterface NodeContentProps {\n  readOnly?: boolean;\n}\n\nconst NodeContent = styled.div<NodeContentProps>`\n  padding: 6px;\n  background-color: ${props => (props.readOnly ? null : 'white')};\n  color: black;\n  cursor: ${props => (props.readOnly ? 'pointer' : 'text')};\n`;\n\ninterface Props extends BaseProps {\n  block: Block;\n}\n\nexport class SimpleTopicContentEditor extends BaseWidget<Props> {\n  onMouseDown = e => {\n    e.stopPropagation();\n  };\n\n  onMouseMove = e => {\n    e.stopPropagation();\n  };\n  onChange = value => {\n    this.operation(OpType.SET_TOPIC_CONTENT, { ...this.props, content: value });\n  };\n\n  render() {\n    const { model, topicKey, saveRef, block } = this.props;\n    const content = block.data;\n    const editingContentKey = model.editingContentKey;\n\n    const readOnly = !(topicKey === editingContentKey);\n    const key = `editor-${topicKey}`;\n    return (\n      <NodeContent\n        key={key}\n        readOnly={readOnly}\n        ref={saveRef(key)}\n        onMouseDown={this.onMouseDown}\n        onMouseMove={this.onMouseMove}\n      >\n        <SimpleTextEditor\n          editorValue={content}\n          readOnly={readOnly}\n          onChange={this.onChange}\n        />\n      </NodeContent>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\n\nexport const ModalBody = styled.div`\n  height: 100%;\n  flex: 1;\n  display: flex;\n  overflow: auto;\n  background: white;\n`;\n\nexport const ModalDescEditor = styled.div`\n  padding: 6px;\n  width: 100%;\n`;\n","import * as React from 'react';\nimport { BaseProps } from '../../../components/base-props';\nimport styled from 'styled-components';\nimport { Block, BlockType } from '@blink-mind/core';\nimport { BaseWidget } from '../../../components/common';\nimport { OpType } from '../../operation';\nimport debug from 'debug';\nimport { SimpleTextEditor } from './simple-text-editor';\nconst log = debug('node:topic-content-editor');\n\ninterface NodeContentProps {\n  readOnly?: boolean;\n}\n\nconst NodeContent = styled.div<NodeContentProps>`\n  padding: 6px;\n  background-color: ${props => (props.readOnly ? null : 'white')};\n  color: black;\n  cursor: ${props => (props.readOnly ? 'pointer' : 'text')};\n`;\n\ninterface Props extends BaseProps {\n  block: Block;\n}\n\nexport class SimpleTopicDescEditor extends BaseWidget<Props> {\n  onMouseDown = e => {\n    e.stopPropagation();\n  };\n\n  onMouseMove = e => {\n    e.stopPropagation();\n  };\n  onChange = value => {\n    this.operation(OpType.SET_TOPIC_DESC, { ...this.props, desc: value });\n  };\n\n  render() {\n    const { model, topicKey, saveRef } = this.props;\n    const block = model.getTopic(topicKey).getBlock(BlockType.DESC).block;\n    const content = block.data;\n    const editingDescKey = model.editingDescKey;\n\n    const readOnly = !(topicKey === editingDescKey);\n    const key = `desc-${topicKey}`;\n    return (\n      <NodeContent\n        key={key}\n        readOnly={readOnly}\n        ref={saveRef(key)}\n        onMouseDown={this.onMouseDown}\n        onMouseMove={this.onMouseMove}\n      >\n        <SimpleTextEditor\n          editorValue={content}\n          readOnly={readOnly}\n          onChange={this.onChange}\n        />\n      </NodeContent>\n    );\n  }\n}\n","import * as React from 'react';\nimport { ThemeProvider } from 'styled-components';\n\nexport default function Theme({ theme, children }) {\n  return (\n    //@ts-ignore\n    <ThemeProvider theme={theme}>\n      <React.Fragment>{children}</React.Fragment>\n    </ThemeProvider>\n  );\n}\n","import { OpType } from '../operation';\nimport { MenuItem } from '@blueprintjs/core';\nimport { Icon } from '../../utils';\nimport * as React from 'react';\n\nexport type TopicContextMenuItemConfig = {\n  icon?: string;\n  label?: string;\n  shortcut?: string;\n  opType?: string;\n  rootCanUse?: boolean;\n  hotKey?: string;\n};\n\nconst items: TopicContextMenuItemConfig[] = [\n  {\n    icon: 'edit',\n    label: 'edit',\n    rootCanUse: true,\n    opType: OpType.START_EDITING_CONTENT\n  },\n  {\n    icon: 'add-sibling',\n    label: 'add sibling',\n    shortcut: 'enter',\n    opType: OpType.ADD_SIBLING\n  },\n  {\n    icon: 'add-child',\n    label: 'add child',\n    shortcut: 'Tab',\n    rootCanUse: true,\n    opType: OpType.ADD_CHILD\n  },\n  {\n    icon: 'notes',\n    label: 'edit notes',\n    shortcut: 'Alt + D',\n    opType: OpType.START_EDITING_DESC\n  },\n  {\n    icon: 'delete-node',\n    label: 'delete node',\n    shortcut: 'Del',\n    opType: OpType.DELETE_TOPIC\n  }\n];\n\nexport function customizeTopicContextMenu(props) {\n  const { topicKey, model, controller } = props;\n  const isRoot = topicKey === model.editorRootTopicKey;\n  function onClickItem(item) {\n    return function(e) {\n      item.opType &&\n        controller.run('operation', { ...props, opType: item.opType });\n    };\n  }\n  return items.map(item =>\n    isRoot && !item.rootCanUse ? null : (\n      <MenuItem\n        key={item.label}\n        icon={Icon(item.icon)}\n        text={item.label}\n        labelElement={<kbd>{item.shortcut}</kbd>}\n        onClick={onClickItem(item)}\n      />\n    )\n  );\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { BlockType, FocusMode } from '@blink-mind/core';\nimport { TopicContentWidget } from './components/topic-content-widget';\nimport { RootWidget } from './components/root-widget';\nimport { TopicWidget } from './components/topic-widget';\nimport { TopicContextMenu } from './components/topic-context-menu';\nimport { TopicCollapseIcon } from './components/topic-collapse-icon';\nimport { StyleEditor } from './components/style-editor/style-editor';\nimport { TopicSubLinks } from './components/topic-sub-links';\nimport { RootSubLinks } from './components/root-sublinks';\nimport { linksRefKey } from '../../utils';\nimport { TopicHighlight } from './components/topic-highlight';\nimport { SaveRef } from '../../components/common';\nimport { MindDragScrollWidget } from './components/mind-drag-scroll-widget';\nimport { Modals } from './components/modals';\nimport { TopicDescIcon } from './components/topic-desc-icon';\nimport { SimpleTopicContentEditor } from './components/simple-topic-content-editor';\nimport { ModalBody, ModalDescEditor } from './components/modal-body';\nimport { SimpleTopicDescEditor } from './components/simple-topic-desc-editor';\nimport Theme from './theme';\nimport { customizeTopicContextMenu } from './context-menus';\nimport debug from 'debug';\nconst log = debug('plugin:rendering');\n\nexport function RenderingPlugin() {\n  const DiagramRoot = styled.div`\n    width: 100%;\n    height: 100%;\n    background: ${props => props.theme.background};\n    position: relative;\n  `;\n  return {\n    renderDiagram(props) {\n      const { model, controller } = props;\n      return (\n        <SaveRef>\n          {(saveRef, getRef) => {\n            const widgetProps = {\n              ...props,\n              saveRef,\n              getRef\n            };\n            log('renderDiagram', model);\n            return (\n              <Theme theme={model.config.theme}>\n                <DiagramRoot>\n                  <MindDragScrollWidget {...widgetProps} />\n                  {controller.run('renderDiagramCustomize', widgetProps)}\n                </DiagramRoot>\n              </Theme>\n            );\n          }}\n        </SaveRef>\n      );\n    },\n\n    renderDiagramCustomize(props) {\n      const { controller, model } = props;\n      const styleEditor = controller.run('renderStyleEditor', {\n        ...props,\n        topicKey: model.focusKey\n      });\n      const modals = controller.run('renderModals', {\n        ...props,\n        topicKey: model.focusKey\n      });\n      return [styleEditor, modals];\n    },\n\n    renderModals(props) {\n      return <Modals key=\"modals\" {...props} />;\n    },\n\n    renderModal(props) {\n      const { controller, model } = props;\n      const activeModalProps = controller.run('getActiveModalProps', props);\n      if (activeModalProps) {\n        if (activeModalProps.name === 'edit-desc') {\n          const modalProps = { ...props, topicKey: model.focusKey };\n          return (\n            <ModalBody>\n              <ModalDescEditor>\n                {controller.run('renderTopicDescEditor', modalProps)}\n              </ModalDescEditor>\n            </ModalBody>\n          );\n        }\n      }\n      return null;\n    },\n\n    getActiveModalProps(props) {\n      const { model } = props;\n      if (model.focusKey && model.focusMode === FocusMode.EDITING_DESC)\n        return {\n          name: 'edit-desc',\n          title: 'Edit Notes',\n          style: {\n            width: '50%',\n            height: '600px'\n          }\n        };\n      return null;\n    },\n\n    renderDoc({ children }) {\n      return children;\n    },\n\n    renderRootWidget(props) {\n      return <RootWidget {...props} />;\n    },\n\n    renderTopicWidget(props) {\n      return <TopicWidget {...props} />;\n    },\n\n    renderTopicContent(props) {\n      return <TopicContentWidget {...props} />;\n    },\n\n    renderTopicContextMenu(props) {\n      return <TopicContextMenu {...props} />;\n    },\n\n    customizeTopicContextMenu,\n\n    renderTopicContentEditor(props) {\n      log('renderTopicContentEditor', props);\n      // return <TopicContentEditor {...props} />;\n      return <SimpleTopicContentEditor {...props} />;\n    },\n\n    renderTopicDescEditor(props) {\n      return <SimpleTopicDescEditor {...props} />;\n    },\n\n    renderTopicCollapseIcon(props) {\n      return <TopicCollapseIcon {...props} />;\n    },\n\n    renderBlocks(props) {\n      const { model, topicKey, controller } = props;\n      const topic = model.getTopic(topicKey);\n      const blocks = topic.blocks;\n      const res = [];\n      let i = 0;\n      blocks.forEach(block => {\n        const b = controller.run('renderBlock', {\n          ...props,\n          block,\n          blockKey: `block-${i}`\n        });\n        if (b) {\n          res.push(<React.Fragment key={`block-${i}`}>{b}</React.Fragment>);\n          i++;\n        }\n      });\n      return res;\n    },\n\n    renderBlock(props) {\n      const { controller, block } = props;\n      switch (block.type) {\n        case BlockType.CONTENT:\n          return controller.run('renderTopicContentEditor', props);\n        case BlockType.DESC:\n          return <TopicDescIcon {...props} />;\n        default:\n          break;\n      }\n      return null;\n    },\n\n    renderSubLinks(props) {\n      const { saveRef, topicKey, model } = props;\n      const topic = model.getTopic(topicKey);\n      if (topic.subKeys.size === 0 || topic.collapse) return null;\n      return <TopicSubLinks ref={saveRef(linksRefKey(topicKey))} {...props} />;\n    },\n\n    renderRootSubLinks(props) {\n      const { saveRef, topicKey, model } = props;\n      const topic = model.getTopic(topicKey);\n      if (topic.subKeys.size === 0) return null;\n      return <RootSubLinks ref={saveRef(linksRefKey(topicKey))} {...props} />;\n    },\n\n    renderFocusItemHighlight(props) {\n      const { saveRef } = props;\n      return <TopicHighlight ref={saveRef('focus-highlight')} {...props} />;\n    },\n\n    renderRootWidgetOtherChildren(props) {\n      const { controller } = props;\n      return (\n        <>\n          {controller.run('renderRootSubLinks', props)}\n          {controller.run('renderFocusItemHighlight', props)}\n          {controller.run('renderDragAndDropEffect', props)}\n        </>\n      );\n    },\n\n    renderStyleEditor(props) {\n      return <StyleEditor key=\"style-editor\" {...props} />;\n    }\n  };\n}\n","import { RenderingPlugin } from './rendering';\n\nexport function ReactPlugin(options = {}) {\n  const renderingPlugin = RenderingPlugin();\n\n  return [renderingPlugin];\n}\n","import * as React from 'react';\nimport {\n  DiagramLayoutType,\n  Model,\n  KeyType,\n  ModelModifier\n} from '@blink-mind/core';\nimport { TopicWidget } from './react/components/topic-widget';\nimport { linksRefKey } from '../utils';\n\nexport type GetPartTopicsArg = {\n  layout: DiagramLayoutType;\n  model: Model;\n  topicKey: KeyType;\n};\nexport interface GetPartTopicsRes {\n  [part: number]: KeyType[];\n}\n\nexport function LayoutPlugin() {\n  return {\n    getPartTopics({\n      layout,\n      model,\n      topicKey\n    }: GetPartTopicsArg): GetPartTopicsRes {\n      const topic = model.getTopic(topicKey);\n      const subTopicCount = topic.subKeys.size;\n      const topics = topic.subKeys.toArray();\n      switch (layout) {\n        case DiagramLayoutType.LEFT_TO_RIGHT:\n          return { R: topics };\n        case DiagramLayoutType.RIGHT_TO_LEFT:\n          return { L: topics };\n        case DiagramLayoutType.LEFT_AND_RIGHT:\n          return {\n            L: topics.slice(Math.ceil(subTopicCount / 2), subTopicCount),\n            R: topics.slice(0, Math.ceil(subTopicCount / 2))\n          };\n        case DiagramLayoutType.TOP_TO_BOTTOM:\n          return {\n            B: topics\n          };\n      }\n    },\n\n    createSubTopics({ props, topics }) {\n      const { model, topicKey } = props;\n      const topic = model.getTopic(topicKey);\n      if (topics.size === 0 || topic.collapse) return null;\n      const subTopics = [];\n      topics.forEach(tKey => {\n        const subTopicProps = { ...props, topicKey: tKey };\n        subTopics.push(<TopicWidget key={tKey} {...subTopicProps} />);\n      });\n      return { subTopics };\n    },\n\n    layout(props) {\n      const { getRef, topicKey } = props;\n      const links = getRef(linksRefKey(topicKey));\n      const highlight = getRef('focus-highlight');\n      const dropEffect = getRef('drop-effect');\n      links && links.layout();\n      highlight && highlight.layout();\n      dropEffect && dropEffect.layout();\n    },\n\n    setLayoutDir(props) {\n      const { layoutDir, model, controller } = props;\n      controller.change(ModelModifier.setLayoutDir({ model, layoutDir }));\n    }\n  };\n}\n","import { TopicStyle, TopicVisualLevel } from '@blink-mind/core';\nimport debug from 'debug';\n\nconst log = debug('plugin:StylePlugin');\n\nexport function StylePlugin() {\n  const colorMap = new Map();\n  let colorIndex = 0;\n  return {\n    getTopicStyle(props): TopicStyle {\n      log('getTopicStyle');\n      const { topicKey, model, controller } = props;\n      const visualLevel = model.getTopicVisualLevel(topicKey);\n      const theme = model.config.theme;\n      let themeStyle;\n      if (visualLevel === TopicVisualLevel.ROOT) themeStyle = theme.rootTopic;\n      else if (visualLevel === TopicVisualLevel.PRIMARY)\n        themeStyle = theme.primaryTopic;\n      else themeStyle = theme.normalTopic;\n\n      if (theme.randomColor) {\n        const randomColor = controller.run('getRandomColor', props);\n        themeStyle = {\n          ...themeStyle,\n          background: randomColor,\n          borderColor: randomColor,\n          linkStyle: {\n            ...themeStyle.linkStyle,\n            lineColor: randomColor\n          }\n        };\n      }\n      const topic = model.getTopic(topicKey);\n      if (!topic.style) {\n        return themeStyle;\n      }\n      const customStyle = JSON.parse(topic.style);\n\n      return {\n        ...themeStyle,\n        ...customStyle,\n        linkStyle: {\n          ...themeStyle.linkStyle,\n          ...customStyle.linkStyle\n        }\n      };\n    },\n\n    getLinkStyle(props): LinkStyle {\n      const { topicKey, model, controller } = props;\n      const visualLevel = model.getTopicVisualLevel(topicKey);\n      const theme = model.config.theme;\n      let linkStyle;\n      if (visualLevel === TopicVisualLevel.ROOT)\n        linkStyle = theme.rootTopic.linkStyle;\n      else if (visualLevel === TopicVisualLevel.PRIMARY)\n        linkStyle = theme.primaryTopic.linkStyle;\n      else linkStyle = theme.normalTopic.linkStyle;\n\n      const topic = model.getTopic(topicKey);\n      if (theme.randomColor) {\n        const randomColor = controller.run('getRandomColor', {\n          ...props,\n          topicKey:\n            topic.parentKey !== model.editorRootTopicKey\n              ? topic.parentKey\n              : topicKey\n        });\n        linkStyle = {\n          ...linkStyle,\n          lineColor: randomColor\n        };\n      }\n\n      if (!topic.style) {\n        return linkStyle;\n      }\n      const customStyle = JSON.parse(topic.style);\n\n      return {\n        ...linkStyle,\n        ...customStyle.linkStyle\n      };\n    },\n\n    getTopicThemeStyle(props): TopicStyle {\n      const { topicKey, model } = props;\n      const visualLevel = model.getTopicVisualLevel(topicKey);\n      const theme = model.config.theme;\n      if (visualLevel === TopicVisualLevel.ROOT) return theme.rootTopic;\n      if (visualLevel === TopicVisualLevel.PRIMARY) return theme.primaryTopic;\n      return theme.normalTopic;\n    },\n\n    getRandomColor(props) {\n      const { topicKey } = props;\n      if (colorMap.has(topicKey)) return colorMap.get(topicKey);\n      const colors = [\n        '#00CC99',\n        '#FFEE88',\n        '#A167A5',\n        '#E5F993',\n        '#F5C396',\n        '#DB995A',\n        '#83BCFF',\n        '#ED7B84',\n        '#F92A82',\n        '#83BCFF'\n      ];\n      const color = colors[++colorIndex % colors.length];\n      colorMap.set(topicKey, color);\n      return color;\n    }\n  };\n}\n","import { OpType } from './operation';\nimport { FocusMode } from '@blink-mind/core';\n\nimport debug from 'debug';\n\nconst log = debug('plugin:event');\n\nexport function EventPlugin() {\n  return {\n    handleTopicClick(props) {\n      log('handleTopicClick');\n      const { controller, model, topicKey } = props;\n      if (\n        model.focusKey === topicKey &&\n        model.focusMode === FocusMode.EDITING_CONTENT\n      )\n        return;\n      controller.run('operation', {\n        ...props,\n        opType: OpType.FOCUS_TOPIC,\n        focusMode: FocusMode.NORMAL\n      });\n    },\n\n    handleTopicDoubleClick(props) {\n      const { controller } = props;\n      controller.run('operation', {\n        ...props,\n        opType: OpType.FOCUS_TOPIC,\n        focusMode: FocusMode.EDITING_CONTENT\n      });\n    },\n\n    handleTopicContextMenu(props) {\n      const { controller } = props;\n      controller.run('operation', {\n        ...props,\n        opType: OpType.FOCUS_TOPIC,\n        focusMode: FocusMode.SHOW_POPUP\n      });\n    },\n\n    handleActiveModalClose(props) {\n      const { controller } = props;\n      const activeModalProps = controller.run('getActiveModalProps', props);\n      if (activeModalProps == null) return null;\n      if (activeModalProps.name === 'edit-desc') {\n        return function() {\n          controller.run('operation', {\n            ...props,\n            focusMode: FocusMode.NORMAL,\n            opType: OpType.FOCUS_TOPIC\n          });\n        };\n      }\n    }\n  };\n}\n","import { OpType } from './operation';\n\nexport interface HotKeyConfig {\n  combo: string;\n  onKeyDown: Function;\n}\n\nexport const HotKeyName = {\n  ADD_CHILD: 'ADD_CHILD',\n  ADD_SIBLING: 'ADD_SIBLING',\n  DELETE_TOPIC: 'DELETE_TOPIC',\n  EDIT_NOTES: 'EDIT_NOTES'\n};\n\nfunction op(opType: string, props) {\n  const { topicKey, model, controller } = props;\n  if (topicKey === undefined) {\n    props = { ...props, topicKey: model.focusKey };\n  }\n  controller.run('operation', { ...props, opType });\n}\n\nexport function HotKeyPlugin() {\n  return {\n    customizeHotKeys(props) {\n      const hotKeyMap = new Map<string, HotKeyConfig>([\n        [\n          HotKeyName.ADD_CHILD,\n          {\n            label: 'add child',\n            combo: 'tab',\n            onKeyDown: e => {\n              op(OpType.ADD_CHILD, props);\n            }\n          }\n        ],\n        [\n          HotKeyName.ADD_SIBLING,\n          {\n            label: 'add sibling',\n            combo: 'enter',\n            onKeyDown: e => {\n              op(OpType.ADD_SIBLING, props);\n            }\n          }\n        ],\n        [\n          HotKeyName.DELETE_TOPIC,\n          {\n            label: 'delete topic',\n            combo: 'del',\n            onKeyDown: e => {\n              op(OpType.DELETE_TOPIC, props);\n            }\n          }\n        ],\n        [\n          HotKeyName.EDIT_NOTES,\n          {\n            label: 'edit notes',\n            combo: 'alt + d',\n            onKeyDown: e => {\n              op(OpType.START_EDITING_DESC, props);\n            }\n          }\n        ]\n      ]);\n      return hotKeyMap;\n    }\n  };\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { BaseWidget } from '../../../components/common';\nimport { contentRefKey } from '../../../utils';\nimport { BaseProps } from '../../../components/base-props';\nimport debug from 'debug';\nconst log = debug('node:topic-drop-effect');\n\nconst DropEffectSvg = styled.svg`\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 2;\n  pointer-events: none;\n`;\n\ninterface State {\n  content: any;\n}\n\nexport class TopicDropEffect extends BaseWidget<BaseProps, State> {\n  state = {\n    content: null\n  };\n\n  layout() {\n    const props = this.props;\n    const { getRef, model, controller } = this.props;\n    const targetProps = controller.run('getDragTargetProps', props);\n    const { key, dropDir } = targetProps;\n    log('layout', dropDir);\n\n    if (key === null) {\n      this.setState({\n        content: null\n      });\n      return;\n    }\n    let dropAreaRefKey;\n    if (dropDir === 'in') {\n      dropAreaRefKey = contentRefKey(key);\n    } else {\n      dropAreaRefKey = `dropArea-${dropDir}-${key}`;\n    }\n    const contentRect = getRef(dropAreaRefKey).getBoundingClientRect();\n    const svgRect = getRef('svg-drop-effect').getBoundingClientRect();\n    const padding = 3;\n    const x = contentRect.left - svgRect.left - padding;\n    const y = contentRect.top - svgRect.top - padding;\n    const width = contentRect.width + 2 * padding;\n    const height = contentRect.height + 2 * padding;\n\n    this.setState({\n      content: (\n        <g>\n          <rect\n            x={x}\n            y={y}\n            width={width}\n            height={height}\n            fill=\"none\"\n            stroke={model.config.theme.highlightColor}\n            strokeDasharray=\"5,5\"\n            strokeWidth={2}\n          />\n        </g>\n      )\n    });\n  }\n\n  render() {\n    const { saveRef } = this.props;\n    return (\n      <DropEffectSvg ref={saveRef('svg-drop-effect')}>\n        {this.state.content}\n      </DropEffectSvg>\n    );\n  }\n}\n","import * as React from 'react';\nimport styled from 'styled-components';\nimport { OpType } from './operation';\nimport {\n  FocusMode,\n  getRelationship,\n  TopicRelationship\n} from '@blink-mind/core';\nimport debug from 'debug';\nimport { TopicDropEffect } from './react/components/topic-drop-effect';\nimport { contentRefKey } from '../utils';\nconst log = debug('plugin:drag-and-drop');\nconst DropArea = styled.div`\n  height: ${props => `${props.height}px`};\n  width: 100%;\n  margin: 5px 0px;\n`;\n\nconst DropEffects = styled.svg``;\nexport function DragAndDrop() {\n  let dragTargetKey: KeyType = null;\n  let dragTargetDir: string = null;\n\n  return {\n    renderTopicDropArea(props) {\n      const { topicKey, dropDir, saveRef, controller, model } = props;\n      const onDragEnter = ev => {\n        log('onDragEnter', topicKey, dropDir);\n        controller.run('handleTopicDragEnter', { ...props, ev, dropDir });\n      };\n      const onDragLeave = ev => {\n        log('onDragLeave', topicKey, dropDir);\n        controller.run('handleTopicDragLeave', { ...props, ev, dropDir });\n      };\n      const onDragOver = ev => {\n        ev.preventDefault();\n      };\n      const onDrop = ev => {\n        log('onDrop', topicKey, dropDir);\n        controller.run('handleTopicDrop', { ...props, ev, dropDir });\n      };\n      const eventHandlers = {\n        onDragEnter,\n        onDragLeave,\n        onDragOver,\n        onDrop\n      };\n      return (\n        <DropArea\n          height={model.config.theme.marginV / 2}\n          ref={saveRef(`dropArea-${dropDir}-${topicKey}`)}\n          {...eventHandlers}\n        />\n      );\n    },\n\n    renderDragAndDropEffect(props) {\n      log('renderDragAndDropEffect');\n      const { saveRef } = props;\n      return (\n        <TopicDropEffect\n          ref={saveRef('drop-effect')}\n          {...props}\n        ></TopicDropEffect>\n      );\n    },\n\n    // getTopicDropEventHandlers(props) {\n    //   const { dropDir, controller, topicKey } = props;\n    //   const onDragEnter = ev => {\n    //     log('onDragEnter', topicKey, dropDir);\n    //     controller.run('handleTopicDragEnter', { ...props, ev, dropDir });\n    //   };\n    //   const onDragLeave = ev => {\n    //     log('onDragLeave', topicKey, dropDir);\n    //     controller.run('handleTopicDragLeave', { ...props, ev, dropDir });\n    //   };\n    //   const onDragOver = ev => {\n    //     ev.preventDefault();\n    //   };\n    //   const onDrop = ev => {\n    //     log('onDrop', topicKey, dropDir);\n    //     controller.run('handleTopicDrop', { ...props, ev, dropDir });\n    //   };\n    //   const eventHandlers = {\n    //     onDragEnter,\n    //     onDragLeave,\n    //     onDragOver,\n    //     onDrop\n    //   };\n    //   return eventHandlers;\n    // },\n\n    getDragTargetProps(props) {\n      return {\n        key: dragTargetKey,\n        dropDir: dragTargetDir\n      };\n    },\n\n    handleTopicDragStart(props) {\n      const { controller, ev } = props;\n      ev.stopPropagation();\n      controller.run('operation', {\n        ...props,\n        opType: OpType.FOCUS_TOPIC,\n        focusMode: FocusMode.DRAGGING\n      });\n    },\n\n    canDrop(props) {\n      const { srcKey, dstKey, model, dropDir } = props;\n      if (\n        srcKey === model.editorRootTopicKey ||\n        srcKey === dstKey ||\n        getRelationship(model, srcKey, dstKey) === TopicRelationship.ANCESTOR\n      )\n        return false;\n      if (dstKey === model.editorRootTopicKey && dropDir !== 'in') return false;\n\n      const srcTopic = model.getTopic(srcKey);\n      if (srcTopic.parentKey === dstKey && dropDir === 'in') return false;\n      return true;\n    },\n\n    handleTopicDragEnter(props) {\n      const { dropDir, topicKey, controller, model, ev } = props;\n      log('handleTopicDragEnter:', topicKey, dropDir);\n      const canDrop = controller.run('canDrop', {\n        ...props,\n        srcKey: model.focusKey,\n        dstKey: topicKey\n      });\n      if (canDrop) {\n        dragTargetKey = topicKey;\n        dragTargetDir = dropDir;\n        controller.change(model);\n      }\n    },\n\n    handleTopicDragLeave(props) {\n      const { controller, model, topicKey, dropDir, getRef, ev } = props;\n      const relatedTarget = ev.nativeEvent.relatedTarget;\n      log('handleTopicDragLeave:', topicKey, dropDir);\n      const content = getRef(contentRefKey(topicKey));\n      if (content == relatedTarget || content.contains(relatedTarget)) {\n        return;\n      }\n      dragTargetKey = null;\n      dragTargetDir = null;\n      controller.change(model);\n    },\n\n    handleTopicDrop(props) {\n      log('handleTopicDrop');\n      const { controller, topicKey, model } = props;\n      props = { ...props, srcKey: model.focusKey, dstKey: topicKey };\n\n      dragTargetKey = null;\n      dragTargetDir = null;\n      if (controller.run('canDrop', props)) {\n        controller.run('operation', {\n          ...props,\n          opType: OpType.DRAG_AND_DROP\n        });\n      }\n    }\n  };\n}\n","import { ReactPlugin } from './react';\nimport { LayoutPlugin } from './layout';\nimport { OperationPlugin } from './operation';\nimport { StylePlugin } from './style';\nimport { EventPlugin } from './event';\nimport { HotKeyPlugin } from './hotkey';\nimport { DragAndDrop } from './drag-and-drop';\n\nexport function DefaultPlugin() {\n  return [\n    ReactPlugin(),\n    LayoutPlugin(),\n    OperationPlugin(),\n    StylePlugin(),\n    EventPlugin(),\n    HotKeyPlugin(),\n    DragAndDrop()\n  ];\n}\n","import * as React from 'react';\nimport memoizeOne from 'memoize-one';\nimport { Hotkey, Hotkeys, HotkeysTarget } from '@blueprintjs/core';\nimport { Model, Controller, OnChangeFunction } from '@blink-mind/core';\nimport { DefaultPlugin } from '../plugins';\nimport './diagram.css';\nimport '@blueprintjs/core/lib/css/blueprint.css';\nimport debug from 'debug';\nconst log = debug('node:Diagram');\n\ninterface Props {\n  model: Model;\n  onChange: OnChangeFunction;\n  commands?: any;\n  plugins?: any;\n}\n\n@HotkeysTarget\nexport class Diagram extends React.Component<Props> {\n  controller: Controller;\n\n  getDiagramProps() {\n    return this.diagramProps;\n  }\n\n  diagramProps;\n\n  resolveController = memoizeOne((plugins = [], commands, TheDefaultPlugin) => {\n    const defaultPlugin = TheDefaultPlugin();\n    this.controller = new Controller({\n      plugins: [plugins, defaultPlugin],\n      commands,\n      construct: false,\n      onChange: this.props.onChange\n    });\n    this.controller.run('onConstruct');\n  });\n\n  renderHotkeys() {\n    log(`renderHotkeys`);\n    const { controller } = this.diagramProps;\n    const hotKeys = controller.run('customizeHotKeys', this.diagramProps);\n    if (hotKeys === null) return null;\n    if (!(hotKeys instanceof Map)) {\n      throw new TypeError('customizeHotKeys must return a Map');\n    }\n    log(hotKeys);\n    const children = [];\n    hotKeys.forEach((v, k) => {\n      log(k, v);\n      children.push(<Hotkey key={k} {...v} global />);\n    });\n    return <Hotkeys>{children}</Hotkeys>;\n  }\n\n  render() {\n    const { commands, plugins, model } = this.props;\n    this.resolveController(plugins, commands, DefaultPlugin);\n    this.diagramProps = {\n      ...this.props,\n      controller: this.controller,\n      model,\n      diagram: this\n    };\n    return this.controller.run('renderDiagram', this.diagramProps);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}