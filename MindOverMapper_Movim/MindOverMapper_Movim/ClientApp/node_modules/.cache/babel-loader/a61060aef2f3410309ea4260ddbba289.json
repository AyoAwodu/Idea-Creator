{"ast":null,"code":"/*\r\n * Copyright 2015 Palantir Technologies, Inc. All rights reserved.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\nimport * as tslib_1 from \"tslib\";\nimport classNames from \"classnames\";\nimport * as React from \"react\";\nimport { polyfill } from \"react-lifecycles-compat\";\nimport { AbstractPureComponent2, Classes } from \"../../common\";\nimport { DISPLAYNAME_PREFIX } from \"../../common/props\";\n/**\r\n * `Collapse` can be in one of six states, enumerated here.\r\n * When changing the `isOpen` prop, the following happens to the states:\r\n * isOpen={true}  : CLOSED -> OPEN_START -> OPENING -> OPEN\r\n * isOpen={false} : OPEN -> CLOSING_START -> CLOSING -> CLOSED\r\n */\n\nexport var AnimationStates;\n\n(function (AnimationStates) {\n  /**\r\n   * The body is re-rendered, height is set to the measured body height and\r\n   * the body Y is set to 0.\r\n   */\n  AnimationStates[AnimationStates[\"OPEN_START\"] = 0] = \"OPEN_START\";\n  /**\r\n   * Animation begins, height is set to auto. This is all animated, and on\r\n   * complete, the state changes to OPEN.\r\n   */\n\n  AnimationStates[AnimationStates[\"OPENING\"] = 1] = \"OPENING\";\n  /**\r\n   * The collapse height is set to auto, and the body Y is set to 0 (so the\r\n   * element can be seen as normal).\r\n   */\n\n  AnimationStates[AnimationStates[\"OPEN\"] = 2] = \"OPEN\";\n  /**\r\n   * Height has been changed from auto to the measured height of the body to\r\n   * prepare for the closing animation in CLOSING.\r\n   */\n\n  AnimationStates[AnimationStates[\"CLOSING_START\"] = 3] = \"CLOSING_START\";\n  /**\r\n   * Height is set to 0 and the body Y is at -height. Both of these properties\r\n   * are transformed, and then after the animation is complete, the state\r\n   * changes to CLOSED.\r\n   */\n\n  AnimationStates[AnimationStates[\"CLOSING\"] = 4] = \"CLOSING\";\n  /**\r\n   * The contents of the collapse is not rendered, the collapse height is 0,\r\n   * and the body Y is at -height (so that the bottom of the body is at Y=0).\r\n   */\n\n  AnimationStates[AnimationStates[\"CLOSED\"] = 5] = \"CLOSED\";\n})(AnimationStates || (AnimationStates = {}));\n\nvar Collapse =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(Collapse, _super);\n\n  function Collapse() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      animationState: _this.props.isOpen ? AnimationStates.OPEN : AnimationStates.CLOSED,\n      height: \"0px\"\n    };\n\n    _this.contentsRefHandler = function (el) {\n      _this.contents = el;\n\n      if (el != null) {\n        _this.setState({\n          animationState: _this.props.isOpen ? AnimationStates.OPEN : AnimationStates.CLOSED,\n          height: _this.contents.clientHeight + \"px\"\n        });\n      }\n    };\n\n    return _this;\n  }\n\n  Collapse.getDerivedStateFromProps = function (props, state) {\n    var isOpen = props.isOpen;\n    var animationState = state.animationState;\n\n    if (isOpen) {\n      switch (animationState) {\n        case AnimationStates.OPENING:\n          // allow Collapse#onDelayedStateChange() to handle the transition here\n          break;\n\n        case AnimationStates.OPEN:\n          break;\n\n        default:\n          return {\n            animationState: AnimationStates.OPEN_START\n          };\n      }\n    } else {\n      switch (animationState) {\n        case AnimationStates.CLOSING:\n          // allow Collapse#onDelayedStateChange() to handle the transition here\n          break;\n\n        case AnimationStates.CLOSED:\n          break;\n\n        default:\n          return {\n            animationState: AnimationStates.CLOSING_START\n          };\n      }\n    }\n\n    return null;\n  };\n\n  Collapse.prototype.render = function () {\n    var isContentVisible = this.state.animationState !== AnimationStates.CLOSED;\n    var shouldRenderChildren = isContentVisible || this.props.keepChildrenMounted;\n    var displayWithTransform = isContentVisible && this.state.animationState !== AnimationStates.CLOSING;\n    var isAutoHeight = this.state.height === \"auto\";\n    var containerStyle = {\n      height: isContentVisible ? this.state.height : undefined,\n      overflowY: isAutoHeight ? \"visible\" : undefined,\n      transition: isAutoHeight ? \"none\" : undefined\n    };\n    var contentsStyle = {\n      transform: displayWithTransform ? \"translateY(0)\" : \"translateY(-\" + this.state.height + \"px)\",\n      transition: isAutoHeight ? \"none\" : undefined\n    };\n    return React.createElement(this.props.component, {\n      className: classNames(Classes.COLLAPSE, this.props.className),\n      style: containerStyle\n    }, React.createElement(\"div\", {\n      className: Classes.COLLAPSE_BODY,\n      ref: this.contentsRefHandler,\n      style: contentsStyle,\n      \"aria-hidden\": !isContentVisible && this.props.keepChildrenMounted\n    }, shouldRenderChildren ? this.props.children : null));\n  };\n\n  Collapse.prototype.componentDidMount = function () {\n    this.forceUpdate();\n\n    if (this.props.isOpen) {\n      this.setState({\n        animationState: AnimationStates.OPEN,\n        height: \"auto\"\n      });\n    } else {\n      this.setState({\n        animationState: AnimationStates.CLOSED\n      });\n    }\n  };\n\n  Collapse.prototype.componentDidUpdate = function () {\n    var _this = this;\n\n    var height;\n\n    if (this.contents != null && this.contents.clientHeight !== 0) {\n      height = this.contents.clientHeight;\n    }\n\n    var transitionDuration = this.props.transitionDuration;\n    var animationState = this.state.animationState;\n\n    if (animationState === AnimationStates.CLOSING_START) {\n      this.setTimeout(function () {\n        return _this.setState({\n          animationState: AnimationStates.CLOSING,\n          height: \"0px\"\n        });\n      });\n      this.setTimeout(function () {\n        return _this.onDelayedStateChange();\n      }, transitionDuration);\n    } else if (animationState === AnimationStates.OPEN_START) {\n      this.setState({\n        animationState: AnimationStates.OPENING,\n        height: height !== undefined ? height + \"px\" : this.state.height\n      });\n      this.setTimeout(function () {\n        return _this.onDelayedStateChange();\n      }, transitionDuration);\n    }\n  };\n\n  Collapse.prototype.onDelayedStateChange = function () {\n    switch (this.state.animationState) {\n      case AnimationStates.OPENING:\n        this.setState({\n          animationState: AnimationStates.OPEN,\n          height: \"auto\"\n        });\n        break;\n\n      case AnimationStates.CLOSING:\n        this.setState({\n          animationState: AnimationStates.CLOSED\n        });\n        break;\n\n      default:\n        break;\n    }\n  };\n\n  Collapse.displayName = DISPLAYNAME_PREFIX + \".Collapse\";\n  Collapse.defaultProps = {\n    component: \"div\",\n    isOpen: false,\n    keepChildrenMounted: false,\n    transitionDuration: 200\n  };\n  Collapse = tslib_1.__decorate([polyfill], Collapse);\n  return Collapse;\n}(AbstractPureComponent2);\n\nexport { Collapse };","map":null,"metadata":{},"sourceType":"module"}